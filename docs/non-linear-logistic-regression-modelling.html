<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 18 Non-linear Logistic Regression Modelling | R for Environmental Chemists</title>
  <meta name="description" content="This is a proof-of-concept for a further full length textbook." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 18 Non-linear Logistic Regression Modelling | R for Environmental Chemists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://davidrosshall.github.io/R4EnvChem/" />
  
  <meta property="og:description" content="This is a proof-of-concept for a further full length textbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 18 Non-linear Logistic Regression Modelling | R for Environmental Chemists" />
  
  <meta name="twitter:description" content="This is a proof-of-concept for a further full length textbook." />
  

<meta name="author" content="David Hall, Steven Kutarna, Kristen Yeh, Hui Peng and Jessica D’eon" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="linear-regression-redux.html"/>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Environmental Chemistry</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#providing-feedback"><i class="fa fa-check"></i><b>0.1</b> Providing Feedback</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
</ul></li>
<li class="part"><span><b>Section 1: Getting Setup in R</b></span></li>
<li class="chapter" data-level="1" data-path="installing-r.html"><a href="installing-r.html"><i class="fa fa-check"></i><b>1</b> Installing R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installing-r.html"><a href="installing-r.html#prerequisite-software"><i class="fa fa-check"></i><b>1.1</b> Prerequisite software</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="installing-r.html"><a href="installing-r.html#r"><i class="fa fa-check"></i><b>1.1.1</b> R</a></li>
<li class="chapter" data-level="1.1.2" data-path="installing-r.html"><a href="installing-r.html#downloading-rstudio-ide"><i class="fa fa-check"></i><b>1.1.2</b> Downloading RStudio IDE</a></li>
<li class="chapter" data-level="1.1.3" data-path="installing-r.html"><a href="installing-r.html#installing-packages"><i class="fa fa-check"></i><b>1.1.3</b> Installing packages</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="installing-r.html"><a href="installing-r.html#running-r-code"><i class="fa fa-check"></i><b>1.2</b> Running R Code</a></li>
<li class="chapter" data-level="1.3" data-path="installing-r.html"><a href="installing-r.html#customizing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Customizing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="installing-r.html"><a href="installing-r.html#where-to-get-help"><i class="fa fa-check"></i><b>1.4</b> Where to get help</a></li>
<li class="chapter" data-level="1.5" data-path="installing-r.html"><a href="installing-r.html#summary"><i class="fa fa-check"></i><b>1.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="r-studio-projects.html"><a href="r-studio-projects.html"><i class="fa fa-check"></i><b>2</b> R Studio Projects</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r-studio-projects.html"><a href="r-studio-projects.html#paths-and-directories"><i class="fa fa-check"></i><b>2.1</b> Paths and directories</a></li>
<li class="chapter" data-level="2.2" data-path="r-studio-projects.html"><a href="r-studio-projects.html#importing-a-project"><i class="fa fa-check"></i><b>2.2</b> Importing a project</a></li>
<li class="chapter" data-level="2.3" data-path="r-studio-projects.html"><a href="r-studio-projects.html#summary-1"><i class="fa fa-check"></i><b>2.3</b> Summary</a></li>
<li class="chapter" data-level="2.4" data-path="r-studio-projects.html"><a href="r-studio-projects.html#creating-an-rstudio-project"><i class="fa fa-check"></i><b>2.4</b> Creating an RStudio project</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-coding-basics.html"><a href="r-coding-basics.html"><i class="fa fa-check"></i><b>3</b> R coding basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#variables"><i class="fa fa-check"></i><b>3.1</b> Variables</a></li>
<li class="chapter" data-level="3.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-types"><i class="fa fa-check"></i><b>3.2</b> Data Types</a></li>
<li class="chapter" data-level="3.3" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-structures"><i class="fa fa-check"></i><b>3.3</b> Data Structures</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#accessing-data-in-subfolders"><i class="fa fa-check"></i><b>3.3.1</b> Accessing data in subfolders</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-coding-basics.html"><a href="r-coding-basics.html#other-data-structures"><i class="fa fa-check"></i><b>3.4</b> Other data structures</a></li>
<li class="chapter" data-level="3.5" data-path="r-coding-basics.html"><a href="r-coding-basics.html#r-packages-and-functions"><i class="fa fa-check"></i><b>3.5</b> R packages and functions</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#ggplot2"><i class="fa fa-check"></i><b>3.5.1</b> ggplot2</a></li>
<li class="chapter" data-level="3.5.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#calling-specific-functions"><i class="fa fa-check"></i><b>3.5.2</b> Calling specific functions</a></li>
<li class="chapter" data-level="3.5.3" data-path="r-coding-basics.html"><a href="r-coding-basics.html#function-documentation"><i class="fa fa-check"></i><b>3.5.3</b> Function Documentation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="r-coding-basics.html"><a href="r-coding-basics.html#summary-2"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html"><i class="fa fa-check"></i><b>4</b> Workflows for R coding</a>
<ul>
<li class="chapter" data-level="4.1" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#creating-or-opening-a-script"><i class="fa fa-check"></i><b>4.1</b> Creating or opening a script</a></li>
<li class="chapter" data-level="4.2" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#workspace-and-whats-real"><i class="fa fa-check"></i><b>4.2</b> Workspace and what’s real</a></li>
<li class="chapter" data-level="4.3" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#saving-r-scripts"><i class="fa fa-check"></i><b>4.3</b> Saving R scripts</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#what-should-i-save"><i class="fa fa-check"></i><b>4.3.1</b> What should I save?</a></li>
<li class="chapter" data-level="4.3.2" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#saving-objects"><i class="fa fa-check"></i><b>4.3.2</b> Saving objects</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#script-formatting"><i class="fa fa-check"></i><b>4.4</b> Script formatting</a></li>
<li class="chapter" data-level="4.5" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#viewing-data-and-code-simultaneously"><i class="fa fa-check"></i><b>4.5</b> Viewing data and code simultaneously</a></li>
<li class="chapter" data-level="4.6" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#troubleshooting-error-messages"><i class="fa fa-check"></i><b>4.6</b> Troubleshooting error messages</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#script-diagnostics"><i class="fa fa-check"></i><b>4.6.1</b> Script diagnostics</a></li>
<li class="chapter" data-level="4.6.2" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#reading-error-codes"><i class="fa fa-check"></i><b>4.6.2</b> Reading error codes</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#summary-3"><i class="fa fa-check"></i><b>4.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="using-r-markdown.html"><a href="using-r-markdown.html"><i class="fa fa-check"></i><b>5</b> Using R Markdown</a>
<ul>
<li class="chapter" data-level="5.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#deeper-look-into-rmarkdown"><i class="fa fa-check"></i><b>5.1</b> Deeper look into rmarkdown</a></li>
<li class="chapter" data-level="5.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#getting-started-with-rmarkdown"><i class="fa fa-check"></i><b>5.2</b> Getting started with rmarkdown</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#understanding-rmarkdown"><i class="fa fa-check"></i><b>5.2.1</b> Understanding rmarkdown</a></li>
<li class="chapter" data-level="5.2.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#running-code-in-rmarkdown"><i class="fa fa-check"></i><b>5.2.2</b> Running code in rmarkdown</a></li>
<li class="chapter" data-level="5.2.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#generating-final-report"><i class="fa fa-check"></i><b>5.2.3</b> Generating final report</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#so-now-what-do-i-do-with-r-markdown"><i class="fa fa-check"></i><b>5.3</b> So now what do I do with R Markdown?</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-resources-and-further-reading"><i class="fa fa-check"></i><b>5.3.1</b> R Markdown resources and further reading</a></li>
<li class="chapter" data-level="5.3.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-code-chunk-options"><i class="fa fa-check"></i><b>5.3.2</b> R code chunk options</a></li>
<li class="chapter" data-level="5.3.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#inserting-images"><i class="fa fa-check"></i><b>5.3.3</b> Inserting images</a></li>
<li class="chapter" data-level="5.3.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#generating-tables"><i class="fa fa-check"></i><b>5.3.4</b> Generating Tables</a></li>
<li class="chapter" data-level="5.3.5" data-path="using-r-markdown.html"><a href="using-r-markdown.html#spellcheck-in-r-markdown"><i class="fa fa-check"></i><b>5.3.5</b> Spellcheck in R Markdown</a></li>
<li class="chapter" data-level="5.3.6" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-syntax"><i class="fa fa-check"></i><b>5.3.6</b> R markdown syntax</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#rstudio-tips-and-tricks"><i class="fa fa-check"></i><b>5.4</b> RStudio tips and tricks</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="r-tutorial-exercise.html"><a href="r-tutorial-exercise.html"><i class="fa fa-check"></i><b>6</b> R Tutorial Exercise</a>
<ul>
<li class="chapter" data-level="6.1" data-path="r-tutorial-exercise.html"><a href="r-tutorial-exercise.html#expected-outcome"><i class="fa fa-check"></i><b>6.1</b> Expected outcome</a></li>
</ul></li>
<li class="part"><span><b>Section 2: Data Analysis in R</b></span></li>
<li class="chapter" data-level="7" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html"><i class="fa fa-check"></i><b>7</b> Intro to Data Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#example-data"><i class="fa fa-check"></i><b>7.1</b> Example Data</a></li>
<li class="chapter" data-level="7.2" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#further-reading"><i class="fa fa-check"></i><b>7.2</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html"><i class="fa fa-check"></i><b>8</b> Importing data into R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#how-data-is-stored"><i class="fa fa-check"></i><b>8.1</b> How data is stored</a></li>
<li class="chapter" data-level="8.2" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#read_csv"><i class="fa fa-check"></i><b>8.2</b> read_csv</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#tibbles-vs.-data-frames"><i class="fa fa-check"></i><b>8.2.1</b> Tibbles vs. data frames</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#importing-other-data-types"><i class="fa fa-check"></i><b>8.3</b> Importing other data types</a></li>
<li class="chapter" data-level="8.4" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#saving-data"><i class="fa fa-check"></i><b>8.4</b> Saving data</a></li>
<li class="chapter" data-level="8.5" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#further-reading-1"><i class="fa fa-check"></i><b>8.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tidying-your-data.html"><a href="tidying-your-data.html"><i class="fa fa-check"></i><b>9</b> Tidying your data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#what-is-tidy-data"><i class="fa fa-check"></i><b>9.1</b> What is tidy data?</a></li>
<li class="chapter" data-level="9.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tools-to-tidy-your-data"><i class="fa fa-check"></i><b>9.2</b> Tools to tidy your data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#making-data-longer"><i class="fa fa-check"></i><b>9.2.1</b> Making data ‘longer’</a></li>
<li class="chapter" data-level="9.2.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#making-data-wider"><i class="fa fa-check"></i><b>9.2.2</b> Making data ‘wider’</a></li>
<li class="chapter" data-level="9.2.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#seperating-columns"><i class="fa fa-check"></i><b>9.2.3</b> Seperating columns</a></li>
<li class="chapter" data-level="9.2.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#unitingcombining-columns"><i class="fa fa-check"></i><b>9.2.4</b> Uniting/combining columns</a></li>
<li class="chapter" data-level="9.2.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#renaming-columnsheaders"><i class="fa fa-check"></i><b>9.2.5</b> Renaming columns/headers</a></li>
<li class="chapter" data-level="9.2.6" data-path="tidying-your-data.html"><a href="tidying-your-data.html#rounding-numbers"><i class="fa fa-check"></i><b>9.2.6</b> Rounding numbers</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tips-for-recording-data"><i class="fa fa-check"></i><b>9.3</b> Tips for recording data</a></li>
<li class="chapter" data-level="9.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#further-reading-2"><i class="fa fa-check"></i><b>9.4</b> Further reading</a></li>
<li class="chapter" data-level="9.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#chapter-references"><i class="fa fa-check"></i><b>9.5</b> Chapter References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html"><i class="fa fa-check"></i><b>10</b> Transform: dplyr and data manipulation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#selecting-by-row-or-value"><i class="fa fa-check"></i><b>10.1</b> Selecting by row or value</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#logical-oeprators"><i class="fa fa-check"></i><b>10.1.1</b> Logical oeprators</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#arranging-rows"><i class="fa fa-check"></i><b>10.2</b> Arranging rows</a></li>
<li class="chapter" data-level="10.3" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#selecting-by-column-or-variable"><i class="fa fa-check"></i><b>10.3</b> Selecting by column or variable</a></li>
<li class="chapter" data-level="10.4" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#adding-new-variables"><i class="fa fa-check"></i><b>10.4</b> Adding new variables</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#useful-mutate-function"><i class="fa fa-check"></i><b>10.4.1</b> Useful mutate function</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#group-and-summarize-data"><i class="fa fa-check"></i><b>10.5</b> Group and summarize data</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#useful-summarize-functions"><i class="fa fa-check"></i><b>10.5.1</b> Useful summarize functions</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#the-pipe-chaining-functions-together"><i class="fa fa-check"></i><b>10.6</b> The pipe: chaining functions together</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#notes-on-piping"><i class="fa fa-check"></i><b>10.6.1</b> Notes on piping</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#further-reading-3"><i class="fa fa-check"></i><b>10.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="programming-with-r.html"><a href="programming-with-r.html"><i class="fa fa-check"></i><b>11</b> Programming with R</a>
<ul>
<li class="chapter" data-level="11.1" data-path="programming-with-r.html"><a href="programming-with-r.html#functions"><i class="fa fa-check"></i><b>11.1</b> Functions</a></li>
<li class="chapter" data-level="11.2" data-path="programming-with-r.html"><a href="programming-with-r.html#conditional-arguments"><i class="fa fa-check"></i><b>11.2</b> Conditional arguments</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="programming-with-r.html"><a href="programming-with-r.html#piping-conditional-statements"><i class="fa fa-check"></i><b>11.2.1</b> Piping conditional statements</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="programming-with-r.html"><a href="programming-with-r.html#when-to-use-functions"><i class="fa fa-check"></i><b>11.3</b> When to use functions</a></li>
<li class="chapter" data-level="11.4" data-path="programming-with-r.html"><a href="programming-with-r.html#further-reading-4"><i class="fa fa-check"></i><b>11.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>12</b> Modelling</a>
<ul>
<li class="chapter" data-level="12.1" data-path="modelling.html"><a href="modelling.html#base-r-linear-model"><i class="fa fa-check"></i><b>12.1</b> Base R Linear Model</a></li>
<li class="chapter" data-level="12.2" data-path="modelling.html"><a href="modelling.html#cleaning-up-model-ouputs"><i class="fa fa-check"></i><b>12.2</b> Cleaning up model ouputs</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="modelling.html"><a href="modelling.html#why-we-approach-modelling-this-way"><i class="fa fa-check"></i><b>12.2.1</b> Why we approach modelling this way</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="modelling.html"><a href="modelling.html#visualizing-model"><i class="fa fa-check"></i><b>12.3</b> Visualizing model</a></li>
<li class="chapter" data-level="12.4" data-path="modelling.html"><a href="modelling.html#further-reading-5"><i class="fa fa-check"></i><b>12.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="visualizations.html"><a href="visualizations.html"><i class="fa fa-check"></i><b>13</b> Visualizations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="visualizations.html"><a href="visualizations.html#building-plots-ups"><i class="fa fa-check"></i><b>13.1</b> Building plots ups</a></li>
<li class="chapter" data-level="13.2" data-path="visualizations.html"><a href="visualizations.html#basic-plotting"><i class="fa fa-check"></i><b>13.2</b> Basic plotting</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="visualizations.html"><a href="visualizations.html#changing-plot-labels"><i class="fa fa-check"></i><b>13.2.1</b> Changing plot labels</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="visualizations.html"><a href="visualizations.html#further-reading-6"><i class="fa fa-check"></i><b>13.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>14</b> Communication</a></li>
<li class="part"><span><b>Section 3: Data Analysis Toolbox</b></span></li>
<li class="chapter" data-level="15" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>15</b> Introduction</a></li>
<li class="chapter" data-level="16" data-path="choosing-visualizations.html"><a href="choosing-visualizations.html"><i class="fa fa-check"></i><b>16</b> Choosing Visualizations</a></li>
<li class="chapter" data-level="17" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html"><i class="fa fa-check"></i><b>17</b> Linear Regression Redux</a></li>
<li class="chapter" data-level="18" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html"><i class="fa fa-check"></i><b>18</b> Non-linear Logistic Regression Modelling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#visually-inspecting-our-data"><i class="fa fa-check"></i><b>18.1</b> Visually inspecting our data</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#annotating-maximal-values"><i class="fa fa-check"></i><b>18.1.1</b> Annotating maximal values</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#extracting-maximal-values"><i class="fa fa-check"></i><b>18.2</b> Extracting maximal values</a></li>
<li class="chapter" data-level="18.3" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#modelling-sigmoidal-curve"><i class="fa fa-check"></i><b>18.3</b> Modelling Sigmoidal Curve</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#calculating-logistic-regression"><i class="fa fa-check"></i><b>18.3.1</b> Calculating Logistic Regression</a></li>
<li class="chapter" data-level="18.3.2" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#extracting-model-parameters"><i class="fa fa-check"></i><b>18.3.2</b> Extracting model parameters</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Environmental Chemists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="non-linear-logistic-regression-modelling" class="section level1" number="18">
<h1><span class="header-section-number">Chapter 18</span> Non-linear Logistic Regression Modelling</h1>
<p><strong>Note this is from the proof-of-concept book and will be shortened/narrowed down to talk about non-l;inear regression in general while using a logistic regreassion as an example. Will be reworked shortly, just posting so people get an idea. - DH</strong></p>
<p>For this tutorial we’ll be using data obtained from an experiment in <em>CHM317</em>. In this experiment, students measure the fluorescence of the fluorescent dye acridine orange in the presence of sodium dodecyl sulfate (SDS). In, or near, the critical micellular region of SDS, there is a sharp change in absorbance and fluorescence of the solution. Tracking these changes in fluorescence, students are to estimate the CMC of SDS.</p>
<p>The setting of the fluorometer for this experiment are:</p>
<table>
<thead>
<tr class="header">
<th>Instrumental Settings</th>
<th align="right"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Instrument Name</td>
<td align="right">LS50-B</td>
</tr>
<tr class="even">
<td>Excitation Wavelength</td>
<td align="right">480 nm</td>
</tr>
<tr class="odd">
<td>Emission Wavelength Range</td>
<td align="right">500 to 650.5 nm</td>
</tr>
<tr class="even">
<td>Excitation Slit Width</td>
<td align="right">2.5 nm</td>
</tr>
<tr class="odd">
<td>Emission Slit Width</td>
<td align="right">3 nm</td>
</tr>
<tr class="even">
<td>Scan Speed</td>
<td align="right">250 nm/min</td>
</tr>
</tbody>
</table>
<p>Let’s go ahead and import our data:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="non-linear-logistic-regression-modelling.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb207-2"><a href="non-linear-logistic-regression-modelling.html#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="non-linear-logistic-regression-modelling.html#cb207-3" aria-hidden="true" tabindex="-1"></a>sdsWide <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/CHM317/fluoro_SDSCMC.csv&quot;</span>) </span>
<span id="cb207-4"><a href="non-linear-logistic-regression-modelling.html#cb207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-5"><a href="non-linear-logistic-regression-modelling.html#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sdsWide)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   `Wavelength (nm)` `0.001 M SDS` `0.0016 M SDS` `0.004 M SDS` `0.0048 M SDS`
##               &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
## 1              500           20.0           18.6          7.02           1.12
## 2              500.          27.3           13.9          5.45           5.46
## 3              501           27.0           12.5          8.13           5.89
## 4              502.          29.7           12.5          8.17           5.81
## 5              502           32.6           15.7          4.58           6.69
## 6              502.          32.8           19.4          5.94           5.33
## # ... with 5 more variables: 0.0056 M SDS &lt;dbl&gt;, 0.0064 M SDS &lt;dbl&gt;,
## #   0.0072 M SDS &lt;dbl&gt;, 0.008 M SDS &lt;dbl&gt;, 0.012 M SDS &lt;dbl&gt;</code></pre>
<p>Looking at our data headers we can see the familiar ‘wide’ format, with a wavelength column corresponding to the emission wavelength and the remainder accounting for the emission intensity at various concentration of SDS. Note that the intensity columns contains two pieces of information: 1) the concentration in moles per liter and 2) the identity of the chemical, SDS in this case. So when we tidy our data we’ll need to split these column headers up so we get a column corresponding to the numerical value of the concentration, and another with the identity of the column.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="non-linear-logistic-regression-modelling.html#cb209-1" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> sdsWide <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="non-linear-logistic-regression-modelling.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span><span class="st">`</span><span class="at">Wavelength (nm)</span><span class="st">`</span>, <span class="co"># select all columns BESIDES `Wavelength (nm)`</span></span>
<span id="cb209-3"><a href="non-linear-logistic-regression-modelling.html#cb209-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;conc.units&quot;</span>, <span class="st">&quot;chemical&quot;</span>),</span>
<span id="cb209-4"><a href="non-linear-logistic-regression-modelling.html#cb209-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">&quot;(.*) (.) (.*)&quot;</span>,</span>
<span id="cb209-5"><a href="non-linear-logistic-regression-modelling.html#cb209-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;intensity&quot;</span>,</span>
<span id="cb209-6"><a href="non-linear-logistic-regression-modelling.html#cb209-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">conc =</span> as.numeric)</span>
<span id="cb209-7"><a href="non-linear-logistic-regression-modelling.html#cb209-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb209-8"><a href="non-linear-logistic-regression-modelling.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">wavelength =</span> <span class="st">&#39;Wavelength (nm)&#39;</span>) <span class="co"># renaming column, less typing later on. </span></span>
<span id="cb209-9"><a href="non-linear-logistic-regression-modelling.html#cb209-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-10"><a href="non-linear-logistic-regression-modelling.html#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sds)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   wavelength   conc conc.units chemical intensity
##        &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;
## 1        500 0.001  M          SDS          20.0 
## 2        500 0.0016 M          SDS          18.6 
## 3        500 0.004  M          SDS           7.02
## 4        500 0.0048 M          SDS           1.12
## 5        500 0.0056 M          SDS           5.48
## 6        500 0.0064 M          SDS           7.72</code></pre>
<p>The key bit of code here is <code>names_to</code> and <code>names_pattern</code>. The first part creates three new columns, and the second part searches and subsequently breaks up those headers. Recall our original headers looked like this: <code>0.001 M SDS</code>, where we had the concentration, a space (which is a character!), the concentration units, another space, and finally the chemical. What <code>names_pattern = "(.*) (.) (.*)</code>.is searching for three chunks of characters separated by a space. We specify the chunk of characters in the parentheses. So the first bit, <code>(.*)</code>, means look for any character (<code>.</code> in this context is a placeholder for <em>any</em> character) and the chunk of characters can be any length (as denoted by <code>*</code>). So extending this, we see our code looks for three chunks of characters, delimited by a space between them. The first can be any length, the second is 1 character long, and the third can be any length. You could have specified to look for <code>M</code> or <code>SDS</code> explicitly, but if we had different chemicals or units in our dataset these would be lost.</p>
<p>Lastly note <code>names_transform</code>. We split up our original headers to populate rows. However our original headers were stored as characters, and when w split them up we created three separate strings of characters, so R will treat out <code>conc</code> values as characters rather than numbers. By using <code>names_transform</code> we tell R to treat <code>conc</code> values as numbers.</p>
<p>Oh and we renamed our original <code>Wavelength (nm)</code> column to <code>wavelength</code> using the <code>rename</code> function. It’s always a good idea to use the simplest column names you can (and no simpler!). A good practice is to remove any spaces (you can use <code>snake_case</code> or <code>camelCase</code> instead) as well as removing special character such as parentheses.</p>
<div id="visually-inspecting-our-data" class="section level2" number="18.1">
<h2><span class="header-section-number">18.1</span> Visually inspecting our data</h2>
<p>Let’s make a quick plot of our fluorescence intensity data and see what we have.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="non-linear-logistic-regression-modelling.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sds, </span>
<span id="cb211-2"><a href="non-linear-logistic-regression-modelling.html#cb211-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> wavelength,</span>
<span id="cb211-3"><a href="non-linear-logistic-regression-modelling.html#cb211-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> intensity, </span>
<span id="cb211-4"><a href="non-linear-logistic-regression-modelling.html#cb211-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> conc)) <span class="sc">+</span></span>
<span id="cb211-5"><a href="non-linear-logistic-regression-modelling.html#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>Alright, alright, alright. Things are looking like we’d expect with some well behaved data. By plotting each point individually, we can really see the noise inherent with each reading. For a more robust analysis we’d typically conduct several replicates and average out the spectra for each concentration or apply some kind of model to smooth each peak. But today, we’re just interested in getting the maximal fluorescence emission intensity from each reading.</p>
<p>Let’s first annotate our plate to find the highest point, then go about extracting our data for analysis.</p>
<div id="annotating-maximal-values" class="section level3" number="18.1.1">
<h3><span class="header-section-number">18.1.1</span> Annotating maximal values</h3>
<p>Annotating the maximal point on the plot will take a bit more code then actually obtaining it from the data. For this we’ll need to use the <code>ggpmisc</code> package which contains miscellaneous extensions for <code>ggplot2</code>, and <code>ggrepel</code> so our labels won’t overlap.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="non-linear-logistic-regression-modelling.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpmisc)</span>
<span id="cb212-2"><a href="non-linear-logistic-regression-modelling.html#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb212-3"><a href="non-linear-logistic-regression-modelling.html#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="non-linear-logistic-regression-modelling.html#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sds, </span>
<span id="cb212-5"><a href="non-linear-logistic-regression-modelling.html#cb212-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> wavelength,</span>
<span id="cb212-6"><a href="non-linear-logistic-regression-modelling.html#cb212-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> intensity, </span>
<span id="cb212-7"><a href="non-linear-logistic-regression-modelling.html#cb212-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> conc)) <span class="sc">+</span></span>
<span id="cb212-8"><a href="non-linear-logistic-regression-modelling.html#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb212-9"><a href="non-linear-logistic-regression-modelling.html#cb212-9" aria-hidden="true" tabindex="-1"></a>  ggpmisc<span class="sc">::</span><span class="fu">stat_peaks</span>(<span class="at">span =</span> <span class="cn">NULL</span>,</span>
<span id="cb212-10"><a href="non-linear-logistic-regression-modelling.html#cb212-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">geom =</span> <span class="st">&quot;text_repel&quot;</span>, <span class="co"># From ggrepel</span></span>
<span id="cb212-11"><a href="non-linear-logistic-regression-modelling.html#cb212-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..y.label.., ..x.label..)),</span>
<span id="cb212-12"><a href="non-linear-logistic-regression-modelling.html#cb212-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x.label.fmt =</span> <span class="st">&quot;at %.0f nm&quot;</span>,</span>
<span id="cb212-13"><a href="non-linear-logistic-regression-modelling.html#cb212-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y.label.fmt =</span> <span class="st">&quot;Max intensity = %.0f&quot;</span>,</span>
<span id="cb212-14"><a href="non-linear-logistic-regression-modelling.html#cb212-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">segment.colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb212-15"><a href="non-linear-logistic-regression-modelling.html#cb212-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;inches&quot;</span>)),</span>
<span id="cb212-16"><a href="non-linear-logistic-regression-modelling.html#cb212-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nudge_x =</span> <span class="dv">60</span>,</span>
<span id="cb212-17"><a href="non-linear-logistic-regression-modelling.html#cb212-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nudge_y =</span> <span class="dv">200</span>) <span class="sc">+</span></span>
<span id="cb212-18"><a href="non-linear-logistic-regression-modelling.html#cb212-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(conc))</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>By facetting the plot (i.e. arranging many smaller plots vs. one large one), we can easily see the increase in emission peak intensity as the concentration of SDS increases. Likewise, we can avoid the messy overlap of the max intensity annotations.</p>
<p>This is only one way to plot this data, but this is sufficient because we’re simply inspecting our data at this point. And here we can see that the intensity all occur around a similar wavelength (~ 528 nm)</p>
</div>
</div>
<div id="extracting-maximal-values" class="section level2" number="18.2">
<h2><span class="header-section-number">18.2</span> Extracting maximal values</h2>
<p>The plots we made above are great for inspecting our data, but what we really want is the maximal emission intensity value to calculate the CMC of SDS. We can see the maximal values on the plots, but there’s no way we’re typing those in manually. So let’s go ahead and get out maximal values from our dataset:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="non-linear-logistic-regression-modelling.html#cb213-1" aria-hidden="true" tabindex="-1"></a>sdsMax <span class="ot">&lt;-</span> sds <span class="sc">%&gt;%</span></span>
<span id="cb213-2"><a href="non-linear-logistic-regression-modelling.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(chemical, conc.units, conc) <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="non-linear-logistic-regression-modelling.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(intensity <span class="sc">==</span> <span class="fu">max</span>(intensity)) <span class="sc">%&gt;%</span></span>
<span id="cb213-4"><a href="non-linear-logistic-regression-modelling.html#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb213-5"><a href="non-linear-logistic-regression-modelling.html#cb213-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-6"><a href="non-linear-logistic-regression-modelling.html#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sdsMax)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   wavelength   conc conc.units chemical intensity
##        &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;
## 1       520  0.0056 M          SDS           28.1
## 2       524  0.0072 M          SDS          116. 
## 3       527  0.0064 M          SDS           65.3
## 4       527  0.008  M          SDS          768. 
## 5       528. 0.012  M          SDS          810. 
## 6       528  0.0048 M          SDS           22.0</code></pre>
<p>All we did was tell R to take the row with the highest emission intensity value per group. We specified <code>chemical</code>, <code>conc.units</code>, and <code>conc</code>, in case we had more chemicals in our dataset.</p>
<p>Are maximum values match those we see in our plot above. Let’s see how they stack up againt each other:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="non-linear-logistic-regression-modelling.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sdsMax, </span>
<span id="cb215-2"><a href="non-linear-logistic-regression-modelling.html#cb215-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> conc, </span>
<span id="cb215-3"><a href="non-linear-logistic-regression-modelling.html#cb215-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> intensity)) <span class="sc">+</span></span>
<span id="cb215-4"><a href="non-linear-logistic-regression-modelling.html#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<div class="figure"><span id="fig:sdsMaxPlot"></span>
<img src="R4EnvChem_files/figure-html/sdsMaxPlot-1.png" alt="Plot of maximal fluoresence intensity at various concentrations of SDS." width="672" />
<p class="caption">
Figure 18.1: Plot of maximal fluoresence intensity at various concentrations of SDS.
</p>
</div>
</div>
<div id="modelling-sigmoidal-curve" class="section level2" number="18.3">
<h2><span class="header-section-number">18.3</span> Modelling Sigmoidal Curve</h2>
<p>So we want to find the critical micellular concentration of SDS using the maximum fluorescence emission. The CMC is at the ‘midpoint of the sigmoidal curve.’ Which means we’ll need to a) plot a sigmoidal curve and b) extract the midpoint.</p>
<p>The ‘sigmoidal’ or ‘S-shaped’ curve mentioned in the lab manual is known as a <em>logistic regression</em>. Logistic regressions are often used to model systems with a largely binary outcome. In other words, the system starts at point A, and remains there for awhile, before ‘quickly’ jumping up (or down) to level B and remain there for the remainder. Examples include saturation and dose response curves.</p>
<p>For our CMC working data, the fluorescence intensity is low when the <span class="math inline">\([SDS] &lt; CMC\)</span>, as micelles are not able to form. However once <span class="math inline">\([SDS] &gt; CMC\)</span>, micelles form and the fluorescence intensity increases. We can see this trend in <a href="non-linear-logistic-regression-modelling.html#fig:sdsMaxPlot">18.1</a>.</p>
<p>There are different forms of logistic regression equations. The simplest form is the 1 parameter, or sigmoid, function which looks like <span class="math inline">\(f(x) = \frac{1}{1+e^{-x}}\)</span>. The outputs for this function are between 0 and 1. We could apply this formula to our model if we somehow normalized our fluoresence intensity accordingly. An alternative is to use the <em>four parameter logistic regression</em>, which looks like:</p>
<p><span class="math display">\[f(x) =  \frac{a - d}{\left[ 1 + \left( \frac{x}{c} \right)^b \right ]} + d\]</span></p>
<p>where:</p>
<ul>
<li><strong>a</strong> = the theoretical response when <span class="math inline">\(x = 0\)</span></li>
<li><strong>b</strong> = the slope factor</li>
<li><strong>c</strong> = the mid-range concentration (inflection point)
<ul>
<li>This is commonly referred to as the <em>EC50</em> or <em>LC50</em> in toxicology/pharmacology.</li>
</ul></li>
<li><strong>d</strong> = the theoretical response when <span class="math inline">\(x = \infty\)</span></li>
</ul>
<p>Why do we need such a complicated formula for our model? Well, looking again at <a href="non-linear-logistic-regression-modelling.html#fig:sdsMaxPlot">18.1</a> we see that the lower point is approximately 20, and not zero. Likewise, the upper limit appears to be around 825. The slope factor is necessary because the transition from the low to high steady state occurs over a small, but not immeasurable, concentration range. And lastly, by including the inflection point, we can calculate exactly for this value using <code>R</code> to get the CMC estimate.</p>
<div id="calculating-logistic-regression" class="section level3" number="18.3.1">
<h3><span class="header-section-number">18.3.1</span> Calculating Logistic Regression</h3>
<p>A strength of <code>R</code> is it’s flexibility in running various models, and logistic regression is no different. We can use a number of packages to reach these ends, specifically the <code>drc</code> package contains a plethora of functions for modelling dose response curves (hence <code>drc</code>). However, for this example well use a more generalized approach. Earlier we talked about linear regression, where we plot adjust the slope and intercept of a linear equation to best fit our data (see Calibration Curves). Recall that this optimization is based on minimizing the distance between the model and all of the experimental points (<em>least squares</em>). Well the <code>stats</code> package has a function called <code>nls</code> that expands upon the this to nonlinear models. Per the <code>nls</code> function description: “[nls] determine[s] the nonlinear (weighted) least_squared estimates of the parameters of a nonlinear model.”</p>
<p>So we can create a formula in <code>R</code> based on the four-parameter logistic regression described above. After that, we’ll need to produce some starting details from which the model can build off of. If we don’t tell <code>nls</code> where to start, it can’t function, as the search space is too large. Looking at @ref{fig:sdsMaxPlot}, the intensity appears to floor around 20; the intensity appears to max out around 820; the midpoint appears to be around 0.0075 M, and let’s say the slope is 1. Remember, these are starting values from which <code>nls</code> starts to optimize from, and not the actual values used to construct the model.</p>
<p>So, let’s create our model</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="non-linear-logistic-regression-modelling.html#cb216-1" aria-hidden="true" tabindex="-1"></a>logisModel <span class="ot">&lt;-</span> <span class="fu">nls</span>(intensity <span class="sc">~</span>  (a<span class="sc">-</span>d)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> (conc <span class="sc">/</span>c)<span class="sc">^</span>b) <span class="sc">+</span> d, </span>
<span id="cb216-2"><a href="non-linear-logistic-regression-modelling.html#cb216-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> sdsMax, </span>
<span id="cb216-3"><a href="non-linear-logistic-regression-modelling.html#cb216-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">20</span>,       <span class="co"># min intensity</span></span>
<span id="cb216-4"><a href="non-linear-logistic-regression-modelling.html#cb216-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">b =</span> <span class="dv">1</span>,        <span class="co"># slope</span></span>
<span id="cb216-5"><a href="non-linear-logistic-regression-modelling.html#cb216-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">c =</span> <span class="fl">0.0075</span>,   <span class="co"># CMC</span></span>
<span id="cb216-6"><a href="non-linear-logistic-regression-modelling.html#cb216-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">d=</span> <span class="dv">820</span>)       <span class="co"># max intensity</span></span>
<span id="cb216-7"><a href="non-linear-logistic-regression-modelling.html#cb216-7" aria-hidden="true" tabindex="-1"></a>                  )</span></code></pre></div>
<pre><code>## Error in numericDeriv(form[[3L]], names(ind), env, central = nDcentral): Missing value or an infinity produced when evaluating the model</code></pre>
<p>… and we get an error message. Get used to these when modelling! Don’t worry about understanding it completely, error messages are often written with programmers in mind so they can be a bit cryptic. You can often copy and paste these directly into any search engine to get some more information, but this one is simple enough: we either have a missing value or an infinity produced. Well we have six input parameters in our model: <code>a, b, c, d</code>, our independent variable <code>conc</code>, and our dependant variable <code>intensity</code>. We’ve also supplied starting values to all of them via the list we created inside the function. Therefore, one of our starting values must be too far off from a plausible start point and is causing troubles in the <code>nls</code> function. They all look good except for the slope start value <code>b = 1</code>.</p>
<p>The slope here is an approximation for the slope between the min value <code>a</code> and max value <code>d</code>. Looking at our data in @ref{fig:sdsMaxPlot}, that slope may be a bit shallow consider the large jump in intensity. Let’s increase the value of <code>b</code> and try again:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="non-linear-logistic-regression-modelling.html#cb218-1" aria-hidden="true" tabindex="-1"></a>logisModel <span class="ot">&lt;-</span> <span class="fu">nls</span>(intensity <span class="sc">~</span>  (a<span class="sc">-</span>d)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> (conc <span class="sc">/</span>c)<span class="sc">^</span>b) <span class="sc">+</span> d, </span>
<span id="cb218-2"><a href="non-linear-logistic-regression-modelling.html#cb218-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> sdsMax, </span>
<span id="cb218-3"><a href="non-linear-logistic-regression-modelling.html#cb218-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">20</span>,       <span class="co"># min intensity</span></span>
<span id="cb218-4"><a href="non-linear-logistic-regression-modelling.html#cb218-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">b =</span> <span class="dv">10</span>,       <span class="co"># new slope</span></span>
<span id="cb218-5"><a href="non-linear-logistic-regression-modelling.html#cb218-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">c =</span> <span class="fl">0.0075</span>,   <span class="co"># CMC</span></span>
<span id="cb218-6"><a href="non-linear-logistic-regression-modelling.html#cb218-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">d=</span> <span class="dv">820</span>)       <span class="co"># max intensity</span></span>
<span id="cb218-7"><a href="non-linear-logistic-regression-modelling.html#cb218-7" aria-hidden="true" tabindex="-1"></a>                  )</span></code></pre></div>
<p>Ey, no errors! Once you progress beyond simple linear regressions, modelling becomes more of a craft. If we were trying to apply this model to multiple datasets, we would probably want to shop around <code>cran</code> to find a package with self-starting models. This way we can circument having to supply starting parameters. Anyways, that’s for another day.</p>
<p>For now, let’s take a look at our model outputs which are all stored in the <code>logisModel</code> variable. To this end, we’ll use the <code>broom</code> package which cleans up the default model outputs in <code>R</code>. Specifically, we’ll use <code>tidy</code> to get an output of our estimated model parameters (i.e. <code>a,b,c</code>, and <code>d</code>), and <code>augment</code> for a data frame of containing the input values, and the estimated intensity values.</p>
<p>Let’s look at our fitted values:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="non-linear-logistic-regression-modelling.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb219-2"><a href="non-linear-logistic-regression-modelling.html#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="non-linear-logistic-regression-modelling.html#cb219-3" aria-hidden="true" tabindex="-1"></a>augment <span class="ot">&lt;-</span> <span class="fu">augment</span>(logisModel)</span>
<span id="cb219-4"><a href="non-linear-logistic-regression-modelling.html#cb219-4" aria-hidden="true" tabindex="-1"></a>augment</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   intensity   conc .fitted   .resid
##       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1      28.1 0.0056    49.4 -21.3   
## 2     116.  0.0072   116.   -0.123 
## 3      65.3 0.0064    49.7  15.6   
## 4     768.  0.008    768.    0.0977
## 5     810.  0.012    810.   -0.0861
## 6      22.0 0.0048    49.4 -27.5   
## 7      93.0 0.001     49.4  43.5   
## 8      31.7 0.004     49.4 -17.7   
## 9      57.0 0.0016    49.4   7.51</code></pre>
<p>What we can see here from <code>augment</code> are the <code>intensity</code> and <code>conc</code> values we inputted into R. <code>.fitted</code> are the intenisty values for a given concentration fitted to out model, and <code>.resid</code> is the residuals, the difference between the actual and estimated values.</p>
<p>Let’s go ahead and plot our actual and fitted values against each other.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="non-linear-logistic-regression-modelling.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(augment, <span class="fu">aes</span>(<span class="at">x =</span> conc, <span class="at">y =</span> intensity, <span class="at">colour =</span> <span class="st">&quot;actual&quot;</span>)) <span class="sc">+</span></span>
<span id="cb221-2"><a href="non-linear-logistic-regression-modelling.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb221-3"><a href="non-linear-logistic-regression-modelling.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb221-4"><a href="non-linear-logistic-regression-modelling.html#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">colour =</span> <span class="st">&quot;fitted&quot;</span>)) </span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p>Looks pretty good, although it’s interesting how the baseline at lower concentrations doesn’t plateau like the model values. You’ll note that the line produced by <code>geom_line</code> will only draw a straight line between points. There’s ways to address this, but we don’t need to for our needs right now.</p>
<p>Looking again at our model results, there doesn’t appear to be any gross outliers, so our model seems to have done a good job. We can verify this by checking the residuals:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="non-linear-logistic-regression-modelling.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(augment, <span class="fu">aes</span>(<span class="at">x =</span> conc, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb222-2"><a href="non-linear-logistic-regression-modelling.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>We can’t see any obvious patterns in the residuals (i.e. all are negative), so we can have further confidence in the fit of out model.</p>
</div>
<div id="extracting-model-parameters" class="section level3" number="18.3.2">
<h3><span class="header-section-number">18.3.2</span> Extracting model parameters</h3>
<p>To extrac the model parameters <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> we can use the <code>tidy</code> function:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="non-linear-logistic-regression-modelling.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb223-2"><a href="non-linear-logistic-regression-modelling.html#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="non-linear-logistic-regression-modelling.html#cb223-3" aria-hidden="true" tabindex="-1"></a>tidy <span class="ot">&lt;-</span> <span class="fu">tidy</span>(logisModel)</span>
<span id="cb223-4"><a href="non-linear-logistic-regression-modelling.html#cb223-4" aria-hidden="true" tabindex="-1"></a>tidy</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   term   estimate  std.error statistic       p.value
##   &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 a      49.4     11.1            4.44 0.00678      
## 2 b      49.0      9.65           5.07 0.00385      
## 3 c       0.00755  0.0000785     96.2  0.00000000230
## 4 d     810.      27.3           29.7  0.000000808</code></pre>
<p>Looking past the scientific notation, our model values are pretty similar to what we estimated. Specifically, <code>c</code>, our midpoint value is 0.0076 M. Not too bad from our original estimate. And recall that the midpoint of our curve corresponds to the critical micellular concentration of SDS, which we’ve estimated to be 0.0076M. Not too far from the literature value of 0.0081 M.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Wickham, Hadley. 2010. <span>“A Layered Grammar of Graphics.”</span> <em>Journal of Computational and Graphical Statistics</em> 19 (1): 328. <a href="https://doi.org/10.1198/jcgs.2009.07098">https://doi.org/10.1198/jcgs.2009.07098</a>.
</div>
<div class="csl-entry">
———. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (1): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
</div>
</div>
</div>







            </section>

          </div>
        </div>
      </div>
<a href="linear-regression-redux.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DavidRossHall/R4EnvChem/non-linear-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R4EnvChem.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

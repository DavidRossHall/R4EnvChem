<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Transform: dplyr and data manipulation | R for Environmental Chemists</title>
  <meta name="description" content="This is a proof-of-concept for a further full length textbook." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Transform: dplyr and data manipulation | R for Environmental Chemists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://davidrosshall.github.io/R4EnvChem/" />
  
  <meta property="og:description" content="This is a proof-of-concept for a further full length textbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Transform: dplyr and data manipulation | R for Environmental Chemists" />
  
  <meta name="twitter:description" content="This is a proof-of-concept for a further full length textbook." />
  

<meta name="author" content="David Hall, Steven Kutarna, Kristen Yeh, Hui Peng and Jessica D’eon" />


<meta name="date" content="2021-06-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidying-your-data.html"/>
<link rel="next" href="programming-with-r.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Environmental Chemistry</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Howdy</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#prerequisite-software"><i class="fa fa-check"></i><b>1.1</b> Prerequisite software</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#where-to-get-help"><i class="fa fa-check"></i><b>1.2</b> Where to get help</a></li>
</ul></li>
<li class="part"><span><b>Getting Setup in R</b></span></li>
<li class="chapter" data-level="2" data-path="running-r-code.html"><a href="running-r-code.html"><i class="fa fa-check"></i><b>2</b> Running R Code</a>
<ul>
<li class="chapter" data-level="2.1" data-path="running-r-code.html"><a href="running-r-code.html#navigating-rstudio"><i class="fa fa-check"></i><b>2.1</b> Navigating RStudio</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="running-r-code.html"><a href="running-r-code.html#console"><i class="fa fa-check"></i><b>2.1.1</b> Console</a></li>
<li class="chapter" data-level="2.1.2" data-path="running-r-code.html"><a href="running-r-code.html#environment"><i class="fa fa-check"></i><b>2.1.2</b> Environment</a></li>
<li class="chapter" data-level="2.1.3" data-path="running-r-code.html"><a href="running-r-code.html#viewer"><i class="fa fa-check"></i><b>2.1.3</b> Viewer</a></li>
<li class="chapter" data-level="2.1.4" data-path="running-r-code.html"><a href="running-r-code.html#customizing-rstudio"><i class="fa fa-check"></i><b>2.1.4</b> Customizing RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="running-r-code.html"><a href="running-r-code.html#where-to-run-code-in-rstudio"><i class="fa fa-check"></i><b>2.2</b> Where to run code in RStudio</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="running-r-code.html"><a href="running-r-code.html#scripts-vs.-console"><i class="fa fa-check"></i><b>2.2.1</b> Scripts vs. console</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="running-r-code.html"><a href="running-r-code.html#coding-building-blocks"><i class="fa fa-check"></i><b>2.3</b> Coding building blocks</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="running-r-code.html"><a href="running-r-code.html#variable-assignment"><i class="fa fa-check"></i><b>2.3.1</b> Variable assignment</a></li>
<li class="chapter" data-level="2.3.2" data-path="running-r-code.html"><a href="running-r-code.html#naming-variables"><i class="fa fa-check"></i><b>2.3.2</b> Naming variables</a></li>
<li class="chapter" data-level="2.3.3" data-path="running-r-code.html"><a href="running-r-code.html#basic-data-structures"><i class="fa fa-check"></i><b>2.3.3</b> Basic data structures</a></li>
<li class="chapter" data-level="2.3.4" data-path="running-r-code.html"><a href="running-r-code.html#r-packages-and-functions"><i class="fa fa-check"></i><b>2.3.4</b> R packages and functions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="running-r-code.html"><a href="running-r-code.html#script-formatting"><i class="fa fa-check"></i><b>2.4</b> Script formatting</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="running-r-code.html"><a href="running-r-code.html#script-diagnostics"><i class="fa fa-check"></i><b>2.4.1</b> Script diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="running-r-code.html"><a href="running-r-code.html#viewing-data-and-code-simultaneously"><i class="fa fa-check"></i><b>2.5</b> Viewing data and code simultaneously</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-workflows.html"><a href="r-workflows.html"><i class="fa fa-check"></i><b>3</b> R Workflows</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-workflows.html"><a href="r-workflows.html#creating-an-rstudio-project"><i class="fa fa-check"></i><b>3.1</b> Creating an RStudio Project</a></li>
<li class="chapter" data-level="3.2" data-path="r-workflows.html"><a href="r-workflows.html#navigating-rstudio-1"><i class="fa fa-check"></i><b>3.2</b> Navigating RStudio</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="r-workflows.html"><a href="r-workflows.html#r-environment"><i class="fa fa-check"></i><b>3.2.1</b> R Environment</a></li>
<li class="chapter" data-level="3.2.2" data-path="r-workflows.html"><a href="r-workflows.html#viewer-1"><i class="fa fa-check"></i><b>3.2.2</b> Viewer</a></li>
<li class="chapter" data-level="3.2.3" data-path="r-workflows.html"><a href="r-workflows.html#console-1"><i class="fa fa-check"></i><b>3.2.3</b> Console</a></li>
<li class="chapter" data-level="3.2.4" data-path="r-workflows.html"><a href="r-workflows.html#scripts"><i class="fa fa-check"></i><b>3.2.4</b> Scripts</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="r-workflows.html"><a href="r-workflows.html#dark-mode"><i class="fa fa-check"></i><b>3.3</b> Dark Mode</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="using-r-markdown.html"><a href="using-r-markdown.html"><i class="fa fa-check"></i><b>4</b> Using R Markdown</a>
<ul>
<li class="chapter" data-level="4.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#lets-dig-a-little-deeper"><i class="fa fa-check"></i><b>4.1</b> Let’s dig a little deeper</a></li>
<li class="chapter" data-level="4.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#how-do-i-get-started-with-r-markdown"><i class="fa fa-check"></i><b>4.2</b> How do I get started with R markdown?</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#great-now-whats-going-on-with-this-r-markdown-document"><i class="fa fa-check"></i><b>4.2.1</b> Great, now what’s going on with this R markdown document?</a></li>
<li class="chapter" data-level="4.2.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#how-to-run-r-code-in-r-markdown"><i class="fa fa-check"></i><b>4.2.2</b> How to run R code in R Markdown</a></li>
<li class="chapter" data-level="4.2.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#how-do-i-go-from-r-markdown-to-something-i-can-hand-in"><i class="fa fa-check"></i><b>4.2.3</b> How do I go from R markdown to something I can hand-in</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#so-now-what-do-i-do-with-r-markdown"><i class="fa fa-check"></i><b>4.3</b> So now what do I do with R Markdown?</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-resources-and-further-reading"><i class="fa fa-check"></i><b>4.3.1</b> R Markdown resources and further reading</a></li>
<li class="chapter" data-level="4.3.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-code-chunk-options"><i class="fa fa-check"></i><b>4.3.2</b> R code chunk options</a></li>
<li class="chapter" data-level="4.3.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#inserting-images-into-markdown-documents"><i class="fa fa-check"></i><b>4.3.3</b> Inserting images into markdown documents</a></li>
<li class="chapter" data-level="4.3.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#generating-tables"><i class="fa fa-check"></i><b>4.3.4</b> Generating Tables</a></li>
<li class="chapter" data-level="4.3.5" data-path="using-r-markdown.html"><a href="using-r-markdown.html#spellcheck-in-r-markdown"><i class="fa fa-check"></i><b>4.3.5</b> Spellcheck in R Markdown</a></li>
<li class="chapter" data-level="4.3.6" data-path="using-r-markdown.html"><a href="using-r-markdown.html#quick-reference-on-r-markdown-syntax"><i class="fa fa-check"></i><b>4.3.6</b> Quick reference on R markdown syntax</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Data Analysis in R</b></span></li>
<li class="chapter" data-level="5" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Intro to Data Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#further-reading"><i class="fa fa-check"></i><b>5.1</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html"><i class="fa fa-check"></i><b>6</b> Importing data into R</a>
<ul>
<li class="chapter" data-level="6.1" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#how-data-is-stored"><i class="fa fa-check"></i><b>6.1</b> How data is stored</a></li>
<li class="chapter" data-level="6.2" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#read_csv"><i class="fa fa-check"></i><b>6.2</b> read_csv</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#tibbles-vs.-data-frames"><i class="fa fa-check"></i><b>6.2.1</b> Tibbles vs. data frames</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#importing-other-data-types"><i class="fa fa-check"></i><b>6.3</b> Importing other data types</a></li>
<li class="chapter" data-level="6.4" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#saving-data"><i class="fa fa-check"></i><b>6.4</b> Saving data</a></li>
<li class="chapter" data-level="6.5" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#further-reading-1"><i class="fa fa-check"></i><b>6.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tidying-your-data.html"><a href="tidying-your-data.html"><i class="fa fa-check"></i><b>7</b> Tidying your data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#what-is-tidy-data"><i class="fa fa-check"></i><b>7.1</b> What is tidy data?</a></li>
<li class="chapter" data-level="7.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tools-to-tidy-your-data"><i class="fa fa-check"></i><b>7.2</b> Tools to tidy your data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#making-data-longer"><i class="fa fa-check"></i><b>7.2.1</b> Making data ‘longer’</a></li>
<li class="chapter" data-level="7.2.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#making-data-wider"><i class="fa fa-check"></i><b>7.2.2</b> Making data ‘wider’</a></li>
<li class="chapter" data-level="7.2.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#seperating-columns"><i class="fa fa-check"></i><b>7.2.3</b> Seperating columns</a></li>
<li class="chapter" data-level="7.2.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#unitingcombining-columns"><i class="fa fa-check"></i><b>7.2.4</b> Uniting/combining columns</a></li>
<li class="chapter" data-level="7.2.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#renaming-columnsheaders"><i class="fa fa-check"></i><b>7.2.5</b> Renaming columns/headers</a></li>
<li class="chapter" data-level="7.2.6" data-path="tidying-your-data.html"><a href="tidying-your-data.html#rounding-numbers"><i class="fa fa-check"></i><b>7.2.6</b> Rounding numbers</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tips-for-recording-data"><i class="fa fa-check"></i><b>7.3</b> Tips for recording data</a></li>
<li class="chapter" data-level="7.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#further-reading-2"><i class="fa fa-check"></i><b>7.4</b> Further reading</a></li>
<li class="chapter" data-level="7.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#chapter-references"><i class="fa fa-check"></i><b>7.5</b> Chapter References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html"><i class="fa fa-check"></i><b>8</b> Transform: dplyr and data manipulation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#selecting-by-row-or-value"><i class="fa fa-check"></i><b>8.1</b> Selecting by row or value</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#logical-oeprators"><i class="fa fa-check"></i><b>8.1.1</b> Logical oeprators</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#arranging-rows"><i class="fa fa-check"></i><b>8.2</b> Arranging rows</a></li>
<li class="chapter" data-level="8.3" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#selecting-by-column-or-variable"><i class="fa fa-check"></i><b>8.3</b> Selecting by column or variable</a></li>
<li class="chapter" data-level="8.4" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#adding-new-variables"><i class="fa fa-check"></i><b>8.4</b> Adding new variables</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#useful-mutate-function"><i class="fa fa-check"></i><b>8.4.1</b> Useful mutate function</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#group-and-summarize-data"><i class="fa fa-check"></i><b>8.5</b> Group and summarize data</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#useful-summarize-functions"><i class="fa fa-check"></i><b>8.5.1</b> Useful summarize functions</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#the-pipe-chaining-functions-together"><i class="fa fa-check"></i><b>8.6</b> The pipe: chaining functions together</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#notes-on-piping"><i class="fa fa-check"></i><b>8.6.1</b> Notes on piping</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#further-reading-3"><i class="fa fa-check"></i><b>8.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="programming-with-r.html"><a href="programming-with-r.html"><i class="fa fa-check"></i><b>9</b> Programming with R</a></li>
<li class="chapter" data-level="10" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>10</b> Modelling</a></li>
<li class="chapter" data-level="11" data-path="visualizations.html"><a href="visualizations.html"><i class="fa fa-check"></i><b>11</b> Visualizations</a></li>
<li class="chapter" data-level="12" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>12</b> Communication</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Environmental Chemists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transform-dplyr-and-data-manipulation" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Transform: dplyr and data manipulation</h1>
<p>Transformation encompasses any steps you take to manipulate, reshape, refine, or transform your data. We’ve already touched upon some useful transformation functions in previous example code snippets, such as the <code>mutate</code> function for adding columns. This section will explore some of the most useful functionailities of the <code>dplyr</code> package, explicitly introduce the pipe operator <code>%&gt;%</code>, and showcase how you can leverage these tools to quickly manipulate your data.</p>
<p>The benchmark <code>dplyr</code> functions are :</p>
<ul>
<li><code>mutate()</code> to create new columns/variables from existing data</li>
<li><code>arrange()</code> to reorder rows</li>
<li><code>filter()</code> to refine observations by their values (in other words by row)</li>
<li><code>select()</code> to pick variables by name (in other words by column)</li>
<li><code>summarize</code> to collapse many values down to a single summary.</li>
</ul>
<p>We’ll go through each of these functions, but we highly recommend you read <a href="https://r4ds.had.co.nz/transform.html">Chapter 3: Data Transformation</a> from <em>R for Data Science</em> to get a more comprehensive breakdown of these functions. Note that the information here is based on a <code>tidyverse</code> approach, but this is only one way of doing things. Please see the <a href="transform-dplyr-and-data-manipulation.html#further-reading-3">Further reading</a> section for links to other equally suitable approaches to data transformation.</p>
<p>Let’s explore the functionality of <code>dplyr</code> using some flame absorption/emission spectroscopy (FAES) data from a <em>CHM317</em> lab. This data represents the emission signal of five sodium (Na) standards measured in triplicate:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="transform-dplyr-and-data-manipulation.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing using tips from Import chapter</span></span>
<span id="cb79-2"><a href="transform-dplyr-and-data-manipulation.html#cb79-2" aria-hidden="true" tabindex="-1"></a>FAES <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/FAESdata.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># see section on Pipe</span></span>
<span id="cb79-3"><a href="transform-dplyr-and-data-manipulation.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>std_Na_conc,</span>
<span id="cb79-4"><a href="transform-dplyr-and-data-manipulation.html#cb79-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;replicate&quot;</span>, </span>
<span id="cb79-5"><a href="transform-dplyr-and-data-manipulation.html#cb79-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;reading_&quot;</span>,</span>
<span id="cb79-6"><a href="transform-dplyr-and-data-manipulation.html#cb79-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;signal&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-7"><a href="transform-dplyr-and-data-manipulation.html#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> std_Na_conc,</span>
<span id="cb79-8"><a href="transform-dplyr-and-data-manipulation.html#cb79-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;conc_Na&quot;</span>, <span class="st">&quot;units&quot;</span>),</span>
<span id="cb79-9"><a href="transform-dplyr-and-data-manipulation.html#cb79-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb79-10"><a href="transform-dplyr-and-data-manipulation.html#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="transform-dplyr-and-data-manipulation.html#cb79-11" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(FAES)</span></code></pre></div>
<div id="htmlwidget-fc7325a4a07a45eba7fd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fc7325a4a07a45eba7fd">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["blank","blank","blank","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard"],["0","0","0","0.1","0.1","0.1","0.2","0.2","0.2","0.3","0.3","0.3","0.4","0.4","0.4"],["mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L","mg/L"],["1","2","3","1","2","3","1","2","3","1","2","3","1","2","3"],[1348.5051,1304.0702,1395.7714,2947.3097,2924.3988,2927.2867,4446.4036,4453.1066,4416.439,6235.1603,6207.3997,6266.6133,8173.0549,8141.1986,8106.2292]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>conc_Na<\/th>\n      <th>units<\/th>\n      <th>replicate<\/th>\n      <th>signal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":5},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="selecting-by-row-or-value" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Selecting by row or value</h2>
<p><code>filter()</code> allows up to subset our data based on observation (row) values.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="transform-dplyr-and-data-manipulation.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FAES, conc_Na <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   type  conc_Na units replicate signal
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
## 1 blank 0       mg/L  1          1349.
## 2 blank 0       mg/L  2          1304.
## 3 blank 0       mg/L  3          1396.</code></pre>
<p>Note how we need to pass logical operations to <code>filter()</code>. In the above code, we used <code>filter()</code> to get all rows where the concentration of sodium is equal to 0 (<code>== 0</code>). Note the presence of two equal signs (<code>==</code>). In R one equal sign (<code>=</code>) is used to pass an argument, two equal signs (<code>==</code>) is the logical operation “is equal” and is used to test equality (i.e. that both sides have the same value). A frequent mistake is to use <code>=</code> instead of <code>==</code> when testing for equality.</p>
<div id="logical-oeprators" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Logical oeprators</h3>
<p><code>filter()</code> can use other <em>relational</em> and <em>logical</em> operators, or combinations thereof, to improve your sub-setting. Relational operators compare values and logical operators carry out Boolean operations (TRUE or FALSE). Logical operators are used to combine multiple relational operators… let’s just list what they are and how we can use them:</p>
<table>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">&gt;</td>
<td align="left">relational</td>
<td align="left">Less than</td>
</tr>
<tr class="even">
<td align="left">&lt;</td>
<td align="left">relational</td>
<td align="left">Greater than</td>
</tr>
<tr class="odd">
<td align="left">&lt;=</td>
<td align="left">relational</td>
<td align="left">Less than or equal to</td>
</tr>
<tr class="even">
<td align="left">&gt;=</td>
<td align="left">relational</td>
<td align="left">Greater than or equal to</td>
</tr>
<tr class="odd">
<td align="left">==</td>
<td align="left">relational</td>
<td align="left">Equal to</td>
</tr>
<tr class="even">
<td align="left">!=</td>
<td align="left">relational</td>
<td align="left">Not equal to</td>
</tr>
<tr class="odd">
<td align="left">&amp;</td>
<td align="left">logical</td>
<td align="left">AND</td>
</tr>
<tr class="even">
<td align="left">!</td>
<td align="left">logical</td>
<td align="left">NOT</td>
</tr>
<tr class="odd">
<td align="left">|</td>
<td align="left">logical</td>
<td align="left">OR</td>
</tr>
<tr class="even">
<td align="left">is.na()</td>
<td align="left">function</td>
<td align="left">Checks for missing values, TRUE if NA</td>
</tr>
</tbody>
</table>
<ul>
<li>Selecting all signals below a threshold value</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="transform-dplyr-and-data-manipulation.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FAES, signal <span class="sc">&lt;</span> <span class="dv">4450</span>)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   type     conc_Na units replicate signal
##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
## 1 blank    0       mg/L  1          1349.
## 2 blank    0       mg/L  2          1304.
## 3 blank    0       mg/L  3          1396.
## 4 standard 0.1     mg/L  1          2947.
## 5 standard 0.1     mg/L  2          2924.
## 6 standard 0.1     mg/L  3          2927.
## 7 standard 0.2     mg/L  1          4446.
## 8 standard 0.2     mg/L  3          4416.</code></pre>
<ul>
<li>Selecting signals between values</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="transform-dplyr-and-data-manipulation.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FAES, signal <span class="sc">&gt;=</span> <span class="dv">4450</span> <span class="sc">&amp;</span> signal <span class="sc">&lt;</span> <span class="dv">8150</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   type     conc_Na units replicate signal
##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
## 1 standard 0.2     mg/L  2          4453.
## 2 standard 0.3     mg/L  1          6235.
## 3 standard 0.3     mg/L  2          6207.
## 4 standard 0.3     mg/L  3          6267.
## 5 standard 0.4     mg/L  2          8141.
## 6 standard 0.4     mg/L  3          8106.</code></pre>
<ul>
<li>Selecting all other replicates other than replicate <code>2</code></li>
</ul>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="transform-dplyr-and-data-manipulation.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FAES, replicate <span class="sc">!=</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    type     conc_Na units replicate signal
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 blank    0       mg/L  1          1349.
##  2 blank    0       mg/L  3          1396.
##  3 standard 0.1     mg/L  1          2947.
##  4 standard 0.1     mg/L  3          2927.
##  5 standard 0.2     mg/L  1          4446.
##  6 standard 0.2     mg/L  3          4416.
##  7 standard 0.3     mg/L  1          6235.
##  8 standard 0.3     mg/L  3          6267.
##  9 standard 0.4     mg/L  1          8173.
## 10 standard 0.4     mg/L  3          8106.</code></pre>
<ul>
<li>selecting the first standard replicate OR any of the blanks.</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="transform-dplyr-and-data-manipulation.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FAES, (type <span class="sc">==</span> <span class="st">&quot;standard&quot;</span> <span class="sc">&amp;</span> replicate <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|</span> (type <span class="sc">==</span> <span class="st">&quot;blank&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 7 x 5
##   type     conc_Na units replicate signal
##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
## 1 blank    0       mg/L  1          1349.
## 2 blank    0       mg/L  2          1304.
## 3 blank    0       mg/L  3          1396.
## 4 standard 0.1     mg/L  1          2947.
## 5 standard 0.2     mg/L  1          4446.
## 6 standard 0.3     mg/L  1          6235.
## 7 standard 0.4     mg/L  1          8173.</code></pre>
<ul>
<li>removing any missing values (<code>NA</code>) using <code>is.na()</code>. Note there are no missing values in our data set so nothing will be removed, if we removed the NOT operator (<code>!</code>) we would have selected all rows <em>with</em> missing values.</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="transform-dplyr-and-data-manipulation.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FAES, <span class="sc">!</span><span class="fu">is.na</span>(signal))</span></code></pre></div>
<pre><code>## # A tibble: 15 x 5
##    type     conc_Na units replicate signal
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 blank    0       mg/L  1          1349.
##  2 blank    0       mg/L  2          1304.
##  3 blank    0       mg/L  3          1396.
##  4 standard 0.1     mg/L  1          2947.
##  5 standard 0.1     mg/L  2          2924.
##  6 standard 0.1     mg/L  3          2927.
##  7 standard 0.2     mg/L  1          4446.
##  8 standard 0.2     mg/L  2          4453.
##  9 standard 0.2     mg/L  3          4416.
## 10 standard 0.3     mg/L  1          6235.
## 11 standard 0.3     mg/L  2          6207.
## 12 standard 0.3     mg/L  3          6267.
## 13 standard 0.4     mg/L  1          8173.
## 14 standard 0.4     mg/L  2          8141.
## 15 standard 0.4     mg/L  3          8106.</code></pre>
<p>These are just some examples, but you can combine the logical operators in any way that works for you. Likewise, there are multiple combinations that will yield the same result, it’s up to you do figure out which works best for you.</p>
</div>
</div>
<div id="arranging-rows" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Arranging rows</h2>
<p><code>arrange()</code> simple reorders the rows based on the value you passed to it. By default it arranges the specified values into ascending order. Let’s arrange our signal in increasing by increasing order:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="transform-dplyr-and-data-manipulation.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>( FAES, signal)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 5
##    type     conc_Na units replicate signal
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 blank    0       mg/L  2          1304.
##  2 blank    0       mg/L  1          1349.
##  3 blank    0       mg/L  3          1396.
##  4 standard 0.1     mg/L  2          2924.
##  5 standard 0.1     mg/L  3          2927.
##  6 standard 0.1     mg/L  1          2947.
##  7 standard 0.2     mg/L  3          4416.
##  8 standard 0.2     mg/L  1          4446.
##  9 standard 0.2     mg/L  2          4453.
## 10 standard 0.3     mg/L  2          6207.
## 11 standard 0.3     mg/L  1          6235.
## 12 standard 0.3     mg/L  3          6267.
## 13 standard 0.4     mg/L  3          8106.
## 14 standard 0.4     mg/L  2          8141.
## 15 standard 0.4     mg/L  1          8173.</code></pre>
<p>Since our original <code>FAES</code> data is already arranged by increasing <code>cong_Na</code> and <code>replicate</code>, let’s inverse that order by arranging <code>conc_Na</code> into descending order using the <code>desc()</code> function BUT arrange the <code>signal</code> values in:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="transform-dplyr-and-data-manipulation.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the order of precedence</span></span>
<span id="cb94-2"><a href="transform-dplyr-and-data-manipulation.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(FAES, <span class="fu">desc</span>(conc_Na), signal)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 5
##    type     conc_Na units replicate signal
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 standard 0.4     mg/L  3          8106.
##  2 standard 0.4     mg/L  2          8141.
##  3 standard 0.4     mg/L  1          8173.
##  4 standard 0.3     mg/L  2          6207.
##  5 standard 0.3     mg/L  1          6235.
##  6 standard 0.3     mg/L  3          6267.
##  7 standard 0.2     mg/L  3          4416.
##  8 standard 0.2     mg/L  1          4446.
##  9 standard 0.2     mg/L  2          4453.
## 10 standard 0.1     mg/L  2          2924.
## 11 standard 0.1     mg/L  3          2927.
## 12 standard 0.1     mg/L  1          2947.
## 13 blank    0       mg/L  2          1304.
## 14 blank    0       mg/L  1          1349.
## 15 blank    0       mg/L  3          1396.</code></pre>
<p>Just note with <code>arrange()</code> that <code>NA</code> values will always be placed at the bottom, whether you use <code>desc()</code> or not.</p>
</div>
<div id="selecting-by-column-or-variable" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Selecting by column or variable</h2>
<p><code>select()</code> allows you to readily select columns by name. Note however that it will always return a tibble, even if you only select one variable/column.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="transform-dplyr-and-data-manipulation.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(FAES, signal)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 1
##    signal
##     &lt;dbl&gt;
##  1  1349.
##  2  1304.
##  3  1396.
##  4  2947.
##  5  2924.
##  6  2927.
##  7  4446.
##  8  4453.
##  9  4416.
## 10  6235.
## 11  6207.
## 12  6267.
## 13  8173.
## 14  8141.
## 15  8106.</code></pre>
<p>You can also select multiple columns using the same helper functions describes in <a href="importing-data-into-r.html#importing-data-into-r">Importing data into R</a>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="transform-dplyr-and-data-manipulation.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(FAES, conc_Na<span class="sc">:</span>replicate)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 3
##    conc_Na units replicate
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    
##  1 0       mg/L  1        
##  2 0       mg/L  2        
##  3 0       mg/L  3        
##  4 0.1     mg/L  1        
##  5 0.1     mg/L  2        
##  6 0.1     mg/L  3        
##  7 0.2     mg/L  1        
##  8 0.2     mg/L  2        
##  9 0.2     mg/L  3        
## 10 0.3     mg/L  1        
## 11 0.3     mg/L  2        
## 12 0.3     mg/L  3        
## 13 0.4     mg/L  1        
## 14 0.4     mg/L  2        
## 15 0.4     mg/L  3</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="transform-dplyr-and-data-manipulation.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting columns containing the character &quot;p&quot;</span></span>
<span id="cb100-2"><a href="transform-dplyr-and-data-manipulation.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(FAES, <span class="fu">contains</span>(<span class="st">&quot;p&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 15 x 2
##    type     replicate
##    &lt;chr&gt;    &lt;chr&gt;    
##  1 blank    1        
##  2 blank    2        
##  3 blank    3        
##  4 standard 1        
##  5 standard 2        
##  6 standard 3        
##  7 standard 1        
##  8 standard 2        
##  9 standard 3        
## 10 standard 1        
## 11 standard 2        
## 12 standard 3        
## 13 standard 1        
## 14 standard 2        
## 15 standard 3</code></pre>
</div>
<div id="adding-new-variables" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Adding new variables</h2>
<p><code>mutate()</code> allows you to add new variable (read columns) to your existing data set. It’ll probably be the workhorse function you’ll use during your data transformation as you can readily pass other functions and mathematical operators to it to transform your data. let’s suppose that our standards were diluted by a factor of 10, we can add a new column for this:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="transform-dplyr-and-data-manipulation.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(FAES, <span class="st">&quot;dil_fct&quot;</span> <span class="ot">=</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 6
##    type     conc_Na units replicate signal dil_fct
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 blank    0       mg/L  1          1349.      10
##  2 blank    0       mg/L  2          1304.      10
##  3 blank    0       mg/L  3          1396.      10
##  4 standard 0.1     mg/L  1          2947.      10
##  5 standard 0.1     mg/L  2          2924.      10
##  6 standard 0.1     mg/L  3          2927.      10
##  7 standard 0.2     mg/L  1          4446.      10
##  8 standard 0.2     mg/L  2          4453.      10
##  9 standard 0.2     mg/L  3          4416.      10
## 10 standard 0.3     mg/L  1          6235.      10
## 11 standard 0.3     mg/L  2          6207.      10
## 12 standard 0.3     mg/L  3          6267.      10
## 13 standard 0.4     mg/L  1          8173.      10
## 14 standard 0.4     mg/L  2          8141.      10
## 15 standard 0.4     mg/L  3          8106.      10</code></pre>
<p>We can also create multiple columns in the same <code>mutate()</code> call:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="transform-dplyr-and-data-manipulation.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(FAES, <span class="st">&quot;dil_fct&quot;</span> <span class="ot">=</span> <span class="dv">10</span>, <span class="st">&quot;adj_signal&quot;</span> <span class="ot">=</span> signal <span class="sc">*</span> dil_fct)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 7
##    type     conc_Na units replicate signal dil_fct adj_signal
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1 blank    0       mg/L  1          1349.      10     13485.
##  2 blank    0       mg/L  2          1304.      10     13041.
##  3 blank    0       mg/L  3          1396.      10     13958.
##  4 standard 0.1     mg/L  1          2947.      10     29473.
##  5 standard 0.1     mg/L  2          2924.      10     29244.
##  6 standard 0.1     mg/L  3          2927.      10     29273.
##  7 standard 0.2     mg/L  1          4446.      10     44464.
##  8 standard 0.2     mg/L  2          4453.      10     44531.
##  9 standard 0.2     mg/L  3          4416.      10     44164.
## 10 standard 0.3     mg/L  1          6235.      10     62352.
## 11 standard 0.3     mg/L  2          6207.      10     62074.
## 12 standard 0.3     mg/L  3          6267.      10     62666.
## 13 standard 0.4     mg/L  1          8173.      10     81731.
## 14 standard 0.4     mg/L  2          8141.      10     81412.
## 15 standard 0.4     mg/L  3          8106.      10     81062.</code></pre>
<p>Couple of things to note:</p>
<ol style="list-style-type: decimal">
<li>The variable we’re creating needs to be in quotation marks, hence <code>"dil_fct"</code> for our dilution factor variable</li>
<li>the variables we’re referencing do not need to be in quotation marks; hence <code>signal</code> because this variable already exist.</li>
<li>Note the order of precedence: <code>dil_fct</code> is created first so we can reference in the second argument, we would get an error if we swapped the order.</li>
</ol>
<div id="useful-mutate-function" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Useful mutate function</h3>
<p>There are a myriad of functions you can make use of with the mutate function. Here are some of the mathematical operators available in R:</p>
<table>
<thead>
<tr class="header">
<th align="left">function.</th>
<th align="left">definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">+</td>
<td align="left">additon</td>
</tr>
<tr class="even">
<td align="left">-</td>
<td align="left">subtraction</td>
</tr>
<tr class="odd">
<td align="left">*</td>
<td align="left">multiplication</td>
</tr>
<tr class="even">
<td align="left">/</td>
<td align="left">division</td>
</tr>
<tr class="odd">
<td align="left">^</td>
<td align="left">exponent; to the power off…</td>
</tr>
<tr class="even">
<td align="left">log()</td>
<td align="left">returns the specified base-log; see also log10() and log2()</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="group-and-summarize-data" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Group and summarize data</h2>
<p><code>summarize</code> effectively summarized your data based on functions you’ve passed to it. Looking at our <code>FAES</code> data we’d probably want the mean of the triplicate signals, alongside the standard deviation. Let’s see what happens when we apply the summarize function straight up:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="transform-dplyr-and-data-manipulation.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(FAES, <span class="st">&quot;mean&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(signal), <span class="st">&quot;stdDev&quot;</span> <span class="ot">=</span> <span class="fu">sd</span>(signal))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    mean stdDev
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1 4620.  2475.</code></pre>
<p>This doesn’t look like what we wanted. What we got was the mean and standard deviation of <em>all</em> of the signals, regardless of the concentration of the standard. Also note how we’ve lost the other columns/variables and are only left with the mean and stdDev. This is all because we need to <strong>group</strong> our observations by a variable. We can do this by using the <code>group_by()</code> function.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="transform-dplyr-and-data-manipulation.html#cb108-1" aria-hidden="true" tabindex="-1"></a>groupedFAES <span class="ot">&lt;-</span> <span class="fu">group_by</span>(FAES, type, conc_Na)</span>
<span id="cb108-2"><a href="transform-dplyr-and-data-manipulation.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(groupedFAES, <span class="st">&quot;mean&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(signal), <span class="st">&quot;stdDev&quot;</span> <span class="ot">=</span> <span class="fu">sd</span>(signal))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;type&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 5 x 4
## # Groups:   type [2]
##   type     conc_Na  mean stdDev
##   &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 blank    0       1349.   45.9
## 2 standard 0.1     2933.   12.5
## 3 standard 0.2     4439.   19.5
## 4 standard 0.3     6236.   29.6
## 5 standard 0.4     8140.   33.4</code></pre>
<p>Here we’ve created a new data set, <code>groupedFAES</code>, that we grouped by the variables <code>type</code> and <code>conc_Na</code> so we could get the mean and standard deviation of each group. Note the multiple levels of grouping. For this data set we could have omitted the <code>type</code> variable, but in larger datasets you may have multiple groupings (i.e. from different location), so you can group by multiple variables to get smaller groups.</p>
<div id="useful-summarize-functions" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Useful summarize functions</h3>
<p>We’ve used the <code>mean()</code> and <code>sd()</code> functions above, but there are a host of other useful functions you can use in conjunction with summarize. See <strong>Useful Functions</strong> in the <code>summarise()</code> documentation (enter <code>?summarise</code>) in the console.</p>
</div>
</div>
<div id="the-pipe-chaining-functions-together" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> The pipe: chaining functions together</h2>
<p>With the tools presented here we could do a decent job analyzing our <code>FAES</code> data. Let’s say we wanted to subtract the mean of the <code>blank</code> from each <code>standard</code> signal and then get summarize those results. It would look something like this:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="transform-dplyr-and-data-manipulation.html#cb111-1" aria-hidden="true" tabindex="-1"></a>blank <span class="ot">&lt;-</span> <span class="fu">filter</span>(FAES, type <span class="sc">==</span> <span class="st">&quot;blank&quot;</span>)</span>
<span id="cb111-2"><a href="transform-dplyr-and-data-manipulation.html#cb111-2" aria-hidden="true" tabindex="-1"></a>meanBlank <span class="ot">&lt;-</span> <span class="fu">summarize</span>(blank, <span class="fu">mean</span>(signal))</span>
<span id="cb111-3"><a href="transform-dplyr-and-data-manipulation.html#cb111-3" aria-hidden="true" tabindex="-1"></a>meanBlank <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(meanBlank)</span>
<span id="cb111-4"><a href="transform-dplyr-and-data-manipulation.html#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="transform-dplyr-and-data-manipulation.html#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The mean signal from the blank triplicate is:&quot;</span>, meanBlank)</span></code></pre></div>
<pre><code>## [1] &quot;The mean signal from the blank triplicate is: 1349.4489&quot;</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="transform-dplyr-and-data-manipulation.html#cb113-1" aria-hidden="true" tabindex="-1"></a>stds_1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(FAES, type <span class="sc">==</span> <span class="st">&quot;standard&quot;</span>)</span>
<span id="cb113-2"><a href="transform-dplyr-and-data-manipulation.html#cb113-2" aria-hidden="true" tabindex="-1"></a>stds_2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(stds_1, <span class="st">&quot;cor_sig&quot;</span> <span class="ot">=</span> signal <span class="sc">-</span> meanBlank)</span>
<span id="cb113-3"><a href="transform-dplyr-and-data-manipulation.html#cb113-3" aria-hidden="true" tabindex="-1"></a>stds_3 <span class="ot">&lt;-</span> <span class="fu">group_by</span>(stds_2, conc_Na)</span>
<span id="cb113-4"><a href="transform-dplyr-and-data-manipulation.html#cb113-4" aria-hidden="true" tabindex="-1"></a>stds_4 <span class="ot">&lt;-</span> <span class="fu">summarize</span>(stds_3, <span class="st">&quot;mean&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(cor_sig), <span class="st">&quot;stdDev&quot;</span> <span class="ot">=</span> <span class="fu">sd</span>(cor_sig))</span>
<span id="cb113-5"><a href="transform-dplyr-and-data-manipulation.html#cb113-5" aria-hidden="true" tabindex="-1"></a>stds_4</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   conc_Na  mean stdDev
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.1     1584.   12.5
## 2 0.2     3089.   19.5
## 3 0.3     4887.   29.6
## 4 0.4     6791.   33.4</code></pre>
<p>While the code above did it’s job, it’s certainly wasn’t easy to type and certainly not easy to read. At every step of the way we’ve saved our updated data outputs to a new variable (<code>stds_1</code>, <code>stds_2</code>, etc.). However, most of these intermediates aren’t important, and moreover the repetitive names clutter our code. As the code above is written, we’ve had to pay special attending to the variable suffix to make sure we’re calling the correct data set as our code has progresses. An alternative would be to reassign the outputs back to the original variable name (i.e. <code>stds_1 &lt;- mutate(stds_1, ...)</code>), but that doesn’t solve the issue of readability as there’s still redundant assigning.</p>
<p>A solution for this is the pipe operator <code>%&gt;%</code> ( pronounced “then”), an incredibly useful tool for writing more legible and understandable code. The pipe basically changes how you read code to emphasize the functions you’re working with by passing the intermediate steps to hidden processes in the background. Re-writing the code above, we’d get something like:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="transform-dplyr-and-data-manipulation.html#cb115-1" aria-hidden="true" tabindex="-1"></a>meanBlank <span class="ot">&lt;-</span> FAES <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="transform-dplyr-and-data-manipulation.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span><span class="st">&quot;blank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="transform-dplyr-and-data-manipulation.html#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(signal)) <span class="sc">%&gt;%</span></span>
<span id="cb115-4"><a href="transform-dplyr-and-data-manipulation.html#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb115-5"><a href="transform-dplyr-and-data-manipulation.html#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="transform-dplyr-and-data-manipulation.html#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The mean signal from the blank triplicate is:&quot;</span>, meanBlank)</span></code></pre></div>
<pre><code>## [1] &quot;The mean signal from the blank triplicate is: 1349.4489&quot;</code></pre>
<p>Things may look a bit different, but our underlying code hasn’t changed much. What’s happening is the pipe operator passes the output to the first argument of the next function. So the output of <code>filter...</code> is passed to the first argument of <code>sumamrise...</code>, and the argument we specified in <code>summarise</code> is actually the <em>second</em> argument it receives. You’re probably wondering how hiding stuff makes your code more legible, but think of <code>%&gt;%</code> as being equivalent to “then.” We can read our code as:</p>
<blockquote>
<p>“Take the <code>FAES</code> dataset, <em>then</em> filter for <code>type == "blank"</code> <em>then</em> collapse the dataset to the mean <code>signal</code> value and <em>then</em> convert to numeric value <em>then</em> pass this final output to the new variable <code>meanBlank</code>.”</p>
</blockquote>
<p>Not only is the pipe less typing, but the emphasis is on the functions so you can better understand what you’re doing vs. where all the intermediates are going. Extending our piping to the second batch of code we get:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="transform-dplyr-and-data-manipulation.html#cb117-1" aria-hidden="true" tabindex="-1"></a>stds <span class="ot">&lt;-</span> FAES <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="transform-dplyr-and-data-manipulation.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;standard&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="transform-dplyr-and-data-manipulation.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;cor_sig&quot;</span> <span class="ot">=</span> signal <span class="sc">-</span> meanBlank) <span class="sc">%&gt;%</span> </span>
<span id="cb117-4"><a href="transform-dplyr-and-data-manipulation.html#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(conc_Na) <span class="sc">%&gt;%</span></span>
<span id="cb117-5"><a href="transform-dplyr-and-data-manipulation.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">&quot;mean&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(cor_sig), <span class="st">&quot;stdDev&quot;</span> <span class="ot">=</span> <span class="fu">sd</span>(cor_sig))</span>
<span id="cb117-6"><a href="transform-dplyr-and-data-manipulation.html#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="transform-dplyr-and-data-manipulation.html#cb117-7" aria-hidden="true" tabindex="-1"></a>stds</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   conc_Na  mean stdDev
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.1     1584.   12.5
## 2 0.2     3089.   19.5
## 3 0.3     4887.   29.6
## 4 0.4     6791.   33.4</code></pre>
<p>Same thing. The underlying code hasn’t changed much, but it’s much more legible and we can clearly see we’re subtracting the <code>meanBlank</code> value from each measured signal then summarizing the corrected signals.</p>
<div id="notes-on-piping" class="section level3" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> Notes on piping</h3>
<p>The pipe is great and especially useful with <em>tidyverse</em> packages, but it does have some limitations:</p>
<ul>
<li>You can’t easily extract intermediate steps. So you’ll need to break up your pipping chain to output any intermediate steps you can.</li>
<li>The benefit of piping is legibility; this goes away as you increase the number of steps as you lose track of what’s going on. Keep the piping short and thematically similar.</li>
<li>Pipes are linear, if you have multiple inputs or outputs you should consider an alternative approach.</li>
</ul>
</div>
</div>
<div id="further-reading-3" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Further reading</h2>
<ul>
<li><a href="https://r4ds.had.co.nz/transform.html">Chapter 5: Data Transformation</a> of <em>R for Data Science</em> for a deeper breakdown of <code>dplyr</code> and it’s functionality.</li>
<li><a href="https://r4ds.had.co.nz/pipes.html">Chapter 18: Pipes</a> of <em>R for Data Science</em> for more information on pipes.</li>
<li><a href="https://tavareshugo.github.io/data_carpentry_extras/base-r_tidyverse_equivalents/base-r_tidyverse_equivalents.html">Syntax equivalents: base R vs Tidyverse</a> by Hugo Taveres for a comparison of base-R solutions to tidyverse. This entire book is largely biased towards tidyverse solutions, but there’s no denying that certain base-R can be more elegant. Check out this write up to get a better idea.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidying-your-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="programming-with-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DavidRossHall/R4EnvChem/transform-1.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R4EnvChem.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Linear Regression Redux | R for Environmental Chemists</title>
  <meta name="description" content="This is a proof-of-concept for a further full length textbook." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Linear Regression Redux | R for Environmental Chemists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://davidrosshall.github.io/R4EnvChem/" />
  
  <meta property="og:description" content="This is a proof-of-concept for a further full length textbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Linear Regression Redux | R for Environmental Chemists" />
  
  <meta name="twitter:description" content="This is a proof-of-concept for a further full length textbook." />
  

<meta name="author" content="David Hall, Steven Kutarna, Kristen Yeh, Hui Peng and Jessica D’eon" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="choosing-visualizations.html"/>
<link rel="next" href="non-linear-logistic-regression-modelling.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Environmental Chemistry</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
</ul></li>
<li class="part"><span><b>Section 1: Getting Setup in R</b></span></li>
<li class="chapter" data-level="1" data-path="installing-r.html"><a href="installing-r.html"><i class="fa fa-check"></i><b>1</b> Installing R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installing-r.html"><a href="installing-r.html#prerequisite-software"><i class="fa fa-check"></i><b>1.1</b> Prerequisite software</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="installing-r.html"><a href="installing-r.html#r"><i class="fa fa-check"></i><b>1.1.1</b> R</a></li>
<li class="chapter" data-level="1.1.2" data-path="installing-r.html"><a href="installing-r.html#downloading-rstudio-ide"><i class="fa fa-check"></i><b>1.1.2</b> Downloading RStudio IDE</a></li>
<li class="chapter" data-level="1.1.3" data-path="installing-r.html"><a href="installing-r.html#installing-packages"><i class="fa fa-check"></i><b>1.1.3</b> Installing packages</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="installing-r.html"><a href="installing-r.html#running-r-code"><i class="fa fa-check"></i><b>1.2</b> Running R Code</a></li>
<li class="chapter" data-level="1.3" data-path="installing-r.html"><a href="installing-r.html#customizing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Customizing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="installing-r.html"><a href="installing-r.html#where-to-get-help"><i class="fa fa-check"></i><b>1.4</b> Where to get help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="r-coding-basics.html"><a href="r-coding-basics.html"><i class="fa fa-check"></i><b>2</b> R coding basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#variables"><i class="fa fa-check"></i><b>2.1</b> Variables</a></li>
<li class="chapter" data-level="2.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-types"><i class="fa fa-check"></i><b>2.2</b> Data Types</a></li>
<li class="chapter" data-level="2.3" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-structures"><i class="fa fa-check"></i><b>2.3</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#other-data-structures"><i class="fa fa-check"></i><b>2.3.1</b> Other data structures</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="r-coding-basics.html"><a href="r-coding-basics.html#r-packages-and-functions"><i class="fa fa-check"></i><b>2.4</b> R packages and functions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#ggplot2"><i class="fa fa-check"></i><b>2.4.1</b> ggplot2</a></li>
<li class="chapter" data-level="2.4.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#function-documentation"><i class="fa fa-check"></i><b>2.4.2</b> Function Documentation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="working-with-r.html"><a href="working-with-r.html"><i class="fa fa-check"></i><b>3</b> Working with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="working-with-r.html"><a href="working-with-r.html#paths-and-directories"><i class="fa fa-check"></i><b>3.1</b> Paths and directories</a></li>
<li class="chapter" data-level="3.2" data-path="working-with-r.html"><a href="working-with-r.html#creating-an-rstudio-project"><i class="fa fa-check"></i><b>3.2</b> Creating an RStudio project</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="working-with-r.html"><a href="working-with-r.html#the-value-of-r-projects"><i class="fa fa-check"></i><b>3.2.1</b> The value of R projects</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="working-with-r.html"><a href="working-with-r.html#workspace-and-whats-real"><i class="fa fa-check"></i><b>3.3</b> Workspace and what’s real</a></li>
<li class="chapter" data-level="3.4" data-path="working-with-r.html"><a href="working-with-r.html#saving-r-scripts"><i class="fa fa-check"></i><b>3.4</b> Saving R scripts</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="working-with-r.html"><a href="working-with-r.html#what-should-i-save"><i class="fa fa-check"></i><b>3.4.1</b> What should I save?</a></li>
<li class="chapter" data-level="3.4.2" data-path="working-with-r.html"><a href="working-with-r.html#saving-objects"><i class="fa fa-check"></i><b>3.4.2</b> Saving objects</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="working-with-r.html"><a href="working-with-r.html#script-formatting"><i class="fa fa-check"></i><b>3.5</b> Script formatting</a></li>
<li class="chapter" data-level="3.6" data-path="working-with-r.html"><a href="working-with-r.html#viewing-data-and-code-simultaneously"><i class="fa fa-check"></i><b>3.6</b> Viewing data and code simultaneously</a></li>
<li class="chapter" data-level="3.7" data-path="working-with-r.html"><a href="working-with-r.html#troubleshooting-error-messages"><i class="fa fa-check"></i><b>3.7</b> Troubleshooting error messages</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="working-with-r.html"><a href="working-with-r.html#script-diagnostics"><i class="fa fa-check"></i><b>3.7.1</b> Script diagnostics</a></li>
<li class="chapter" data-level="3.7.2" data-path="working-with-r.html"><a href="working-with-r.html#reading-error-codes"><i class="fa fa-check"></i><b>3.7.2</b> Reading error codes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="using-r-markdown.html"><a href="using-r-markdown.html"><i class="fa fa-check"></i><b>4</b> Using R Markdown</a>
<ul>
<li class="chapter" data-level="4.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#deeper-look-into-rmarkdown"><i class="fa fa-check"></i><b>4.1</b> Deeper look into rmarkdown</a></li>
<li class="chapter" data-level="4.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#getting-started-with-rmarkdown"><i class="fa fa-check"></i><b>4.2</b> Getting started with rmarkdown</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#understanding-rmarkdown"><i class="fa fa-check"></i><b>4.2.1</b> Understanding rmarkdown</a></li>
<li class="chapter" data-level="4.2.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#runnign-code-in-rmarkdown"><i class="fa fa-check"></i><b>4.2.2</b> Runnign code in rmarkdown</a></li>
<li class="chapter" data-level="4.2.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#generating-final-report"><i class="fa fa-check"></i><b>4.2.3</b> Generating final report</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#so-now-what-do-i-do-with-r-markdown"><i class="fa fa-check"></i><b>4.3</b> So now what do I do with R Markdown?</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-resources-and-further-reading"><i class="fa fa-check"></i><b>4.3.1</b> R Markdown resources and further reading</a></li>
<li class="chapter" data-level="4.3.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-code-chunk-options"><i class="fa fa-check"></i><b>4.3.2</b> R code chunk options</a></li>
<li class="chapter" data-level="4.3.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#inserting-images"><i class="fa fa-check"></i><b>4.3.3</b> Inserting images</a></li>
<li class="chapter" data-level="4.3.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#generating-tables"><i class="fa fa-check"></i><b>4.3.4</b> Generating Tables</a></li>
<li class="chapter" data-level="4.3.5" data-path="using-r-markdown.html"><a href="using-r-markdown.html#spellcheck-in-r-markdown"><i class="fa fa-check"></i><b>4.3.5</b> Spellcheck in R Markdown</a></li>
<li class="chapter" data-level="4.3.6" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-syntax"><i class="fa fa-check"></i><b>4.3.6</b> R markdown syntax</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="r-tutorial-exercise.html"><a href="r-tutorial-exercise.html"><i class="fa fa-check"></i><b>5</b> R Tutorial Exercise</a>
<ul>
<li class="chapter" data-level="5.1" data-path="r-tutorial-exercise.html"><a href="r-tutorial-exercise.html#expected-outcome"><i class="fa fa-check"></i><b>5.1</b> Expected outcome</a></li>
</ul></li>
<li class="part"><span><b>Section 2: Data Analysis in R</b></span></li>
<li class="chapter" data-level="6" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html"><i class="fa fa-check"></i><b>6</b> Intro to Data Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#further-reading"><i class="fa fa-check"></i><b>6.1</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html"><i class="fa fa-check"></i><b>7</b> Importing data into R</a>
<ul>
<li class="chapter" data-level="7.1" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#how-data-is-stored"><i class="fa fa-check"></i><b>7.1</b> How data is stored</a></li>
<li class="chapter" data-level="7.2" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#read_csv"><i class="fa fa-check"></i><b>7.2</b> read_csv</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#tibbles-vs.-data-frames"><i class="fa fa-check"></i><b>7.2.1</b> Tibbles vs. data frames</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#importing-other-data-types"><i class="fa fa-check"></i><b>7.3</b> Importing other data types</a></li>
<li class="chapter" data-level="7.4" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#saving-data"><i class="fa fa-check"></i><b>7.4</b> Saving data</a></li>
<li class="chapter" data-level="7.5" data-path="importing-data-into-r.html"><a href="importing-data-into-r.html#further-reading-1"><i class="fa fa-check"></i><b>7.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tidying-your-data.html"><a href="tidying-your-data.html"><i class="fa fa-check"></i><b>8</b> Tidying your data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#what-is-tidy-data"><i class="fa fa-check"></i><b>8.1</b> What is tidy data?</a></li>
<li class="chapter" data-level="8.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tools-to-tidy-your-data"><i class="fa fa-check"></i><b>8.2</b> Tools to tidy your data</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#making-data-longer"><i class="fa fa-check"></i><b>8.2.1</b> Making data ‘longer’</a></li>
<li class="chapter" data-level="8.2.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#making-data-wider"><i class="fa fa-check"></i><b>8.2.2</b> Making data ‘wider’</a></li>
<li class="chapter" data-level="8.2.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#seperating-columns"><i class="fa fa-check"></i><b>8.2.3</b> Seperating columns</a></li>
<li class="chapter" data-level="8.2.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#unitingcombining-columns"><i class="fa fa-check"></i><b>8.2.4</b> Uniting/combining columns</a></li>
<li class="chapter" data-level="8.2.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#renaming-columnsheaders"><i class="fa fa-check"></i><b>8.2.5</b> Renaming columns/headers</a></li>
<li class="chapter" data-level="8.2.6" data-path="tidying-your-data.html"><a href="tidying-your-data.html#rounding-numbers"><i class="fa fa-check"></i><b>8.2.6</b> Rounding numbers</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tips-for-recording-data"><i class="fa fa-check"></i><b>8.3</b> Tips for recording data</a></li>
<li class="chapter" data-level="8.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#further-reading-2"><i class="fa fa-check"></i><b>8.4</b> Further reading</a></li>
<li class="chapter" data-level="8.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#chapter-references"><i class="fa fa-check"></i><b>8.5</b> Chapter References</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html"><i class="fa fa-check"></i><b>9</b> Transform: dplyr and data manipulation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#selecting-by-row-or-value"><i class="fa fa-check"></i><b>9.1</b> Selecting by row or value</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#logical-oeprators"><i class="fa fa-check"></i><b>9.1.1</b> Logical oeprators</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#arranging-rows"><i class="fa fa-check"></i><b>9.2</b> Arranging rows</a></li>
<li class="chapter" data-level="9.3" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#selecting-by-column-or-variable"><i class="fa fa-check"></i><b>9.3</b> Selecting by column or variable</a></li>
<li class="chapter" data-level="9.4" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#adding-new-variables"><i class="fa fa-check"></i><b>9.4</b> Adding new variables</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#useful-mutate-function"><i class="fa fa-check"></i><b>9.4.1</b> Useful mutate function</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#group-and-summarize-data"><i class="fa fa-check"></i><b>9.5</b> Group and summarize data</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#useful-summarize-functions"><i class="fa fa-check"></i><b>9.5.1</b> Useful summarize functions</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#the-pipe-chaining-functions-together"><i class="fa fa-check"></i><b>9.6</b> The pipe: chaining functions together</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#notes-on-piping"><i class="fa fa-check"></i><b>9.6.1</b> Notes on piping</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="transform-dplyr-and-data-manipulation.html"><a href="transform-dplyr-and-data-manipulation.html#further-reading-3"><i class="fa fa-check"></i><b>9.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="programming-with-r.html"><a href="programming-with-r.html"><i class="fa fa-check"></i><b>10</b> Programming with R</a>
<ul>
<li class="chapter" data-level="10.1" data-path="programming-with-r.html"><a href="programming-with-r.html#functions"><i class="fa fa-check"></i><b>10.1</b> Functions</a></li>
<li class="chapter" data-level="10.2" data-path="programming-with-r.html"><a href="programming-with-r.html#conditional-arguments"><i class="fa fa-check"></i><b>10.2</b> Conditional arguments</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="programming-with-r.html"><a href="programming-with-r.html#piping-conditional-statements"><i class="fa fa-check"></i><b>10.2.1</b> Piping conditional statements</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="programming-with-r.html"><a href="programming-with-r.html#when-to-use-functions"><i class="fa fa-check"></i><b>10.3</b> When to use functions</a></li>
<li class="chapter" data-level="10.4" data-path="programming-with-r.html"><a href="programming-with-r.html#further-reading-4"><i class="fa fa-check"></i><b>10.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>11</b> Modelling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="modelling.html"><a href="modelling.html#base-r-linear-model"><i class="fa fa-check"></i><b>11.1</b> Base R Linear Model</a></li>
<li class="chapter" data-level="11.2" data-path="modelling.html"><a href="modelling.html#cleaning-up-model-ouputs"><i class="fa fa-check"></i><b>11.2</b> Cleaning up model ouputs</a></li>
<li class="chapter" data-level="11.3" data-path="modelling.html"><a href="modelling.html#further-reading-5"><i class="fa fa-check"></i><b>11.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="visualizations.html"><a href="visualizations.html"><i class="fa fa-check"></i><b>12</b> Visualizations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="visualizations.html"><a href="visualizations.html#building-plots-ups"><i class="fa fa-check"></i><b>12.1</b> Building plots ups</a></li>
<li class="chapter" data-level="12.2" data-path="visualizations.html"><a href="visualizations.html#basic-plotting"><i class="fa fa-check"></i><b>12.2</b> Basic plotting</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="visualizations.html"><a href="visualizations.html#changing-plot-labels"><i class="fa fa-check"></i><b>12.2.1</b> Changing plot labels</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="visualizations.html"><a href="visualizations.html#further-reading-6"><i class="fa fa-check"></i><b>12.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>13</b> Communication</a></li>
<li class="part"><span><b>Section 3: Data Analysis Toolbox</b></span></li>
<li class="chapter" data-level="14" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>14</b> Introduction</a></li>
<li class="chapter" data-level="15" data-path="choosing-visualizations.html"><a href="choosing-visualizations.html"><i class="fa fa-check"></i><b>15</b> Choosing Visualizations</a></li>
<li class="chapter" data-level="16" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html"><i class="fa fa-check"></i><b>16</b> Linear Regression Redux</a>
<ul>
<li class="chapter" data-level="16.1" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#importing-and-tidying-data"><i class="fa fa-check"></i><b>16.1</b> Importing and tidying data</a></li>
<li class="chapter" data-level="16.2" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#normalizing-qqq-data"><i class="fa fa-check"></i><b>16.2</b> Normalizing QQQ Data</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#assessing-internal-stds"><i class="fa fa-check"></i><b>16.2.1</b> Assessing Internal Stds</a></li>
<li class="chapter" data-level="16.2.2" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#normalizing-peak-areas"><i class="fa fa-check"></i><b>16.2.2</b> Normalizing peak areas</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#calculating-calibration-curves"><i class="fa fa-check"></i><b>16.3</b> Calculating Calibration Curves</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#plotting-regression-curves"><i class="fa fa-check"></i><b>16.3.1</b> Plotting regression curves</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="linear-regression-redux.html"><a href="linear-regression-redux.html#quantifying-sample-concentrations"><i class="fa fa-check"></i><b>16.4</b> Quantifying sample concentrations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html"><i class="fa fa-check"></i><b>17</b> Non-linear Logistic Regression Modelling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#visually-inspecting-our-data"><i class="fa fa-check"></i><b>17.1</b> Visually inspecting our data</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#annotating-maximal-values"><i class="fa fa-check"></i><b>17.1.1</b> Annotating maximal values</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#extracting-maximal-values"><i class="fa fa-check"></i><b>17.2</b> Extracting maximal values</a></li>
<li class="chapter" data-level="17.3" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#modelling-sigmoidal-curve"><i class="fa fa-check"></i><b>17.3</b> Modelling Sigmoidal Curve</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#calculating-logistic-regression"><i class="fa fa-check"></i><b>17.3.1</b> Calculating Logistic Regression</a></li>
<li class="chapter" data-level="17.3.2" data-path="non-linear-logistic-regression-modelling.html"><a href="non-linear-logistic-regression-modelling.html#extracting-model-parameters"><i class="fa fa-check"></i><b>17.3.2</b> Extracting model parameters</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Environmental Chemists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression-redux" class="section level1" number="16">
<h1><span class="header-section-number">Chapter 16</span> Linear Regression Redux</h1>
<p><strong>Note this needs to be cut up and reformated to elaborate more on the theory behind linear regression. - DH</strong></p>
<p><em>Note I didn’t actually take the CHM410 course, so Jess will need to review this part. As well, i expect this entire chapter will get chopped up in later drafts of the book. As well, will review modelling stuff to find an easier pay. Probably with purrr and what not. -DH</em></p>
<p>Sample prep is only half the fun when it comes to environmental chemistry. Eventually you’ll want to quantify what’s in your samples and to do that you’ll need to construct calibration curves. This write up will use previously acquired triple-quadrupole LC-MS (hence <em>QQQ</em>) results from the 2019 CHM410 Field trip. This fieldtrip data is comprised of three datasets: <code>lab4_biota.csv</code> with the sampling information for biological samples, <code>liab4_sediment.csv</code> for sediment sampling information, and <code>lab4_qqq.csv</code> with the integrated peak areas of every analyzed sample and calibration standard. For this section you’ll only need <code>lab4_qqq.csv</code> as we’ll only be calculating the concentration of the samples we injected in the instrument, and not back calculating the concentration in our original samples.</p>
<p><em>Note</em> Most of what we’ll need is contained in the <code>tidyverse</code> family of packages, but you will also need the <code>broom</code> and <code>ggrepel</code> packages to make your lives easier.</p>
<div id="importing-and-tidying-data" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Importing and tidying data</h2>
<p>First off let’s import the peak area information for all of our analytes. <em>Note</em> I cleaned up the data in Excel resulting in the <code>lab4_qqq.csv</code> file used herein. This is mostly because of issues with merged cells and multiple sheets in the original dataset. I also took the opportunity to generated unique <code>sampleID</code> values for each sample by combining the sample name and the group letter.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="linear-regression-redux.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for dplyr, readr, stringr, and ggplot</span></span>
<span id="cb202-2"><a href="linear-regression-redux.html#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="linear-regression-redux.html#cb202-3" aria-hidden="true" tabindex="-1"></a>QQQ <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/CHM410/lab4_qqq.csv&quot;</span>) </span>
<span id="cb202-4"><a href="linear-regression-redux.html#cb202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-5"><a href="linear-regression-redux.html#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(QQQ)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 29
##   group  type  sampleID  PFHxA_peakArea PFHxA_RT `13C2PFHxA_peak~ `13C2PFHxA_RT`
##   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
## 1 calCu~ std   20MC 0 p~              0     1.97           160000           3.65
## 2 calCu~ std   20MC 0.2~          28400     3.62           174000           3.62
## 3 calCu~ std   20MC 0.4~          45100     3.62           169000           3.61
## 4 calCu~ std   20MC 1 p~          90900     3.61           168000           3.61
## 5 calCu~ std   20MC 2 p~         184000     3.6            174000           3.6 
## 6 calCu~ std   20MC 4 p~         384000     3.61           141000           3.6 
## # ... with 22 more variables: PFHpA_peakArea &lt;dbl&gt;, PFHpA_RT &lt;dbl&gt;,
## #   PFOA_peakArea &lt;dbl&gt;, PFOA_RT &lt;dbl&gt;, 13C4PFOA_peakArea &lt;dbl&gt;,
## #   13C4PFOA_RT &lt;dbl&gt;, PFNA_peakArea &lt;dbl&gt;, PFNA_RT &lt;dbl&gt;,
## #   13C5PFNA_peakArea &lt;dbl&gt;, 13C5PFNA_RT &lt;dbl&gt;, PFDA_peakArea &lt;dbl&gt;,
## #   PFDA_RT &lt;dbl&gt;, 13C2PFDA_peakArea &lt;dbl&gt;, 13C2PFDA_RT &lt;dbl&gt;,
## #   PFHxS_peakArea &lt;dbl&gt;, PFHxS_RT &lt;dbl&gt;, 13C4PFHxS_peakArea &lt;dbl&gt;,
## #   13C4PFHxS_RT &lt;dbl&gt;, PFOS_peakArea &lt;dbl&gt;, PFOS_RT &lt;dbl&gt;,
## #   13C4PFOS_peakArea &lt;dbl&gt;, 13C4PFOS_RT &lt;dbl&gt;</code></pre>
<p>Note how our data is in a wide format, with columns for the peak area and retention times for each targeted ion. This served the TA well when they wrote down the data from the LC-MS analysis, but let’s tidy it up so it’s easier to work with in R.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="linear-regression-redux.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Find cleaner way of doing this...</span></span>
<span id="cb204-2"><a href="linear-regression-redux.html#cb204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-3"><a href="linear-regression-redux.html#cb204-3" aria-hidden="true" tabindex="-1"></a>QQQ <span class="ot">&lt;-</span> QQQ <span class="sc">%&gt;%</span></span>
<span id="cb204-4"><a href="linear-regression-redux.html#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;group&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;sampleID&quot;</span>),</span>
<span id="cb204-5"><a href="linear-regression-redux.html#cb204-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;cmpd&quot;</span>, <span class="st">&quot;measurement&quot;</span>),</span>
<span id="cb204-6"><a href="linear-regression-redux.html#cb204-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb204-7"><a href="linear-regression-redux.html#cb204-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb204-8"><a href="linear-regression-redux.html#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> measurement, </span>
<span id="cb204-9"><a href="linear-regression-redux.html#cb204-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value)</span>
<span id="cb204-10"><a href="linear-regression-redux.html#cb204-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-11"><a href="linear-regression-redux.html#cb204-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(QQQ)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   group    type  sampleID   cmpd      peakArea    RT
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
## 1 calCurve std   20MC 0 ppb PFHxA            0  1.97
## 2 calCurve std   20MC 0 ppb 13C2PFHxA   160000  3.65
## 3 calCurve std   20MC 0 ppb PFHpA            0  2.26
## 4 calCurve std   20MC 0 ppb PFOA             0  2.65
## 5 calCurve std   20MC 0 ppb 13C4PFOA    244000  4   
## 6 calCurve std   20MC 0 ppb PFNA             0  3.29</code></pre>
<p>Much better, each column is a variable, and every row an observation. However, since the Lake Niamco samples were analysed at a different time then the 20 Mile Creek samples, let’s quickly annotate our data to differentiate the two. Since we used (overly) descriptive sample names (stored in the <code>sampleID</code> column), we can create a new column to specify the location by searching for matching string values.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="linear-regression-redux.html#cb206-1" aria-hidden="true" tabindex="-1"></a>QQQ <span class="ot">&lt;-</span> QQQ <span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="linear-regression-redux.html#cb206-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">case_when</span>(</span>
<span id="cb206-3"><a href="linear-regression-redux.html#cb206-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(sampleID, <span class="fu">regex</span>(<span class="st">&quot;20MC&quot;</span>, <span class="at">ignore_case=</span><span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">&quot;20MC&quot;</span>,</span>
<span id="cb206-4"><a href="linear-regression-redux.html#cb206-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(sampleID, <span class="fu">regex</span>(<span class="st">&quot;NIA&quot;</span>, <span class="at">ignore_case=</span><span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">&quot;NIA&quot;</span>,</span>
<span id="cb206-5"><a href="linear-regression-redux.html#cb206-5" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;NA&quot;</span>))</span></code></pre></div>
<p>The code above will search through every row in the <code>sampleID</code> column. If it finds the string of characters <code>20MC</code>, which we used to denote samples from 20 Mile Creek, it will record this in a new column called <code>location</code>. Same with NIA. If neither <code>20MC</code> or <code>NIA</code> are detected, it returns <code>NA</code>. <em>Note</em>, if we had more complex <code>sampleID</code> names, we could expand our <code>case_when</code> arguments accordingly.</p>
<p>Let’s make a quick plot to verify everything is looking alright:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="linear-regression-redux.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># because i&#39;m colour blind...</span></span>
<span id="cb207-2"><a href="linear-regression-redux.html#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="linear-regression-redux.html#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(QQQ, <span class="fu">aes</span>(<span class="at">x =</span> RT, <span class="at">y =</span> peakArea, <span class="at">colour =</span> group)) <span class="sc">+</span></span>
<span id="cb207-4"><a href="linear-regression-redux.html#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb207-5"><a href="linear-regression-redux.html#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cmpd),</span>
<span id="cb207-6"><a href="linear-regression-redux.html#cb207-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">rows =</span> <span class="fu">vars</span>(location)) <span class="sc">+</span></span>
<span id="cb207-7"><a href="linear-regression-redux.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-8"><a href="linear-regression-redux.html#cb207-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>)</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/peakAreaVsRT-1.png" width="672" /></p>
<p>Alright, busy plot, but let’s see what we got. First off, this is a <em>small multiple</em>, basically a grid of small, individual, plots that share a common axis. So each small plot is our retention time (<code>RT</code>) on the x-axis vs. integrated peak area (<code>peakArea</code>) on the y-axis. Now our small multiple is organized in a grid, with the columns of the grid corresponding to the ions we analyzed, and the rows of the grid being the location grouping. So, the top-right plot shows the peak area vs. retention time of PFOS from the 20 Mile Creek samples. Lastly, the colour of a point corresponds to the group to which that value belongs. So we see multiple <code>calCurve</code> values at the same RT for a given compound, but with vastly different peak areas. This makes sense, as these are our standards from which we’ll construct our calibration curve later on.</p>
<p>Now that we understand what we’re looking at, let’s inspect our data. Here are some things I noted:</p>
<ul>
<li>Some compounds have a <code>RT</code> and <code>peakArea</code> of 0. Now their actual concentration isn’t necessarilly 0 ppb, rather the vendor software used to calculate peak areas will return <code>0</code> if a given ion wasn’t detected. However, R will interpret this number literally, so we’ll need to address this later on.</li>
<li>Most compounds elute at approximately 4 minutes. The grouping of retention times makes sense because of the structural similarity of our targeted compounds, and the short chromtagraphy gradient.<br />
</li>
<li><strong>However</strong> some compounds appear to elute earlier. Often these outliers have a low <code>peakArea</code>, so they may be the result of the vendor’s algorithm integrating noise, and mislabelling it as a legitimate peak. We’ll need to review this later on.</li>
<li>The internal standards all appear to have similar peak areas values. This makes sense, as we’ve spiked in the same amount of internal standard for each sample.</li>
<li>No signal is greater than a <code>calCurve</code> signal, this is good as it means all of our unknowns should fall within our calibration curve; baring matrix effects…</li>
</ul>
</div>
<div id="normalizing-qqq-data" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> Normalizing QQQ Data</h2>
<p>Now that we’re all organized in terms of importing our LC-MS results, let’s being the work of actually quantifying the samples we injected into the LC-MS before back calculating and quantifying our actual field samples.</p>
<p>First thing, we’ll need to normalize our peak areas to account for matrix effects. To achieve this, we’ll need to pair each analyte of interest with it’s assigned internal standard. Recall however that we did not have an exact isotopic standard for each compound. The pairing, from the lab manual, is below:</p>
<table>
<colgroup>
<col width="5%" />
<col width="19%" />
<col width="11%" />
<col width="10%" />
<col width="12%" />
<col width="22%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th>Analyte</th>
<th>Full name</th>
<th>Carboxylic acid?</th>
<th>Sulfonic acid?</th>
<th>Number of Carbons</th>
<th>Number of perfluorinated carbons</th>
<th>Internal Standard to use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PFHxA</td>
<td>Perfluorohexanoic acid</td>
<td>x</td>
<td></td>
<td>6</td>
<td>5</td>
<td>13C4 PFHxA</td>
</tr>
<tr class="even">
<td>PFHpA</td>
<td>Perfluoroheptanoic acid</td>
<td>x</td>
<td></td>
<td>7</td>
<td>6</td>
<td>13C4 PFOA</td>
</tr>
<tr class="odd">
<td>PFHxS</td>
<td>Perfluorohexane sulfonic acid</td>
<td></td>
<td>x</td>
<td>6</td>
<td>6</td>
<td>13C4 PFHxS</td>
</tr>
<tr class="even">
<td>PFOA</td>
<td>Perfluorooctanoic acid</td>
<td>x</td>
<td></td>
<td>8</td>
<td>7</td>
<td>13C4 PFOA</td>
</tr>
<tr class="odd">
<td>PFNA</td>
<td>Perfluorononanoic acid</td>
<td>x</td>
<td></td>
<td>9</td>
<td>8</td>
<td>13C5 PFNA</td>
</tr>
<tr class="even">
<td>PFOS</td>
<td>Perfluorooctane sulfonic acid</td>
<td></td>
<td>x</td>
<td>8</td>
<td>8</td>
<td>13C4 PFOS</td>
</tr>
<tr class="odd">
<td>PFDA</td>
<td>Perfluorodecanoic acid</td>
<td>x</td>
<td></td>
<td>10</td>
<td>9</td>
<td>13C2 PFDA</td>
</tr>
</tbody>
</table>
<p>So according to the table above, both <code>PFHpA</code> and <code>PFOA</code> use <code>13C4PFOA</code> as an internal standard. Given</p>
<div id="assessing-internal-stds" class="section level3" number="16.2.1">
<h3><span class="header-section-number">16.2.1</span> Assessing Internal Stds</h3>
<p>For fun, let’s gauge how much our internal standards varied between samples. After all, they’re all supposed to be the same… We’ll create a new column to annotate which compounds are from our internal standard (i.e. those with <span class="math inline">\(^{13}C\)</span>). For that, we’ll recycle a bit of code from above to search for the “13C” string. Then we can compare the peak areas of the internal standards and our analytes of interest.</p>
<p>As for pairing, there’s a couple of ways we could do this. Let’s just create a new column where we remove the <code>13C.</code> string, so we get the same compounds. Some things to note about the string search:</p>
<ul>
<li>The regex <code>13C.</code>, will look up any string with <code>13C</code> and one additional wildcard character (noted by the <code>.</code>). This way we can account for the different numbers of 13C in the name, such as <code>13C4</code> and <code>13C2</code>.</li>
<li><code>PFHpA</code> will not have an isotopic pair. We’ll need to resolve this later by subtracting the <code>13C4PFOA</code> values from it.</li>
</ul>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="linear-regression-redux.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># annotating internal and external standards</span></span>
<span id="cb208-2"><a href="linear-regression-redux.html#cb208-2" aria-hidden="true" tabindex="-1"></a>QQQ <span class="ot">&lt;-</span> QQQ <span class="sc">%&gt;%</span></span>
<span id="cb208-3"><a href="linear-regression-redux.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stdType =</span> <span class="fu">case_when</span>(</span>
<span id="cb208-4"><a href="linear-regression-redux.html#cb208-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(cmpd, <span class="fu">regex</span>(<span class="st">&quot;13C&quot;</span>, <span class="at">ignore_case=</span><span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">&quot;internal&quot;</span>,</span>
<span id="cb208-5"><a href="linear-regression-redux.html#cb208-5" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;external&quot;</span>))</span>
<span id="cb208-6"><a href="linear-regression-redux.html#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="linear-regression-redux.html#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pairing analytes w/ internal standard</span></span>
<span id="cb208-8"><a href="linear-regression-redux.html#cb208-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-9"><a href="linear-regression-redux.html#cb208-9" aria-hidden="true" tabindex="-1"></a>QQQ <span class="ot">&lt;-</span> QQQ <span class="sc">%&gt;%</span></span>
<span id="cb208-10"><a href="linear-regression-redux.html#cb208-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pair =</span> <span class="fu">str_remove</span>(cmpd, <span class="fu">regex</span>(<span class="st">&quot;13C.&quot;</span>)))</span>
<span id="cb208-11"><a href="linear-regression-redux.html#cb208-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-12"><a href="linear-regression-redux.html#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="linear-regression-redux.html#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> QQQ, <span class="fu">aes</span>(<span class="at">x =</span> stdType, <span class="at">y =</span> peakArea)) <span class="sc">+</span></span>
<span id="cb208-14"><a href="linear-regression-redux.html#cb208-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb208-15"><a href="linear-regression-redux.html#cb208-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">colour =</span> type), </span>
<span id="cb208-16"><a href="linear-regression-redux.html#cb208-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">position=</span><span class="fu">position_jitter</span>(<span class="fl">0.2</span>), </span>
<span id="cb208-17"><a href="linear-regression-redux.html#cb208-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb208-18"><a href="linear-regression-redux.html#cb208-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">&quot;log10&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-19"><a href="linear-regression-redux.html#cb208-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(pair),</span>
<span id="cb208-20"><a href="linear-regression-redux.html#cb208-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">rows =</span> <span class="fu">vars</span>(location)) <span class="sc">+</span></span>
<span id="cb208-21"><a href="linear-regression-redux.html#cb208-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-22"><a href="linear-regression-redux.html#cb208-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;log10 Peak Area&quot;</span>)</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/QQQ_IntVsExStd-1.png" width="672" /></p>
<p>Boy howdy let’s break this down. This is small multiple of violin plots that shows some neat trends. For those not in the know, a violin plot is similar to a box plot, but the width of the ‘bar’ is a function of the density of the data around that point. In other words, the more points at a given value, the wider the plot; we’ve also plotted the individual points themselves to help convey this. Violin plots help us better visualize groupings of data, and can shed some light if a grouping of data might actually be many smaller groupings.</p>
<p>Anyways, let’s see what else this says about our data. First, we can see that there’s much less variation between internal standards (the “internal” column“) compared to the non-isotopically labelled analytes (the”external" column). Makes sense, all the internal standards are supposed to be the same concentration. However, even then there is still at least an order of magnitude variation in peak area for a given internal standard. Some of this is due to matrix effects, and is why we added the internal standards in the first place. However, looking at the internal standard peak areas, it appears that they cluster into two groups, albeit with some overlap. We might have missed this with a boxplot, but the violin plot helps us see it. You might imagine that the clustering is due to the differences between the external calibration curve samples, and real samples, with the latter having lowered internal standard peak areas due to matrix effects. However, looking at the colouring of the dots, we see that while the <code>std</code> internal standard peak areas are generally the highest (no matrix effect), they don’t account for all of the upper cluster. So there might be another reason for this. This clustering around two points might be the result of people using two different pipettes to spike in their internal standard. The variation between pipettes could account for the clustering of the internal standard peak areas. Speaking of two groups, again, we can see a large number of the “external” were not detected, as denoted by their peak area value of <code>0</code>. These are probably from the samples originating from the ‘clean’ reference site. Lastly, between internal standards, we can clearly see that sulfonic acids have a weaker instrumental response then carboxylic acid. This is most likely due to difference in ionizability between the aforementioned functional groups.</p>
</div>
<div id="normalizing-peak-areas" class="section level3" number="16.2.2">
<h3><span class="header-section-number">16.2.2</span> Normalizing peak areas</h3>
<p>Moving onward, the entire point of spiking the same internal standard is to use those values to normalize our external measurements. For this we’ll divide the external peak area by the internal peak area for a given sample. <em>Note this is how I was told CHM410 did it, holler it it’s wrong</em>.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="linear-regression-redux.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note removal of PFHpA, because it doesn&#39;t have an isotope pair</span></span>
<span id="cb209-2"><a href="linear-regression-redux.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Also note RTDif column, which is difference in retention time between internal and external standard</span></span>
<span id="cb209-3"><a href="linear-regression-redux.html#cb209-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4"><a href="linear-regression-redux.html#cb209-4" aria-hidden="true" tabindex="-1"></a>QQQNorm <span class="ot">&lt;-</span> QQQ <span class="sc">%&gt;%</span></span>
<span id="cb209-5"><a href="linear-regression-redux.html#cb209-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pair <span class="sc">!=</span> <span class="st">&quot;PFHpA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb209-6"><a href="linear-regression-redux.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sampleID, pair) <span class="sc">%&gt;%</span></span>
<span id="cb209-7"><a href="linear-regression-redux.html#cb209-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">normPeakArea =</span> peakArea[stdType <span class="sc">==</span> <span class="st">&#39;external&#39;</span>] <span class="sc">/</span> peakArea[stdType <span class="sc">==</span> <span class="st">&#39;internal&#39;</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb209-8"><a href="linear-regression-redux.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RTdif =</span> RT[stdType <span class="sc">==</span> <span class="st">&#39;external&#39;</span>] <span class="sc">-</span> RT[stdType <span class="sc">==</span> <span class="st">&#39;internal&#39;</span>])</span>
<span id="cb209-9"><a href="linear-regression-redux.html#cb209-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-10"><a href="linear-regression-redux.html#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizing PFHpA seperatly; not removal of 13C4PFOA data at end</span></span>
<span id="cb209-11"><a href="linear-regression-redux.html#cb209-11" aria-hidden="true" tabindex="-1"></a>QQQPFHpA <span class="ot">&lt;-</span> QQQ <span class="sc">%&gt;%</span></span>
<span id="cb209-12"><a href="linear-regression-redux.html#cb209-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cmpd <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;PFHpA&quot;</span>, <span class="st">&quot;13C4PFOA&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb209-13"><a href="linear-regression-redux.html#cb209-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sampleID, ) <span class="sc">%&gt;%</span></span>
<span id="cb209-14"><a href="linear-regression-redux.html#cb209-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">normPeakArea =</span> peakArea[cmpd <span class="sc">==</span> <span class="st">&#39;PFHpA&#39;</span>] <span class="sc">/</span> peakArea[cmpd <span class="sc">==</span> <span class="st">&#39;13C4PFOA&#39;</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb209-15"><a href="linear-regression-redux.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RTdif =</span> RT[cmpd <span class="sc">==</span> <span class="st">&#39;PFHpA&#39;</span>] <span class="sc">-</span> RT[cmpd <span class="sc">==</span> <span class="st">&#39;13C4PFOA&#39;</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb209-16"><a href="linear-regression-redux.html#cb209-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cmpd <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;PFHpA&quot;</span>))</span>
<span id="cb209-17"><a href="linear-regression-redux.html#cb209-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-18"><a href="linear-regression-redux.html#cb209-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Rejoining data and dropping internal standard values as they&#39;re no longer needed.</span></span>
<span id="cb209-19"><a href="linear-regression-redux.html#cb209-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-20"><a href="linear-regression-redux.html#cb209-20" aria-hidden="true" tabindex="-1"></a>QQQNorm <span class="ot">&lt;-</span> QQQNorm <span class="sc">%&gt;%</span></span>
<span id="cb209-21"><a href="linear-regression-redux.html#cb209-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(QQQPFHpA) <span class="sc">%&gt;%</span></span>
<span id="cb209-22"><a href="linear-regression-redux.html#cb209-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stdType <span class="sc">==</span> <span class="st">&quot;external&quot;</span>)</span></code></pre></div>
<p>So the above code did double duty. First we normalized the external peak areas by the internal standard peak areas. This has a couple of consequence;</p>
<ol style="list-style-type: decimal">
<li>If a compounds wasn’t detected, it has a peak area of 0. When divided by the internal peak area, the result will be zero.</li>
<li>If an internal standard wasn’t detected, the external peak area will be divided by 0 resulting in <code>Inf</code>, a value of infinity, because in <code>R</code>, <code>1/0 = Inf</code></li>
</ol>
<p>Let’s see how our internal and external standards match up by comparing internal and external retention times.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="linear-regression-redux.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(QQQNorm, <span class="fu">aes</span>(<span class="at">x =</span> RT, <span class="at">y =</span> RTdif, <span class="at">colour =</span> cmpd)) <span class="sc">+</span></span>
<span id="cb210-2"><a href="linear-regression-redux.html#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb210-3"><a href="linear-regression-redux.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;External RT (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb210-4"><a href="linear-regression-redux.html#cb210-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;External RT - Internal RT (min)&quot;</span>) </span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/QQQ_RTDif-1.png" width="672" /></p>
<p>Alright, it appears that most of our compounds are clustering around themselves, and there’s little variation among the <code>RTdif</code> axis, meaning there isn’t a large difference between the retention times of the internal and external peaks. This means our peak picking algorithm chose peaks at the correct retention time. Of course, the clustering around <code>RT = 0</code> is from compounds that weren’t detected, but whose internal standards were; this is fine. However, there appears to be some outliers somewhere between these two clusters. These are probably all from the same sample. Let’s annotate our plot to see if this is true.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="linear-regression-redux.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(QQQNorm, <span class="fu">aes</span>(<span class="at">x =</span> RT, <span class="at">y =</span> RTdif, <span class="at">colour =</span> cmpd, <span class="at">label =</span> sampleID)) <span class="sc">+</span></span>
<span id="cb211-2"><a href="linear-regression-redux.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb211-3"><a href="linear-regression-redux.html#cb211-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;External RT (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb211-4"><a href="linear-regression-redux.html#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;External RT - Internal RT (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb211-5"><a href="linear-regression-redux.html#cb211-5" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">ifelse</span>(RTdif <span class="sc">&gt;</span> <span class="fl">0.25</span> <span class="sc">|</span> (RTdif <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.25</span> <span class="sc">&amp;</span> RT <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="fu">as.character</span>(sampleID),<span class="st">&#39;&#39;</span>)),<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/QQQ_RTDifAnot-1.png" width="672" /></p>
<p>So something strange happened during the acquisition/processing of the <code>20MC 0 ppb</code> run. Maybe it was the first one of the day, and the instrument was exceptionally noisy, leading to sloppy peak picking by the algorithm. After all, there shouldn’t be any signal as the concentration of the external standard for this sample should be 0 ppb. Likewise, we don’t see this effect with the NIA calibration curve standards. Something to keep in mind as we move forward.</p>
</div>
</div>
<div id="calculating-calibration-curves" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> Calculating Calibration Curves</h2>
<p>All this and we’re only here? Yup, it’s important to play around with your data because you never know what you’ll find. Already we’ve talked about issues with our internal spiking, and one of our external standard solutions. Let’s move onwards to calculating our calibration curves.</p>
<p>First we need to get the actual concentrations from our standards to make our cal curves. You can make a data frame and match up your concentrations using <code>inner_join</code>, or you can simply extract the concentration value from the <code>calCurve</code> group <code>sampleIDs</code>, as the numerical value is located between two spaces. Just remember to convert using <code>as.numeric</code> so R knows to treat the extracted strings as numerical values and not as characters (i.e. <code>0.1</code> and not <code>"0.1"</code>).</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="linear-regression-redux.html#cb212-1" aria-hidden="true" tabindex="-1"></a>QQQstds <span class="ot">&lt;-</span> QQQNorm <span class="sc">%&gt;%</span></span>
<span id="cb212-2"><a href="linear-regression-redux.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;calCurve&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-3"><a href="linear-regression-redux.html#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(sampleID, <span class="st">&quot;(?&lt;=</span><span class="sc">\\</span><span class="st">s)(.*)(?=</span><span class="sc">\\</span><span class="st">s)&quot;</span>)))</span></code></pre></div>
<p>Great, now we can simply group our standards by location and compound to compute a linear regression model for each. <code>R</code> has a plethora of built-in modelling functions, but oftentimes the output is less then intuitive. Since we’ll be using the base <code>R</code> <code>lm</code> model to calculate our calibration curves, let’s import the <code>broom</code> package, which is useful for cleaning up <code>R</code>’s modelling outputs (hence broom…).</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="linear-regression-redux.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb213-2"><a href="linear-regression-redux.html#cb213-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-3"><a href="linear-regression-redux.html#cb213-3" aria-hidden="true" tabindex="-1"></a>calCurves <span class="ot">&lt;-</span> QQQstds <span class="sc">%&gt;%</span></span>
<span id="cb213-4"><a href="linear-regression-redux.html#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location, cmpd) <span class="sc">%&gt;%</span></span>
<span id="cb213-5"><a href="linear-regression-redux.html#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb213-6"><a href="linear-regression-redux.html#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(normPeakArea <span class="sc">~</span> conc, <span class="at">data =</span> .x)),</span>
<span id="cb213-7"><a href="linear-regression-redux.html#cb213-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(fit, tidy),</span>
<span id="cb213-8"><a href="linear-regression-redux.html#cb213-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">glanced =</span> <span class="fu">map</span>(fit, glance)</span>
<span id="cb213-9"><a href="linear-regression-redux.html#cb213-9" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Breaking down the above code, we grouped all calibration standards by the compound and location. This way we can get a linear regression for each grouping. Now, withing the <code>mutate</code> function, we’ve created three columns: <code>fit</code>, <code>tidied</code> and <code>glanced</code>. The first contains the raw output from the linear regression model <code>lm</code> in the form of a list. The linear model are calculated for <code>normPeakArea</code> as a function of <code>conc</code>. This is exceptionally messy, hence why we used the <code>tidy</code>, and <code>glance</code> function from the <code>broom</code> package . <code>map</code> just means we’re applying the function <code>tidy</code> to the individual output list created by <code>lm</code> and stored in the <code>fit</code> column. Note that the <code>tidy</code> and <code>glanced</code> outputs are tibbles. So we now have a tibble containing values (i.e. <code>location</code>), lists (i.e. <code>fit</code>), and tibbles (<code>tidied</code>). This is known as **nested data*. We’re no longer in Kansas anymore…</p>
<p>Anyways, let’s take a look at our model results. The <code>glanced</code> tibble contains “…a concise one-row summary of the model. This typically contains values such as R^2, adjusted R^2, and residual standard error that are computed once for the entire mode”<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="linear-regression-redux.html#cb214-1" aria-hidden="true" tabindex="-1"></a>calCurves <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="linear-regression-redux.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(glanced)</span></code></pre></div>
<pre><code>## # A tibble: 14 x 17
## # Groups:   cmpd, location [14]
##    cmpd  location data     fit   tidied  r.squared adj.r.squared sigma statistic
##    &lt;chr&gt; &lt;chr&gt;    &lt;list&gt;   &lt;lis&gt; &lt;list&gt;      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 PFHxA 20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.996         0.995 1.05      1803.
##  2 PFOA  20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.944         0.937 1.89       134.
##  3 PFNA  20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.998         0.998 0.556     4994.
##  4 PFDA  20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.994         0.993 0.946     1305.
##  5 PFHxS 20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.999         0.999 0.447     9476.
##  6 PFOS  20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.999         0.999 0.376    11307.
##  7 PFHxA NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.997         0.997 0.788     2742.
##  8 PFOA  NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.946         0.939 1.94       140.
##  9 PFNA  NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.996         0.995 0.843     1953.
## 10 PFDA  NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.996         0.996 0.762     2085.
## 11 PFHxS NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.999         0.999 0.719     7035.
## 12 PFOS  NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.996         0.996 1.01      2038.
## 13 PFHpA 20MC     &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.954         0.948 1.35       166.
## 14 PFHpA NIA      &lt;tibble~ &lt;lm&gt;  &lt;tibbl~     0.945         0.938 2.05       137.
## # ... with 8 more variables: p.value &lt;dbl&gt;, df &lt;dbl&gt;, logLik &lt;dbl&gt;, AIC &lt;dbl&gt;,
## #   BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
<p>What you see here is a bit more than what you’d get from <em>Excel</em>’s ‘line-of-best fit’ output. See the section on <em>Modelling</em> for a better breakdown of what everything means. But for now, we can see that our <code>r.squared</code> of each calibration curve is pretty good, and the <code>p.value</code> indicates each model is significant. the <code>adj.r.squared</code> is the same as <code>r.squared</code> in this situation. This is because <code>r.squared</code> will always increase if we add more exploratory variables to our model; the <code>adj.r.squared</code> accounts for the number of exploratory variables used in the model. However, in our case we only have one exploratory variable, hence they’re the same.</p>
<p>But what about the slope and the intercept? After all, that’s what we need to calculate the concentration in our unknowns. Let’s take a look at the <code>tidied</code> from the <code>tidy</code> function “…which constructs a tibble that summarizes the model’s statistical findings. This includes coefficients and p-values for each term in a regression…”<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="linear-regression-redux.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># storing because we&#39;ll use it later on. </span></span>
<span id="cb216-2"><a href="linear-regression-redux.html#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="linear-regression-redux.html#cb216-3" aria-hidden="true" tabindex="-1"></a>tidied <span class="ot">&lt;-</span> calCurves <span class="sc">%&gt;%</span> </span>
<span id="cb216-4"><a href="linear-regression-redux.html#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied)</span>
<span id="cb216-5"><a href="linear-regression-redux.html#cb216-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-6"><a href="linear-regression-redux.html#cb216-6" aria-hidden="true" tabindex="-1"></a>tidied</span></code></pre></div>
<pre><code>## # A tibble: 28 x 10
## # Groups:   cmpd, location [14]
##    cmpd  location data       fit   term    estimate std.error statistic  p.value
##    &lt;chr&gt; &lt;chr&gt;    &lt;list&gt;     &lt;lis&gt; &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 PFHxA 20MC     &lt;tibble [~ &lt;lm&gt;  (Inter~    0.729   0.388        1.88 9.66e- 2
##  2 PFHxA 20MC     &lt;tibble [~ &lt;lm&gt;  conc       0.473   0.0111      42.5  1.04e-10
##  3 PFOA  20MC     &lt;tibble [~ &lt;lm&gt;  (Inter~    1.24    0.694        1.78 1.12e- 1
##  4 PFOA  20MC     &lt;tibble [~ &lt;lm&gt;  conc       0.231   0.0199      11.6  2.82e- 6
##  5 PFNA  20MC     &lt;tibble [~ &lt;lm&gt;  (Inter~    0.289   0.205        1.41 1.95e- 1
##  6 PFNA  20MC     &lt;tibble [~ &lt;lm&gt;  conc       0.415   0.00587     70.7  1.79e-12
##  7 PFDA  20MC     &lt;tibble [~ &lt;lm&gt;  (Inter~    0.592   0.348        1.70 1.27e- 1
##  8 PFDA  20MC     &lt;tibble [~ &lt;lm&gt;  conc       0.361   0.00999     36.1  3.78e-10
##  9 PFHxS 20MC     &lt;tibble [~ &lt;lm&gt;  (Inter~    0.298   0.164        1.82 1.07e- 1
## 10 PFHxS 20MC     &lt;tibble [~ &lt;lm&gt;  conc       0.459   0.00472     97.3  1.38e-13
## # ... with 18 more rows, and 1 more variable: glanced &lt;list&gt;</code></pre>
<p>Again, a lot more to unpack compared to <em>Excel</em>. That’s because the <code>lm</code> function in R calculates a generalized linear model. <code>lm</code> performs a linear regression model, which we normally think of as an equation of the form <span class="math inline">\(y= mx+b\)</span>. But, regression models can be expanded to account for multiple variables (hence <em>multiple linear regression</em>) of the form</p>
<p><span class="math display">\[y = \beta _{0} + \beta _{1} x_{1} + \beta _{2} x_{2} ... \beta _{p} x_{p}\]</span>]</p>
<p>where,</p>
<ul>
<li><span class="math inline">\(y\)</span> = dependent variable</li>
<li><span class="math inline">\(x\)</span> = exploratory variable; there’s no limit how many you can input</li>
<li><span class="math inline">\(\Beta _{0}\)</span> = y-intercept (constant term)</li>
<li><span class="math inline">\(\Beta _{p}\)</span> = slope coefficient for each explanatory variable</li>
</ul>
<p>In our situation, we only have one input variable for our model (<code>conc</code>), so the above formula collapses down to <span class="math inline">\(y = \beta _{0} + \beta _{1} x_{1}\)</span>. So looking at our results above, each row corresponds to a model parameter for a given compound and location. For each modelling parameter, we’re provided an estimate of it’s numerical value (<code>estimate</code>, the values we’ll use to calculate concentration). The other parameters are useful to understand but not necessary at this point (again, check out the <em>Modelling</em> section).</p>
<div id="plotting-regression-curves" class="section level3" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Plotting regression curves</h3>
<p>It’s always a good idea to visualize our models fit, and it’s definitely expected when it comes to calibration curves. So let’s go ahead and plot ours:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="linear-regression-redux.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(QQQstds, <span class="fu">aes</span>(<span class="at">x =</span> conc, <span class="at">y =</span> normPeakArea, <span class="at">colour =</span> cmpd)) <span class="sc">+</span></span>
<span id="cb218-2"><a href="linear-regression-redux.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb218-3"><a href="linear-regression-redux.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(location)) <span class="sc">+</span></span>
<span id="cb218-4"><a href="linear-regression-redux.html#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>) <span class="sc">+</span></span>
<span id="cb218-5"><a href="linear-regression-redux.html#cb218-5" aria-hidden="true" tabindex="-1"></a>  ggpmisc<span class="sc">::</span><span class="fu">stat_poly_eq</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, </span>
<span id="cb218-6"><a href="linear-regression-redux.html#cb218-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..eq.label.., ..rr.label.., <span class="at">sep =</span> <span class="st">&quot;~~~&quot;</span>)), </span>
<span id="cb218-7"><a href="linear-regression-redux.html#cb218-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">parse =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb218-8"><a href="linear-regression-redux.html#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/QQQ_calCurvesPlot-1.png" width="672" /></p>
<p>Note the grey area around each linear model fitting is the predicted 95% confidence interval for that model. In other words, 95% of our peak areas should fall inside those lines. Also note the difference in instrument response for different compounds. This is why true quantification requires authentic standards.</p>
<p>Let’s extract what we need and move on:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="linear-regression-redux.html#cb219-1" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cmpd =</span> tidied<span class="sc">$</span>cmpd,</span>
<span id="cb219-2"><a href="linear-regression-redux.html#cb219-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">location =</span> tidied<span class="sc">$</span>location,</span>
<span id="cb219-3"><a href="linear-regression-redux.html#cb219-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">term =</span> tidied<span class="sc">$</span>term,</span>
<span id="cb219-4"><a href="linear-regression-redux.html#cb219-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">estimate =</span> tidied<span class="sc">$</span>estimate) <span class="sc">%&gt;%</span></span>
<span id="cb219-5"><a href="linear-regression-redux.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;term&quot;</span>, </span>
<span id="cb219-6"><a href="linear-regression-redux.html#cb219-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;estimate&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-7"><a href="linear-regression-redux.html#cb219-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-8"><a href="linear-regression-redux.html#cb219-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">slope =</span> conc)</span>
<span id="cb219-9"><a href="linear-regression-redux.html#cb219-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-10"><a href="linear-regression-redux.html#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(terms)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   cmpd  location intercept slope
##   &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
## 1 PFHxA 20MC         0.729 0.473
## 2 PFOA  20MC         1.24  0.231
## 3 PFNA  20MC         0.289 0.415
## 4 PFDA  20MC         0.592 0.361
## 5 PFHxS 20MC         0.298 0.459
## 6 PFOS  20MC         0.316 0.422</code></pre>
</div>
</div>
<div id="quantifying-sample-concentrations" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Quantifying sample concentrations</h2>
<p>Let’s pair up each compound with it’s calibration curve terms, so we can quantify each sample:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="linear-regression-redux.html#cb221-1" aria-hidden="true" tabindex="-1"></a>unknowns <span class="ot">&lt;-</span> QQQNorm <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="linear-regression-redux.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">&quot;std&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-3"><a href="linear-regression-redux.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(terms, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;cmpd&quot;</span>, <span class="st">&#39;location&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb221-4"><a href="linear-regression-redux.html#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc =</span> (normPeakArea <span class="sc">-</span> intercept)<span class="sc">/</span>slope)</span>
<span id="cb221-5"><a href="linear-regression-redux.html#cb221-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-6"><a href="linear-regression-redux.html#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(unknowns, <span class="fu">aes</span> ( <span class="at">x =</span> cmpd, <span class="at">y =</span> conc, <span class="at">colour =</span> group, <span class="at">label =</span> sampleID)) <span class="sc">+</span></span>
<span id="cb221-7"><a href="linear-regression-redux.html#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb221-8"><a href="linear-regression-redux.html#cb221-8" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">ifelse</span>(conc <span class="sc">&gt;</span> <span class="dv">100</span> , <span class="fu">as.character</span>(sampleID),<span class="st">&#39;&#39;</span>)),<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/QQQ_termPairing-1.png" width="672" /></p>
<p>Thanks to our annotation with <code>ggrepel</code> we know from which samples our outliers came from. Note I’m using outlier here to mean anything outside our calibration curve, and not a statistical outlier, well get to that. Investigating our original data we see that:</p>
<ul>
<li>Neither <em>13C2PFDA</em> or <em>13C4PFHxS</em> were detected in <code>Grp D NIA Shrimp #1 (Replicate 2). Further inspection shows that all of the internal standards are extremely low compared to the other samples. This indicates a missloading of the internal standard, hence the out of whack normalized peak area, and subsequent concentration.     - Recall in R,</code>1/0 = Inf<code>, so an undetected internal standard is reported as</code>0`, leading to an infinite concentration.
<ul>
<li>This entire sample should be removed from further analysis.</li>
</ul></li>
<li>Similar situation with <code>Grp E NIA Bluegill Sunfish #2 (Replicate 1)</code>, and although all internal standards where detected, their peak areas are close to the instrument cutoff (~1000 counts).</li>
<li>Again, similar story with <code>Grp F NIA Pumpkinsee fish #3 (Replicate 1)</code></li>
</ul>
<p>For these samples, it may be the result of some serious matrix effects, but I doubt it. Let’s just saw we’ll remove them, and see what’s left:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="linear-regression-redux.html#cb222-1" aria-hidden="true" tabindex="-1"></a>unknowns <span class="ot">&lt;-</span> unknowns <span class="sc">%&gt;%</span></span>
<span id="cb222-2"><a href="linear-regression-redux.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(conc <span class="sc">&lt;</span> <span class="dv">120</span>)</span>
<span id="cb222-3"><a href="linear-regression-redux.html#cb222-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-4"><a href="linear-regression-redux.html#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(unknowns, <span class="fu">aes</span> ( <span class="at">x =</span> cmpd, <span class="at">y =</span> conc, <span class="at">colour =</span> group, <span class="at">label =</span> sampleID)) <span class="sc">+</span></span>
<span id="cb222-5"><a href="linear-regression-redux.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() </span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/QQQ_quantResults-1.png" width="672" /></p>
<p>So we can see many samples have slightly negative concentrations. These are the result of the back calculation, and the errors in our model. We can establish an instrumental cutoff (i.e. anything less than X becomes a flat value). It is interesting how the PFOA and PFHxA results are substantially more negative then the others two. This may be due to the <em>13C4PFOA</em> internal standard, which was also used to calculate the <em>PFHxA</em> concentrations.</p>
<p>Anyways, always something to do…</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>From the <em>broom</em> package vignette.<a href="linear-regression-redux.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>From the <em>broom</em> package vignette.<a href="linear-regression-redux.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="choosing-visualizations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="non-linear-logistic-regression-modelling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DavidRossHall/R4EnvChem/linear-regression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R4EnvChem.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

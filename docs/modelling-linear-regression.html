<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 19 Modelling: Linear Regression | R for Environmental Chemistry</title>
  <meta name="description" content="This is a proof-of-concept for a further full length textbook." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 19 Modelling: Linear Regression | R for Environmental Chemistry" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a proof-of-concept for a further full length textbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 19 Modelling: Linear Regression | R for Environmental Chemistry" />
  
  <meta name="twitter:description" content="This is a proof-of-concept for a further full length textbook." />
  

<meta name="author" content="David Hall, Steven Kutarna, Kristen Yeh, Hui Peng, Chaerin Song, and Jessica D’eon" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="customizing-your-plots.html"/>
<link rel="next" href="evaluating-and-improving-model-performance.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.32/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Environmental Chemistry</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#providing-feedback"><i class="fa fa-check"></i>Providing Feedback</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowlegements"><i class="fa fa-check"></i>Acknowlegements</a></li>
</ul></li>
<li class="part"><span><b>Part 1: Getting Started in R</b></span></li>
<li class="chapter" data-level="1" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> Intro to R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#r-language"><i class="fa fa-check"></i><b>1.1</b> R Language</a></li>
<li class="chapter" data-level="1.2" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#setting-up-your-environment"><i class="fa fa-check"></i><b>1.3</b> Setting Up Your Environment</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#working-remotely-recommended-for-coursework"><i class="fa fa-check"></i><b>1.3.1</b> Working Remotely (Recommended for Coursework)</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#working-locally"><i class="fa fa-check"></i><b>1.3.2</b> Working Locally</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#using-rstudio"><i class="fa fa-check"></i><b>1.4</b> Using RStudio</a></li>
<li class="chapter" data-level="1.5" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#running-r-code"><i class="fa fa-check"></i><b>1.5</b> Running R Code</a></li>
<li class="chapter" data-level="1.6" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#customizing-rstudio"><i class="fa fa-check"></i><b>1.6</b> Customizing RStudio</a></li>
<li class="chapter" data-level="1.7" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#where-to-get-help"><i class="fa fa-check"></i><b>1.7</b> Where to get help</a></li>
<li class="chapter" data-level="1.8" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
<li class="chapter" data-level="1.9" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#exercise"><i class="fa fa-check"></i><b>1.9</b> Exercise</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#setup"><i class="fa fa-check"></i><b>1.9.1</b> Setup</a></li>
<li class="chapter" data-level="1.9.2" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#basic-r-commands"><i class="fa fa-check"></i><b>1.9.2</b> Basic R Commands</a></li>
<li class="chapter" data-level="1.9.3" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#using-the-help-command"><i class="fa fa-check"></i><b>1.9.3</b> Using the Help Command (<code>?</code>)</a></li>
<li class="chapter" data-level="1.9.4" data-path="intro-to-r-and-rstudio.html"><a href="intro-to-r-and-rstudio.html#reflection"><i class="fa fa-check"></i><b>1.9.4</b> Reflection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio-projects.html"><a href="rstudio-projects.html"><i class="fa fa-check"></i><b>2</b> RStudio Projects</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rstudio-projects.html"><a href="rstudio-projects.html#uploading-files-to-rstudio-server-on-jupyterhub"><i class="fa fa-check"></i><b>2.1</b> Uploading Files to RStudio server on JupyterHub</a></li>
<li class="chapter" data-level="2.2" data-path="rstudio-projects.html"><a href="rstudio-projects.html#paths-and-directories"><i class="fa fa-check"></i><b>2.2</b> Paths and Directories</a></li>
<li class="chapter" data-level="2.3" data-path="rstudio-projects.html"><a href="rstudio-projects.html#importing-a-project"><i class="fa fa-check"></i><b>2.3</b> Importing a Project</a></li>
<li class="chapter" data-level="2.4" data-path="rstudio-projects.html"><a href="rstudio-projects.html#creating-an-rstudio-project"><i class="fa fa-check"></i><b>2.4</b> Creating an RStudio Project</a></li>
<li class="chapter" data-level="2.5" data-path="rstudio-projects.html"><a href="rstudio-projects.html#a-sneak-peek-at-.rmd-files"><i class="fa fa-check"></i><b>2.5</b> A Sneak Peek at <code>.Rmd</code> Files</a></li>
<li class="chapter" data-level="2.6" data-path="rstudio-projects.html"><a href="rstudio-projects.html#summary-1"><i class="fa fa-check"></i><b>2.6</b> Summary</a></li>
<li class="chapter" data-level="2.7" data-path="rstudio-projects.html"><a href="rstudio-projects.html#exercise-1"><i class="fa fa-check"></i><b>2.7</b> Exercise</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="rstudio-projects.html"><a href="rstudio-projects.html#get-started"><i class="fa fa-check"></i><b>2.7.1</b> Get Started</a></li>
<li class="chapter" data-level="2.7.2" data-path="rstudio-projects.html"><a href="rstudio-projects.html#confirm-your-working-directory"><i class="fa fa-check"></i><b>2.7.2</b> Confirm Your Working Directory</a></li>
<li class="chapter" data-level="2.7.3" data-path="rstudio-projects.html"><a href="rstudio-projects.html#creating-your-own-project"><i class="fa fa-check"></i><b>2.7.3</b> Creating Your Own Project</a></li>
<li class="chapter" data-level="2.7.4" data-path="rstudio-projects.html"><a href="rstudio-projects.html#create-your-rmd-file"><i class="fa fa-check"></i><b>2.7.4</b> Create Your Rmd File</a></li>
<li class="chapter" data-level="2.7.5" data-path="rstudio-projects.html"><a href="rstudio-projects.html#upload-a-file-from-your-computer"><i class="fa fa-check"></i><b>2.7.5</b> Upload a file from your computer</a></li>
<li class="chapter" data-level="2.7.6" data-path="rstudio-projects.html"><a href="rstudio-projects.html#reflection-1"><i class="fa fa-check"></i><b>2.7.6</b> Reflection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-r-markdown.html"><a href="using-r-markdown.html"><i class="fa fa-check"></i><b>3</b> Using R Markdown</a>
<ul>
<li class="chapter" data-level="3.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#getting-started-with-r-markdown"><i class="fa fa-check"></i><b>3.1</b> Getting Started with R Markdown</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#understanding-r-markdown"><i class="fa fa-check"></i><b>3.1.1</b> Understanding R Markdown</a></li>
<li class="chapter" data-level="3.1.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#running-code-in-r-markdown"><i class="fa fa-check"></i><b>3.1.2</b> Running Code in R Markdown</a></li>
<li class="chapter" data-level="3.1.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#headings-and-subheadings"><i class="fa fa-check"></i><b>3.1.3</b> Headings and Subheadings</a></li>
<li class="chapter" data-level="3.1.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#latex-basics"><i class="fa fa-check"></i><b>3.1.4</b> LaTeX Basics</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#compiling-your-final-report"><i class="fa fa-check"></i><b>3.2</b> Compiling your final report</a></li>
<li class="chapter" data-level="3.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#authoring-with-r-markdown"><i class="fa fa-check"></i><b>3.3</b> Authoring with R Markdown</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-syntax"><i class="fa fa-check"></i><b>3.3.1</b> R Markdown Syntax</a></li>
<li class="chapter" data-level="3.3.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-code-chunk-options"><i class="fa fa-check"></i><b>3.3.2</b> R Code Chunk Options</a></li>
<li class="chapter" data-level="3.3.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#inserting-images"><i class="fa fa-check"></i><b>3.3.3</b> Inserting images</a></li>
<li class="chapter" data-level="3.3.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#generating-tables"><i class="fa fa-check"></i><b>3.3.4</b> Generating tables</a></li>
<li class="chapter" data-level="3.3.5" data-path="using-r-markdown.html"><a href="using-r-markdown.html#spellcheck-in-r-markdown"><i class="fa fa-check"></i><b>3.3.5</b> Spellcheck in R Markdown</a></li>
<li class="chapter" data-level="3.3.6" data-path="using-r-markdown.html"><a href="using-r-markdown.html#exporting-r-markdown-documents"><i class="fa fa-check"></i><b>3.3.6</b> Exporting R Markdown documents</a></li>
<li class="chapter" data-level="3.3.7" data-path="using-r-markdown.html"><a href="using-r-markdown.html#rstudio-tips-and-tricks"><i class="fa fa-check"></i><b>3.3.7</b> RStudio tips and tricks</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="using-r-markdown.html"><a href="using-r-markdown.html#r-markdown-resources"><i class="fa fa-check"></i><b>3.4</b> R Markdown resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html"><i class="fa fa-check"></i><b>4</b> How to Use This Textbook</a>
<ul>
<li class="chapter" data-level="4.1" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#useful-features"><i class="fa fa-check"></i><b>4.1</b> Useful Features</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#searching-the-textbook"><i class="fa fa-check"></i><b>4.1.1</b> Searching the Textbook</a></li>
<li class="chapter" data-level="4.1.2" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#original-r-markdown-of-the-textbook-chapters"><i class="fa fa-check"></i><b>4.1.2</b> Original R Markdown of the Textbook Chapters</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#end-of-chapter-exercises"><i class="fa fa-check"></i><b>4.2</b> End-of-Chapter Exercises</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#optional-extra-questions"><i class="fa fa-check"></i><b>4.2.1</b> Optional Extra Questions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#running-tests-for-your-exercises"><i class="fa fa-check"></i><b>4.3</b> Running Tests for Your Exercises</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#how-to-run-the-tests"><i class="fa fa-check"></i><b>4.3.1</b> How to Run the Tests</a></li>
<li class="chapter" data-level="4.3.2" data-path="how-to-use-this-textbook.html"><a href="how-to-use-this-textbook.html#optional-autotests-on-markus"><i class="fa fa-check"></i><b>4.3.2</b> Optional: Autotests on MarkUs</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part 2: How to Code in R</b></span></li>
<li class="chapter" data-level="5" data-path="r-coding-basics.html"><a href="r-coding-basics.html"><i class="fa fa-check"></i><b>5</b> R Coding Basics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#variables"><i class="fa fa-check"></i><b>5.1</b> Variables</a></li>
<li class="chapter" data-level="5.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-types"><i class="fa fa-check"></i><b>5.2</b> Data Types</a></li>
<li class="chapter" data-level="5.3" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-structures"><i class="fa fa-check"></i><b>5.3</b> Data Structures</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#data-frames"><i class="fa fa-check"></i><b>5.3.1</b> Data Frames</a></li>
<li class="chapter" data-level="5.3.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#accessing-data-in-subfolders"><i class="fa fa-check"></i><b>5.3.2</b> Accessing Data in Subfolders</a></li>
<li class="chapter" data-level="5.3.3" data-path="r-coding-basics.html"><a href="r-coding-basics.html#other-data-structures"><i class="fa fa-check"></i><b>5.3.3</b> Other Data Structures</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="r-coding-basics.html"><a href="r-coding-basics.html#conditional-statements"><i class="fa fa-check"></i><b>5.4</b> Conditional Statements</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#understanding-r-syntax"><i class="fa fa-check"></i><b>5.4.1</b> Understanding R Syntax</a></li>
<li class="chapter" data-level="5.4.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#the-basic-if-statement"><i class="fa fa-check"></i><b>5.4.2</b> The Basic <code>if</code> Statement</a></li>
<li class="chapter" data-level="5.4.3" data-path="r-coding-basics.html"><a href="r-coding-basics.html#expanding-with-else-and-else-if"><i class="fa fa-check"></i><b>5.4.3</b> Expanding with <code>else</code> and <code>else if</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="r-coding-basics.html"><a href="r-coding-basics.html#r-built-in-functions"><i class="fa fa-check"></i><b>5.5</b> R built-in Functions</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="r-coding-basics.html"><a href="r-coding-basics.html#exploring-more-built-in-functions"><i class="fa fa-check"></i><b>5.5.1</b> Exploring More Built-In Functions</a></li>
<li class="chapter" data-level="5.5.2" data-path="r-coding-basics.html"><a href="r-coding-basics.html#function-documentation"><i class="fa fa-check"></i><b>5.5.2</b> Function Documentation</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="r-coding-basics.html"><a href="r-coding-basics.html#summary-2"><i class="fa fa-check"></i><b>5.6</b> Summary</a></li>
<li class="chapter" data-level="5.7" data-path="r-coding-basics.html"><a href="r-coding-basics.html#exercise-2"><i class="fa fa-check"></i><b>5.7</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html"><i class="fa fa-check"></i><b>6</b> Workflows for R Coding</a>
<ul>
<li class="chapter" data-level="6.1" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#creating-or-opening-an-r-markdown-document"><i class="fa fa-check"></i><b>6.1</b> Creating or opening an R Markdown document</a></li>
<li class="chapter" data-level="6.2" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#workspace-and-whats-real"><i class="fa fa-check"></i><b>6.2</b> Workspace and What’s Real</a></li>
<li class="chapter" data-level="6.3" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#saving-r-markdown"><i class="fa fa-check"></i><b>6.3</b> Saving R Markdown</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#what-should-i-save"><i class="fa fa-check"></i><b>6.3.1</b> What Should I Save?</a></li>
<li class="chapter" data-level="6.3.2" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#saving-data-frames"><i class="fa fa-check"></i><b>6.3.2</b> Saving Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#script-formatting"><i class="fa fa-check"></i><b>6.4</b> Script formatting</a></li>
<li class="chapter" data-level="6.5" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#viewing-data-and-code-simultaneously"><i class="fa fa-check"></i><b>6.5</b> Viewing Data and Code Simultaneously</a></li>
<li class="chapter" data-level="6.6" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#troubleshooting-error-messages"><i class="fa fa-check"></i><b>6.6</b> Troubleshooting Error Messages</a></li>
<li class="chapter" data-level="6.7" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#summary-3"><i class="fa fa-check"></i><b>6.7</b> Summary</a></li>
<li class="chapter" data-level="6.8" data-path="workflows-for-r-coding.html"><a href="workflows-for-r-coding.html#exercise-3"><i class="fa fa-check"></i><b>6.8</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>7</b> R Packages</a>
<ul>
<li class="chapter" data-level="7.1" data-path="r-packages.html"><a href="r-packages.html#what-are-r-packages"><i class="fa fa-check"></i><b>7.1</b> What are R packages?</a></li>
<li class="chapter" data-level="7.2" data-path="r-packages.html"><a href="r-packages.html#how-to-use-r-packages"><i class="fa fa-check"></i><b>7.2</b> How to use R packages</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="r-packages.html"><a href="r-packages.html#how-to-install-packages"><i class="fa fa-check"></i><b>7.2.1</b> How to install packages</a></li>
<li class="chapter" data-level="7.2.2" data-path="r-packages.html"><a href="r-packages.html#how-to-load-packages"><i class="fa fa-check"></i><b>7.2.2</b> How to load packages</a></li>
<li class="chapter" data-level="7.2.3" data-path="r-packages.html"><a href="r-packages.html#calling-specific-functions"><i class="fa fa-check"></i><b>7.2.3</b> Calling specific functions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="r-packages.html"><a href="r-packages.html#tidyverse-the-golden-toolbox-of-r"><i class="fa fa-check"></i><b>7.3</b> Tidyverse: The Golden Toolbox of R</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="r-packages.html"><a href="r-packages.html#loading-the-tidyverse"><i class="fa fa-check"></i><b>7.3.1</b> Loading the Tidyverse</a></li>
<li class="chapter" data-level="7.3.2" data-path="r-packages.html"><a href="r-packages.html#data-visualization"><i class="fa fa-check"></i><b>7.3.2</b> Data Visualization</a></li>
<li class="chapter" data-level="7.3.3" data-path="r-packages.html"><a href="r-packages.html#data-manipulation"><i class="fa fa-check"></i><b>7.3.3</b> Data Manipulation</a></li>
<li class="chapter" data-level="7.3.4" data-path="r-packages.html"><a href="r-packages.html#efficient-data-reading"><i class="fa fa-check"></i><b>7.3.4</b> Efficient Data Reading</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="r-packages.html"><a href="r-packages.html#summary-4"><i class="fa fa-check"></i><b>7.4</b> Summary</a></li>
<li class="chapter" data-level="7.5" data-path="r-packages.html"><a href="r-packages.html#exercise-4"><i class="fa fa-check"></i><b>7.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="loops-and-functions-in-r.html"><a href="loops-and-functions-in-r.html"><i class="fa fa-check"></i><b>8</b> Loops and Functions in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="loops-and-functions-in-r.html"><a href="loops-and-functions-in-r.html#loops"><i class="fa fa-check"></i><b>8.1</b> Loops</a></li>
<li class="chapter" data-level="8.2" data-path="loops-and-functions-in-r.html"><a href="loops-and-functions-in-r.html#writing-custom-functions-in-r"><i class="fa fa-check"></i><b>8.2</b> Writing custom functions in R</a></li>
<li class="chapter" data-level="8.3" data-path="loops-and-functions-in-r.html"><a href="loops-and-functions-in-r.html#further_reading_chapter8"><i class="fa fa-check"></i><b>8.3</b> Further reading</a></li>
</ul></li>
<li class="part"><span><b>Part 3: Data Analysis in R</b></span></li>
<li class="chapter" data-level="9" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html"><i class="fa fa-check"></i><b>9</b> Intro to Data Analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#example-data"><i class="fa fa-check"></i><b>9.1</b> Example Data</a></li>
<li class="chapter" data-level="9.2" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#sneak-peek-at-data-analysis"><i class="fa fa-check"></i><b>9.2</b> Sneak Peek at Data Analysis</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#setting-up"><i class="fa fa-check"></i><b>9.2.1</b> Setting Up</a></li>
<li class="chapter" data-level="9.2.2" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#tidying-our-data"><i class="fa fa-check"></i><b>9.2.2</b> Tidying Our Data</a></li>
<li class="chapter" data-level="9.2.3" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#investigating-storm-patterns"><i class="fa fa-check"></i><b>9.2.3</b> Investigating Storm Patterns</a></li>
<li class="chapter" data-level="9.2.4" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#visualization-geographical-distribution"><i class="fa fa-check"></i><b>9.2.4</b> Visualization: Geographical Distribution</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="intro-to-data-analysis.html"><a href="intro-to-data-analysis.html#further_reading_chapter9"><i class="fa fa-check"></i><b>9.3</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html"><i class="fa fa-check"></i><b>10</b> Importing Your Data Into R</a>
<ul>
<li class="chapter" data-level="10.1" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#csv-files"><i class="fa fa-check"></i><b>10.1</b> csv files</a></li>
<li class="chapter" data-level="10.2" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#read_csv"><i class="fa fa-check"></i><b>10.2</b> <code>read_csv</code></a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#tibbles-vs.-data-frames"><i class="fa fa-check"></i><b>10.2.1</b> Tibbles vs. data frames</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#importing-other-data-types"><i class="fa fa-check"></i><b>10.3</b> Importing other data types</a></li>
<li class="chapter" data-level="10.4" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#saving-data"><i class="fa fa-check"></i><b>10.4</b> Saving data</a></li>
<li class="chapter" data-level="10.5" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#further_reading_chapter10"><i class="fa fa-check"></i><b>10.5</b> Further Reading</a></li>
<li class="chapter" data-level="10.6" data-path="importing-your-data-into-r.html"><a href="importing-your-data-into-r.html#exercise-5"><i class="fa fa-check"></i><b>10.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tidying-your-data.html"><a href="tidying-your-data.html"><i class="fa fa-check"></i><b>11</b> Tidying Your Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#what-is-tidy-data"><i class="fa fa-check"></i><b>11.1</b> What is tidy data?</a></li>
<li class="chapter" data-level="11.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tools-to-tidy-your-data"><i class="fa fa-check"></i><b>11.2</b> Tools to tidy your data</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="tidying-your-data.html"><a href="tidying-your-data.html#selection-helpers"><i class="fa fa-check"></i><b>11.2.1</b> Selection helpers</a></li>
<li class="chapter" data-level="11.2.2" data-path="tidying-your-data.html"><a href="tidying-your-data.html#separating-columns"><i class="fa fa-check"></i><b>11.2.2</b> Separating columns</a></li>
<li class="chapter" data-level="11.2.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#unitingcombining-columns"><i class="fa fa-check"></i><b>11.2.3</b> Uniting/combining columns</a></li>
<li class="chapter" data-level="11.2.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#renaming-columnsheaders"><i class="fa fa-check"></i><b>11.2.4</b> Renaming columns/headers</a></li>
<li class="chapter" data-level="11.2.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#chaining-multiple-operations"><i class="fa fa-check"></i><b>11.2.5</b> Chaining multiple operations</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="tidying-your-data.html"><a href="tidying-your-data.html#tips-for-recording-data"><i class="fa fa-check"></i><b>11.3</b> Tips for recording data</a></li>
<li class="chapter" data-level="11.4" data-path="tidying-your-data.html"><a href="tidying-your-data.html#further_reading_chapter11"><i class="fa fa-check"></i><b>11.4</b> Further reading</a></li>
<li class="chapter" data-level="11.5" data-path="tidying-your-data.html"><a href="tidying-your-data.html#chapter-references"><i class="fa fa-check"></i><b>11.5</b> Chapter References</a></li>
<li class="chapter" data-level="11.6" data-path="tidying-your-data.html"><a href="tidying-your-data.html#exercise-6"><i class="fa fa-check"></i><b>11.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html"><i class="fa fa-check"></i><b>12</b> Transform: Data Manipulation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#selecting-by-row-or-value"><i class="fa fa-check"></i><b>12.1</b> Selecting by row or value</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#logical-operators"><i class="fa fa-check"></i><b>12.1.1</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#arranging-rows"><i class="fa fa-check"></i><b>12.2</b> Arranging rows</a></li>
<li class="chapter" data-level="12.3" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#selecting-column-name"><i class="fa fa-check"></i><b>12.3</b> Selecting column name</a></li>
<li class="chapter" data-level="12.4" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#deleting-columns-or-rows"><i class="fa fa-check"></i><b>12.4</b> Deleting Columns or Rows</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#deleting-columns"><i class="fa fa-check"></i><b>12.4.1</b> Deleting columns</a></li>
<li class="chapter" data-level="12.4.2" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#deleting-rows"><i class="fa fa-check"></i><b>12.4.2</b> Deleting rows</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#adding-new-variables"><i class="fa fa-check"></i><b>12.5</b> Adding new variables</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#mutate-with-a-condition"><i class="fa fa-check"></i><b>12.5.1</b> Mutate with a condition</a></li>
<li class="chapter" data-level="12.5.2" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#useful-mutate-function"><i class="fa fa-check"></i><b>12.5.2</b> Useful mutate function</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#group-and-summarize-data"><i class="fa fa-check"></i><b>12.6</b> Group and summarize data</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#useful-summarize-functions"><i class="fa fa-check"></i><b>12.6.1</b> Useful summarize functions</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#the-pipe-chaining-functions-together"><i class="fa fa-check"></i><b>12.7</b> The Pipe: Chaining Functions Together</a>
<ul>
<li class="chapter" data-level="12.7.1" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#function-composition-example"><i class="fa fa-check"></i><b>12.7.1</b> Function Composition Example</a></li>
<li class="chapter" data-level="12.7.2" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#abstract-example-of-piping"><i class="fa fa-check"></i><b>12.7.2</b> Abstract Example of Piping</a></li>
<li class="chapter" data-level="12.7.3" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#simple-examples-of-piping"><i class="fa fa-check"></i><b>12.7.3</b> Simple Examples of Piping</a></li>
<li class="chapter" data-level="12.7.4" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#piping-in-practice"><i class="fa fa-check"></i><b>12.7.4</b> Piping in Practice</a></li>
<li class="chapter" data-level="12.7.5" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#notes-on-piping"><i class="fa fa-check"></i><b>12.7.5</b> Notes on piping</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#further_reading_chapter12"><i class="fa fa-check"></i><b>12.8</b> Further reading</a></li>
<li class="chapter" data-level="12.9" data-path="transform-data-manipulation.html"><a href="transform-data-manipulation.html#exercise-7"><i class="fa fa-check"></i><b>12.9</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html"><i class="fa fa-check"></i><b>13</b> Ggplot Basic Visualizations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html#building-plots-ups"><i class="fa fa-check"></i><b>13.1</b> Building plots ups</a></li>
<li class="chapter" data-level="13.2" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html#basic-plotting"><i class="fa fa-check"></i><b>13.2</b> Basic plotting</a></li>
<li class="chapter" data-level="13.3" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html#changing-plot-labels"><i class="fa fa-check"></i><b>13.3</b> Changing plot labels</a></li>
<li class="chapter" data-level="13.4" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html#small-multiples"><i class="fa fa-check"></i><b>13.4</b> Small Multiples</a></li>
<li class="chapter" data-level="13.5" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html#plotting-subsets-of-data"><i class="fa fa-check"></i><b>13.5</b> Plotting subsets of data</a></li>
<li class="chapter" data-level="13.6" data-path="ggplot-basic-visualizations.html"><a href="ggplot-basic-visualizations.html#exercise-8"><i class="fa fa-check"></i><b>13.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="summarizing-data.html"><a href="summarizing-data.html"><i class="fa fa-check"></i><b>14</b> Summarizing Data</a>
<ul>
<li class="chapter" data-level="14.1" data-path="summarizing-data.html"><a href="summarizing-data.html#data-to-play-with"><i class="fa fa-check"></i><b>14.1</b> Data to Play With</a></li>
<li class="chapter" data-level="14.2" data-path="summarizing-data.html"><a href="summarizing-data.html#summarizing-data-by-group"><i class="fa fa-check"></i><b>14.2</b> Summarizing Data by Group</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="summarizing-data.html"><a href="summarizing-data.html#further-summarize-operations"><i class="fa fa-check"></i><b>14.2.1</b> Further Summarize Operations</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="summarizing-data.html"><a href="summarizing-data.html#pretty-tables-with-flextable"><i class="fa fa-check"></i><b>14.3</b> Pretty Tables with Flextable</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="summarizing-data.html"><a href="summarizing-data.html#uniting-columns"><i class="fa fa-check"></i><b>14.3.1</b> Uniting columns</a></li>
<li class="chapter" data-level="14.3.2" data-path="summarizing-data.html"><a href="summarizing-data.html#pretty-tables"><i class="fa fa-check"></i><b>14.3.2</b> Pretty tables</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="summarizing-data.html"><a href="summarizing-data.html#exercise-9"><i class="fa fa-check"></i><b>14.4</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html"><i class="fa fa-check"></i><b>15</b> Restructuring Your Data</a>
<ul>
<li class="chapter" data-level="15.1" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#long-vs-wide-data"><i class="fa fa-check"></i><b>15.1</b> Long vs Wide Data</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#long-data"><i class="fa fa-check"></i><b>15.1.1</b> Long Data</a></li>
<li class="chapter" data-level="15.1.2" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#wide-data"><i class="fa fa-check"></i><b>15.1.2</b> Wide Data</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#making-data-longer"><i class="fa fa-check"></i><b>15.2</b> Making Data Longer</a></li>
<li class="chapter" data-level="15.3" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#making-data-wider"><i class="fa fa-check"></i><b>15.3</b> Making Data Wider</a></li>
<li class="chapter" data-level="15.4" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#summary-5"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
<li class="chapter" data-level="15.5" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#further_reading_chapter15"><i class="fa fa-check"></i><b>15.5</b> Further reading</a></li>
<li class="chapter" data-level="15.6" data-path="restructuring-your-data.html"><a href="restructuring-your-data.html#exercise-10"><i class="fa fa-check"></i><b>15.6</b> Exercise</a></li>
</ul></li>
<li class="part"><span><b>Part 4: Visualization in R</b></span></li>
<li class="chapter" data-level="16" data-path="visualizations-for-env-chem.html"><a href="visualizations-for-env-chem.html"><i class="fa fa-check"></i><b>16</b> Visualizations for Env Chem</a>
<ul>
<li class="chapter" data-level="16.1" data-path="visualizations-for-env-chem.html"><a href="visualizations-for-env-chem.html#discrete-vs.-continuous-variables"><i class="fa fa-check"></i><b>16.1</b> Discrete vs. Continuous variables</a></li>
<li class="chapter" data-level="16.2" data-path="visualizations-for-env-chem.html"><a href="visualizations-for-env-chem.html#prerequisites"><i class="fa fa-check"></i><b>16.2</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html"><i class="fa fa-check"></i><b>17</b> Common Types of Graphs</a>
<ul>
<li class="chapter" data-level="17.1" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#bar-charts"><i class="fa fa-check"></i><b>17.1</b> Bar Charts</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#adding-error-bars"><i class="fa fa-check"></i><b>17.1.1</b> Adding Error Bars</a></li>
<li class="chapter" data-level="17.1.2" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#ordering-bar-charts"><i class="fa fa-check"></i><b>17.1.2</b> Ordering Bar Charts</a></li>
<li class="chapter" data-level="17.1.3" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#grouping-bar-charts"><i class="fa fa-check"></i><b>17.1.3</b> Grouping Bar Charts</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#box-plots"><i class="fa fa-check"></i><b>17.2</b> Box Plots</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#violin-plots"><i class="fa fa-check"></i><b>17.2.1</b> Violin Plots</a></li>
<li class="chapter" data-level="17.2.2" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#statistical-comparisons-between-groups"><i class="fa fa-check"></i><b>17.2.2</b> Statistical Comparisons Between Groups</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#histograms"><i class="fa fa-check"></i><b>17.3</b> Histograms</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#multiple-histograms"><i class="fa fa-check"></i><b>17.3.1</b> Multiple histograms</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#scatter-plots"><i class="fa fa-check"></i><b>17.4</b> Scatter Plots</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#marginal-plots"><i class="fa fa-check"></i><b>17.4.1</b> Marginal plots</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="common-types-of-graphs.html"><a href="common-types-of-graphs.html#exercise-11"><i class="fa fa-check"></i><b>17.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html"><i class="fa fa-check"></i><b>18</b> Customizing your plots</a>
<ul>
<li class="chapter" data-level="18.1" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#interactive-plots"><i class="fa fa-check"></i><b>18.1</b> Interactive Plots</a></li>
<li class="chapter" data-level="18.2" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#plot-themes"><i class="fa fa-check"></i><b>18.2</b> Plot Themes</a></li>
<li class="chapter" data-level="18.3" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#legends"><i class="fa fa-check"></i><b>18.3</b> Legends</a></li>
<li class="chapter" data-level="18.4" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#modifying-labels"><i class="fa fa-check"></i><b>18.4</b> Modifying labels</a></li>
<li class="chapter" data-level="18.5" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#modifying-axis"><i class="fa fa-check"></i><b>18.5</b> Modifying Axis</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#transforming-axis"><i class="fa fa-check"></i><b>18.5.1</b> Transforming axis</a></li>
<li class="chapter" data-level="18.5.2" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#axis-limits"><i class="fa fa-check"></i><b>18.5.2</b> Axis limits</a></li>
<li class="chapter" data-level="18.5.3" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#axis-tickslabels"><i class="fa fa-check"></i><b>18.5.3</b> Axis ticks/labels</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#arranging-plots"><i class="fa fa-check"></i><b>18.6</b> Arranging plots</a></li>
<li class="chapter" data-level="18.7" data-path="customizing-your-plots.html"><a href="customizing-your-plots.html#exercise-12"><i class="fa fa-check"></i><b>18.7</b> Exercise</a></li>
</ul></li>
<li class="part"><span><b>Part 5: Modelling in R</b></span></li>
<li class="chapter" data-level="19" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html"><i class="fa fa-check"></i><b>19</b> Modelling: Linear Regression</a>
<ul>
<li class="chapter" data-level="19.1" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#modelling-theory"><i class="fa fa-check"></i><b>19.1</b> Modelling Theory</a></li>
<li class="chapter" data-level="19.2" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#linear-regression-in-r"><i class="fa fa-check"></i><b>19.2</b> Linear Regression in R</a></li>
<li class="chapter" data-level="19.3" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#visualizing-your-models"><i class="fa fa-check"></i><b>19.3</b> Visualizing your models</a></li>
<li class="chapter" data-level="19.4" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#accessing-and-using-model-outputs"><i class="fa fa-check"></i><b>19.4</b> Accessing and using model outputs</a></li>
<li class="chapter" data-level="19.5" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#augmented-glanced-and-tidied-model-outputs"><i class="fa fa-check"></i><b>19.5</b> Augmented, glanced, and tidied model outputs</a>
<ul>
<li class="chapter" data-level="19.5.1" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#tidied-outputs"><i class="fa fa-check"></i><b>19.5.1</b> Tidied outputs</a></li>
<li class="chapter" data-level="19.5.2" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#glanced-outputs"><i class="fa fa-check"></i><b>19.5.2</b> Glanced outputs</a></li>
<li class="chapter" data-level="19.5.3" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#augmented-outputs"><i class="fa fa-check"></i><b>19.5.3</b> Augmented outputs</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#building-linear-regressions-for-multiple-analytes"><i class="fa fa-check"></i><b>19.6</b> Building Linear Regressions for Multiple Analytes</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#dataset"><i class="fa fa-check"></i><b>19.6.1</b> Dataset</a></li>
<li class="chapter" data-level="19.6.2" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#building-a-linear-regression-for-each-analyte"><i class="fa fa-check"></i><b>19.6.2</b> Building a Linear Regression for Each Analyte</a></li>
<li class="chapter" data-level="19.6.3" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#visualizing-linear-regressions-for-each-analyte"><i class="fa fa-check"></i><b>19.6.3</b> Visualizing Linear Regressions for Each Analyte</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#conclusion"><i class="fa fa-check"></i><b>19.7</b> Conclusion</a></li>
<li class="chapter" data-level="19.8" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#further_reading_chapter19"><i class="fa fa-check"></i><b>19.8</b> Further reading</a></li>
<li class="chapter" data-level="19.9" data-path="modelling-linear-regression.html"><a href="modelling-linear-regression.html#exercise-13"><i class="fa fa-check"></i><b>19.9</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html"><i class="fa fa-check"></i><b>20</b> Evaluating and Improving Model Performance</a>
<ul>
<li class="chapter" data-level="20.1" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#residuals-for-model-appropriateness"><i class="fa fa-check"></i><b>20.1</b> Residuals for Model Appropriateness</a></li>
<li class="chapter" data-level="20.2" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#nonlinear-calibration-curves"><i class="fa fa-check"></i><b>20.2</b> Nonlinear Calibration Curves</a></li>
<li class="chapter" data-level="20.3" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#weighted-calibration-curves"><i class="fa fa-check"></i><b>20.3</b> Weighted Calibration Curves</a></li>
<li class="chapter" data-level="20.4" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#removing-outliers"><i class="fa fa-check"></i><b>20.4</b> Removing outliers</a></li>
<li class="chapter" data-level="20.5" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#evaluating-model-performance"><i class="fa fa-check"></i><b>20.5</b> Evaluating Model Performance</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#choosing-the-best-model"><i class="fa fa-check"></i><b>20.5.1</b> Choosing the best model</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#to-weight-or-not-to-weight"><i class="fa fa-check"></i><b>20.5.2</b> To weight or not to weight?</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#do-i-need-an-intercept"><i class="fa fa-check"></i><b>20.5.3</b> Do I Need an Intercept?</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#model-selection-conclusions"><i class="fa fa-check"></i><b>20.5.4</b> Model Selection: Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#using-calibration-curves-to-estimate-lod-and-loq"><i class="fa fa-check"></i><b>20.6</b> Using Calibration Curves to Estimate LOD and LOQ</a></li>
<li class="chapter" data-level="20.7" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#inverse-calibration-curves"><i class="fa fa-check"></i><b>20.7</b> Inverse Calibration Curves</a></li>
<li class="chapter" data-level="20.8" data-path="evaluating-and-improving-model-performance.html"><a href="evaluating-and-improving-model-performance.html#exercise-14"><i class="fa fa-check"></i><b>20.8</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html"><i class="fa fa-check"></i><b>21</b> Modelling: Non-Linear Regression</a>
<ul>
<li class="chapter" data-level="21.1" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#experimental-background"><i class="fa fa-check"></i><b>21.1</b> Experimental Background</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#annotating-maximal-values"><i class="fa fa-check"></i><b>21.1.1</b> Annotating maximal values</a></li>
<li class="chapter" data-level="21.1.2" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#extracting-maximal-values"><i class="fa fa-check"></i><b>21.1.2</b> Extracting maximal values</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#modelling-sigmoid-curve"><i class="fa fa-check"></i><b>21.2</b> Modelling Sigmoid Curve</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#calculating-logistic-regression"><i class="fa fa-check"></i><b>21.2.1</b> Calculating Logistic Regression</a></li>
<li class="chapter" data-level="21.2.2" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#extracting-model-parameters"><i class="fa fa-check"></i><b>21.2.2</b> Extracting model parameters</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#summary-6"><i class="fa fa-check"></i><b>21.3</b> Summary</a></li>
<li class="chapter" data-level="21.4" data-path="modelling-non-linear-regression.html"><a href="modelling-non-linear-regression.html#exercise-15"><i class="fa fa-check"></i><b>21.4</b> Exercise</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Environmental Chemistry</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling-linear-regression" class="section level1 hasAnchor" number="19">
<h1><span class="header-section-number">Chapter 19</span> Modelling: Linear Regression<a href="modelling-linear-regression.html#modelling-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Modelling is basically math used to describe some type of system, and they are a forte of R, a language tailor made for statistical computing. Every model has assumptions, limitations, and all around tricky bits to working. There is no shortage of modelling in a myriad of contexts, but in this chapter we’ll discuss and break down the most common model you’ll encounter, the <em>linear regression model</em>, in the most common context, the <em>linear calibration model</em>, using the most common function, <code>lm</code>.</p>
<p>You have probably encountered the linear regression model under the pseudonym “trend-lines”, most likely generated by <em>Excel</em>’s “add trend-line option” (<a href="https://uoftchem-teaching.github.io/excel4chem/data-visualization.html#adding-a-linear-regression-line">as in CHM135</a>). While the models we’ll be constructing with <code>lm</code> work much the same <em>mathematically</em>, unlike <em>Excel</em>, R returns <em>all</em> of the model outputs. Correspondingly, it’s easy to get lost between juggling R code, the seemingly endless model outputs, and keeping yourself grounded in the real systems you’re attempting to model.</p>
<div id="modelling-theory" class="section level2 hasAnchor" number="19.1">
<h2><span class="header-section-number">19.1</span> Modelling Theory<a href="modelling-linear-regression.html#modelling-theory" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <em>linear calibration model</em> relates the response of an instrument to the value of the <em>measurand</em>. The measurand is simply what we’re measuring, often the concentration of an analyte. So we use the measurand, which we can control via preparation of standards from reference material as the <em>independent</em> variable, with the instrument output being the <em>dependent</em> variable (as instrument response varies with concentration). Altogether we’re:</p>
<ol style="list-style-type: decimal">
<li>Measuring the instrument response of standards of known concentration and samples of unknowns concentration.</li>
<li>Calculating the linear calibration model (i.e. line of best fit) through our standards.</li>
<li>Using the measurement model to calculate the concentration in our unknown from their respective instrument response.</li>
</ol>
<p>This is summarized in the figure below.</p>
<div class="figure"><span style="display:block;" id="fig:reg-plot"></span>
<img src="R4EnvChem_files/figure-html/reg-plot-1.png" alt="Linear calibration model; figure modified from Hibbert and Gooding (2006)." width="672" />
<p class="caption">
Figure 19.1: Linear calibration model; figure modified from Hibbert and Gooding (2006).
</p>
</div>
<p>Before we can calculate concentrations, we need a measurement model. In other words, an equation that relates instrument response to sample concentration (or other factors). For simple linear calibration, we use:</p>
<p><span class="math display">\[y = a + bx\]</span>
Where:</p>
<ul>
<li><span class="math inline">\(y\)</span> is the instrument response</li>
<li><span class="math inline">\(x\)</span> is the independent variable (i.e. sample concentration)</li>
<li><span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are the coefficients of the model; otherwise known as intercept and slope, respectively.</li>
</ul>
<p>We’ll gloss over some of the more technical aspects of modelling, and discuss other in more detail below. For now, know that:</p>
<ul>
<li>We’re assuming our linear model is correct (i.e. the instruments actually respond linearly to concentration).</li>
<li>All uncertainties reside in the dependent variable <span class="math inline">\(y\)</span> (i.e., no errors in preparation of the standards).</li>
<li>The values of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are determined by minimizing the <em>sum of the residuals squared</em>.
<ul>
<li>The residuals are the difference between the actual measured response and where it would be if it were on the calibration line.</li>
</ul></li>
</ul>
<p>Once we have our line of best fit, we can calculate the concentration of our unknown sample <span class="math inline">\(i\)</span>, from its measured response <span class="math inline">\(y_i\)</span> by:</p>
<p><span class="math display">\[x_i = \frac{y_i - b}{a}\]</span></p>
<p>There is more going on under the hood than what we’re describing here, but this should be enough to get you up and running. If you would like a greater breakdown of linear calibration modelling, we suggest you read Chapter 5 of <em>Data Analysis for Chemistry</em> by Hibbert and Gooding. An online version is accessible via the University of Toronto’s Library. There is also no reason the instrument response must be linear. In fact, we spend a great deal of time arranging our experiment so that we land in the ‘linear range’. For details on developing non-linear calibration curves in R see <a href="evaluating-and-improving-model-performance.html#evaluating-and-improving-model-performance">Evaluating and Improving Model Performance</a>.</p>
</div>
<div id="linear-regression-in-r" class="section level2 hasAnchor" number="19.2">
<h2><span class="header-section-number">19.2</span> Linear Regression in R<a href="modelling-linear-regression.html#linear-regression-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we have a rough understanding of what we’re trying to do, let’s go over <em>how</em> to calculate linear regression models in R. Note model is a general term, in this situation we’ll be calculating a calibration curve. All calibration curves are models, but not all models are calibration curves.</p>
<p>For our example dataset we’ll import a dataset consisting of four analytical standards of sodium plus a calibration blank all run in triplicate. The standards were measured via flame atomic emission spectroscopy (FAES). Let’s import the FAES calibration results we saw in <a href="transform-data-manipulation.html#transform-data-manipulation">Transform: Data manipulation</a>. As we’ve already seen, our data is composed of four standards and a blank analyzed in triplicate. Since we’re focusing on modelling, <em>we’ll treat the blank as a standard in our model fitting</em>. So let’s import our dataset. Note that to make our tables more readable in the HTML version of this textbook, we are generating our tables using the DataTables library using the format <code>DT::datatable()</code>:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="modelling-linear-regression.html#cb262-1" tabindex="-1"></a>FAES <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/FAES_original_wide.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="modelling-linear-regression.html#cb262-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>std_Na_conc,</span>
<span id="cb262-3"><a href="modelling-linear-regression.html#cb262-3" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;replicate&quot;</span>, </span>
<span id="cb262-4"><a href="modelling-linear-regression.html#cb262-4" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;reading_&quot;</span>,</span>
<span id="cb262-5"><a href="modelling-linear-regression.html#cb262-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;signal&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb262-6"><a href="modelling-linear-regression.html#cb262-6" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> std_Na_conc,</span>
<span id="cb262-7"><a href="modelling-linear-regression.html#cb262-7" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;conc_Na&quot;</span>, <span class="st">&quot;units&quot;</span>),</span>
<span id="cb262-8"><a href="modelling-linear-regression.html#cb262-8" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb262-9"><a href="modelling-linear-regression.html#cb262-9" tabindex="-1"></a>           <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb262-10"><a href="modelling-linear-regression.html#cb262-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;standard&quot;</span>)</span>
<span id="cb262-11"><a href="modelling-linear-regression.html#cb262-11" tabindex="-1"></a></span>
<span id="cb262-12"><a href="modelling-linear-regression.html#cb262-12" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(FAES)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3e35210f0ba7a2ae4264" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3e35210f0ba7a2ae4264">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard"],[0,0,0,0.1,0.1,0.1,0.2,0.2,0.2,0.5,0.5,0.5,1,1,1],["ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm","ppm"],["1","2","3","1","2","3","1","2","3","1","2","3","1","2","3"],[502.3391,591.7768,581.4588,5656.342,5653.5584,5667.4387,9393.4167,9362.685799999999,9332.049800000001,20186.9033,20140.5115,20152.9856,30797.6935,30836.5239,30789.8266]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>conc_Na<\/th>\n      <th>units<\/th>\n      <th>replicate<\/th>\n      <th>signal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"type","targets":1},{"name":"conc_Na","targets":2},{"name":"units","targets":3},{"name":"replicate","targets":4},{"name":"signal","targets":5}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>And let’s quickly plot our data. You should always visualize your data before modelling, especially for linear calibration modelling. Visualizing your data is an easy way to spot trends and gross errors in your data.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="modelling-linear-regression.html#cb263-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> FAES,</span>
<span id="cb263-2"><a href="modelling-linear-regression.html#cb263-2" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> conc_Na, </span>
<span id="cb263-3"><a href="modelling-linear-regression.html#cb263-3" tabindex="-1"></a>           <span class="at">y =</span> signal)) <span class="sc">+</span></span>
<span id="cb263-4"><a href="modelling-linear-regression.html#cb263-4" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<p>Let’s use the <code>lm</code> function to calculate the linear relationship between the <code>signal</code> as a function of <code>conc_Na</code>:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="modelling-linear-regression.html#cb264-1" tabindex="-1"></a>lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(signal <span class="sc">~</span> conc_Na, <span class="at">data =</span> FAES)</span>
<span id="cb264-2"><a href="modelling-linear-regression.html#cb264-2" tabindex="-1"></a>lmfit</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = signal ~ conc_Na, data = FAES)
## 
## Coefficients:
## (Intercept)      conc_Na  
##        2615        29707</code></pre>
<p>Reading the code above:</p>
<ol style="list-style-type: decimal">
<li>We’re using the FAES data we created earlier: <code>data = FAES</code>.</li>
<li>We’re comparing <code>signal</code> (the dependent variable) to <code>conc_Na</code> (the independent variable) via the tilde <code>~</code>. The way to read this is: <em>“signal depends on concentration”</em>.</li>
<li>We’re fitting a <em>linear model</em> for comparing these two variables indicated by <code>lm()</code></li>
<li>The model’s outputs are stored in the <code>lmfit</code> variable.</li>
</ol>
<p>As we can see, the model outputs are pretty brief and not much more than <em>Excel</em>’s outputs.</p>
<p>We can use <code>summary()</code> to extract more information to better understand our model:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="modelling-linear-regression.html#cb266-1" tabindex="-1"></a><span class="fu">summary</span>(lmfit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = signal ~ conc_Na, data = FAES)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2112.78 -1528.53    70.51   821.50  2718.20 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2615.1      665.2   3.931  0.00172 ** 
## conc_Na      29707.2     1304.5  22.772 7.34e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1824 on 13 degrees of freedom
## Multiple R-squared:  0.9755, Adjusted R-squared:  0.9737 
## F-statistic: 518.6 on 1 and 13 DF,  p-value: 7.341e-12</code></pre>
<p>This summary provides much more information:</p>
<ol style="list-style-type: decimal">
<li>Under ‘Residuals’, we can see some summary statistics on the residuals of our fit (we will discuss residuals much more in the next chapter)</li>
<li>Under ‘Coefficients’, the fit value (called ‘Estimate’) for each variable, and their predicted standard errors are given. Note that these standard errors are an approximation, but they are good enough to use for most cases.</li>
<li>The next two columns under ‘Coefficients’, ‘t value’ and ‘Pr(&gt;|t|)’, represent a statistical test of the significance of the model fit. Here, ‘Pr(&gt;|t|)’ describes the probability (or p-value) that the fit value for each variable is nonzero (i.e. that the variable contributes significantly to the model). This is described qualitatively by the significance codes - in this case, the intercept has a p-value &lt; 0.01, and the conc-Na (our independent variable) has a p-value of &lt;0.001.</li>
<li>The residual standard error is the root mean square error of all of the residuals of the model.</li>
<li>The <span class="math inline">\(R^2\)</span> values represent the proportion of the variance in the dependent variable that can be explained by the independent variable(s). In general, it is better to use the ‘Adjusted R-squared’, over the ‘Multiple R-squared’, as the ‘Adjusted R-squared’ corrects for a bias in <span class="math inline">\(R^2\)</span> introduced by adding additional variables.</li>
<li>The F-statistic and its p-value compare the model you generated to a model where all variables are zeros (essentially a version of the t values above, but for the overall model). If your p-value is below your threshold of statistical significance (often 0.05), then the variables you included significantly improved the model.</li>
</ol>
<p>The information provided in the model summary can be used to evaluate how well your model describes your data (in our case, how effective the calibration curve we have generated is in describing the instrumental response to our compound) and to predict new values.</p>
</div>
<div id="visualizing-your-models" class="section level2 hasAnchor" number="19.3">
<h2><span class="header-section-number">19.3</span> Visualizing your models<a href="modelling-linear-regression.html#visualizing-your-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While the statistical outputs above provide a lot of information about the quality of our model fit, often the best way to evaluate a model’s performance is visualization. R provides an easy set of tools for visualizing models within the <code>ggplot</code> framework. This can be applied to any model, not just linear regression, but we are showing it here for the calibration curve. To plot a model over existing data, we take our standard scatter plot generated using <code>geom_point</code> and we add a <code>geom_smooth</code> object on top of it.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="modelling-linear-regression.html#cb268-1" tabindex="-1"></a>modelPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> FAES,</span>
<span id="cb268-2"><a href="modelling-linear-regression.html#cb268-2" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> conc_Na, </span>
<span id="cb268-3"><a href="modelling-linear-regression.html#cb268-3" tabindex="-1"></a>           <span class="at">y =</span> signal)) <span class="sc">+</span></span>
<span id="cb268-4"><a href="modelling-linear-regression.html#cb268-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb268-5"><a href="modelling-linear-regression.html#cb268-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb268-6"><a href="modelling-linear-regression.html#cb268-6" tabindex="-1"></a></span>
<span id="cb268-7"><a href="modelling-linear-regression.html#cb268-7" tabindex="-1"></a>modelPlot</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>The <code>geom_smooth</code> function can be used to plot a variety of trend lines over data. In our case, we specify <code>method = 'lm'</code> to ensure that the trend line plotted is a straight line. We also specify <code>se = FALSE</code> to stop the function from plotting error bands around the line, which it would otherwise do by default.</p>
<p>We can also add the equation and <span class="math inline">\(R^2\)</span> value of a model onto a ggplot object using a function from the <code>ggpmisc</code> library, <code>stat_poly_eq</code> as follows (note that we saved our previous plot as modelPlot, so we can just add the new layer on top):</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="modelling-linear-regression.html#cb269-1" tabindex="-1"></a>modelPlot <span class="ot">&lt;-</span> modelPlot <span class="sc">+</span> </span>
<span id="cb269-2"><a href="modelling-linear-regression.html#cb269-2" tabindex="-1"></a>  ggpmisc<span class="sc">::</span><span class="fu">stat_poly_eq</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="co"># formula uses aesthetic names</span></span>
<span id="cb269-3"><a href="modelling-linear-regression.html#cb269-3" tabindex="-1"></a>                        <span class="at">rr.digits =</span> <span class="dv">4</span>, <span class="co"># reported digits of r-squared</span></span>
<span id="cb269-4"><a href="modelling-linear-regression.html#cb269-4" tabindex="-1"></a>                        <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">after_stat</span>(eq.label), <span class="fu">after_stat</span>(rr.label), <span class="at">sep =</span> <span class="st">&quot;~~~&quot;</span>)), </span>
<span id="cb269-5"><a href="modelling-linear-regression.html#cb269-5" tabindex="-1"></a>                        <span class="at">parse =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">5</span>) </span>
<span id="cb269-6"><a href="modelling-linear-regression.html#cb269-6" tabindex="-1"></a>modelPlot</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
<p>The syntax for <code>stat_poly_eq</code> is a little complicated, but it is just a way of showing a polynomial equation based on statistical analysis of a dataset. The polynomial itself is specified by <code>formula = y ~ x</code> (using the names of the variables from the ggplot <code>aes()</code> call). The number of digits in the <span class="math inline">\(R^2\)</span> value is given by <code>rr.digits = 4</code>, the label is given by <code>aeslabel = paste(after_stat(eq.label), after_stat(rr.label), sep = "~~~")</code>. Most of this is formatting - the important parts are <code>after_stat(eq.label)</code>, which calculates the label for the fit equation after statistical analysis, and <code>after_stat(rr.label)</code>, which is the same thing but for the <span class="math inline">\(R^2\)</span> value. You can also change the size of the label by changing <code>size = 5</code>.</p>
</div>
<div id="accessing-and-using-model-outputs" class="section level2 hasAnchor" number="19.4">
<h2><span class="header-section-number">19.4</span> Accessing and using model outputs<a href="modelling-linear-regression.html#accessing-and-using-model-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once you have generated a model, you likely want to use it to make predictions. For simple models like calibration curves, the simplest way to do this is to access the coefficients. Let’s start by importing a dataset to make predictions on:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="modelling-linear-regression.html#cb270-1" tabindex="-1"></a>FAESSamples <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/FAESUnknowns.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb270-2"><a href="modelling-linear-regression.html#cb270-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(sample, <span class="st">`</span><span class="at">dilution factor</span><span class="st">`</span>), </span>
<span id="cb270-3"><a href="modelling-linear-regression.html#cb270-3" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;replicate&quot;</span>,</span>
<span id="cb270-4"><a href="modelling-linear-regression.html#cb270-4" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;reading_&quot;</span>,</span>
<span id="cb270-5"><a href="modelling-linear-regression.html#cb270-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;signal&quot;</span>)</span>
<span id="cb270-6"><a href="modelling-linear-regression.html#cb270-6" tabindex="-1"></a></span>
<span id="cb270-7"><a href="modelling-linear-regression.html#cb270-7" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(FAESSamples)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-84224dfc3664e4af27e0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-84224dfc3664e4af27e0">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["wine","wine","wine","tap-water","tap-water","tap-water","fish-tank","fish-tank","fish-tank"],[10,10,10,10,10,10,100,100,100],["1","2","3","1","2","3","1","2","3"],[12775.1255,12650.6561,12745.6284,8013.9588,7199.6695,7203.2021,12085.29012,12073.45137,12155.61549]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sample<\/th>\n      <th>dilution factor<\/th>\n      <th>replicate<\/th>\n      <th>signal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"sample","targets":1},{"name":"dilution factor","targets":2},{"name":"replicate","targets":3},{"name":"signal","targets":4}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>We can extract the coefficients of our model (recall we stored our calibration curve in the variable <code>lmfit</code>) using the <code>coef</code> function:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="modelling-linear-regression.html#cb271-1" tabindex="-1"></a><span class="fu">coef</span>(lmfit)</span></code></pre></div>
<pre><code>## (Intercept)     conc_Na 
##    2615.119   29707.170</code></pre>
<p>Then, we use some base R indexing syntax in brackets to select which coefficient we want:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="modelling-linear-regression.html#cb273-1" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> <span class="fu">coef</span>(lmfit)[<span class="dv">1</span>]</span>
<span id="cb273-2"><a href="modelling-linear-regression.html#cb273-2" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">coef</span>(lmfit)[<span class="dv">2</span>]</span>
<span id="cb273-3"><a href="modelling-linear-regression.html#cb273-3" tabindex="-1"></a></span>
<span id="cb273-4"><a href="modelling-linear-regression.html#cb273-4" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The equation of our calibration curve is: y = &quot;</span>, intercept, <span class="st">&quot; + &quot;</span>, slope,<span class="st">&quot;*x&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The equation of our calibration curve is: y = 2615.11945030675 + 29707.1701380368*x&quot;</code></pre>
<p>We can apply this calibration curve to our new data directly within tidyverse using the <code>mutate</code> function. Recall that we are trying to calculate our dependent variable, concentration, so we solve the calibration curve equation for x:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="modelling-linear-regression.html#cb275-1" tabindex="-1"></a>FAESSamples <span class="ot">&lt;-</span> FAESSamples <span class="sc">%&gt;%</span></span>
<span id="cb275-2"><a href="modelling-linear-regression.html#cb275-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;instConc&quot;</span> <span class="ot">=</span> (signal <span class="sc">-</span> intercept)<span class="sc">/</span>slope)</span>
<span id="cb275-3"><a href="modelling-linear-regression.html#cb275-3" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(FAESSamples)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-887c318d980dc3598df9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-887c318d980dc3598df9">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["wine","wine","wine","tap-water","tap-water","tap-water","fish-tank","fish-tank","fish-tank"],[10,10,10,10,10,10,100,100,100],["1","2","3","1","2","3","1","2","3"],[12775.1255,12650.6561,12745.6284,8013.9588,7199.6695,7203.2021,12085.29012,12073.45137,12155.61549],[0.3420051793046577,0.3378153019308909,0.3410122506661189,0.1817352283844978,0.1543246976534878,0.1544436117063439,0.3187840048610933,0.3183854899589673,0.3211512909295147]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sample<\/th>\n      <th>dilution factor<\/th>\n      <th>replicate<\/th>\n      <th>signal<\/th>\n      <th>instConc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"sample","targets":1},{"name":"dilution factor","targets":2},{"name":"replicate","targets":3},{"name":"signal","targets":4},{"name":"instConc","targets":5}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Correcting for the supplied dilution factors and summarizing our data a little bit, we have easily calculated the concentrations from a selection of new samples in an automated fashion:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="modelling-linear-regression.html#cb276-1" tabindex="-1"></a>FAESresults <span class="ot">&lt;-</span> FAESSamples <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="modelling-linear-regression.html#cb276-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&#39;SampleConc&#39;</span> <span class="ot">=</span> instConc <span class="sc">*</span> <span class="st">`</span><span class="at">dilution factor</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="modelling-linear-regression.html#cb276-3" tabindex="-1"></a>  <span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span></span>
<span id="cb276-4"><a href="modelling-linear-regression.html#cb276-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">&quot;Mean Concentration Na (ppm)&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(SampleConc), </span>
<span id="cb276-5"><a href="modelling-linear-regression.html#cb276-5" tabindex="-1"></a>            <span class="st">&quot;Standard Deviation (ppm)&quot;</span> <span class="ot">=</span> <span class="fu">sd</span>(SampleConc),</span>
<span id="cb276-6"><a href="modelling-linear-regression.html#cb276-6" tabindex="-1"></a>            <span class="at">N =</span> <span class="fu">n</span>())</span>
<span id="cb276-7"><a href="modelling-linear-regression.html#cb276-7" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(FAESresults)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-edfc1e0744fed0e91ab4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-edfc1e0744fed0e91ab4">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["fish-tank","tap-water","wine"],[31.94402619165251,1.635011792481098,3.402775773005558],[0.14951316812486,0.1579126169972334,0.021894238551161],[3,3,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sample<\/th>\n      <th>Mean Concentration Na (ppm)<\/th>\n      <th>Standard Deviation (ppm)<\/th>\n      <th>N<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"sample","targets":1},{"name":"Mean Concentration Na (ppm)","targets":2},{"name":"Standard Deviation (ppm)","targets":3},{"name":"N","targets":4}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="augmented-glanced-and-tidied-model-outputs" class="section level2 hasAnchor" number="19.5">
<h2><span class="header-section-number">19.5</span> Augmented, glanced, and tidied model outputs<a href="modelling-linear-regression.html#augmented-glanced-and-tidied-model-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In most cases, the base <code>lm</code> function and <code>summary</code> output and will be sufficient for your needs, but there are other ways of presenting model outputs using the <code>broom</code> package, which may or may not be useful. Either way, it’s helpful to be aware of them.</p>
<div id="tidied-outputs" class="section level3 hasAnchor" number="19.5.1">
<h3><span class="header-section-number">19.5.1</span> Tidied outputs<a href="modelling-linear-regression.html#tidied-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function that is most likely to be useful to you is the tidied output, which we will use in the next section. Tidied model outputs allow you to easily access model fit parameters in a tidyverse style. This can be accessed by calling the <code>broom</code> function <code>tidy</code> on the model you have generated. This creates a dataframe (or rather, a tibble) which we can visualize as normal:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="modelling-linear-regression.html#cb277-1" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb277-2"><a href="modelling-linear-regression.html#cb277-2" tabindex="-1"></a></span>
<span id="cb277-3"><a href="modelling-linear-regression.html#cb277-3" tabindex="-1"></a>tidied <span class="ot">&lt;-</span> <span class="fu">tidy</span>(lmfit)</span>
<span id="cb277-4"><a href="modelling-linear-regression.html#cb277-4" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(tidied)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c82725e6a7f1a727ce2e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c82725e6a7f1a727ce2e">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["(Intercept)","conc_Na"],[2615.119450306747,29707.17013803681],[665.1889798813839,1304.542918708483],[3.931393227189472,22.77209106117211],[0.001720952931256512,7.341364277346169e-12]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>term<\/th>\n      <th>estimate<\/th>\n      <th>std.error<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"term","targets":1},{"name":"estimate","targets":2},{"name":"std.error","targets":3},{"name":"statistic","targets":4},{"name":"p.value","targets":5}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>As you can see, the output table has each variable in a row with their respective fit values (called estimate again here), standard errors, t-values, and p-values. These are the same outputs as were given in from the <code>summarize</code> function, but tabulated for easy access. Similar to using the <code>coef</code> function, you can extract model fits to predict new values relatively easily using this format with base R indexing via bracket notation as below. In the next section, we will use this format to automatically apply multiple different calibration curves to a dataset.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="modelling-linear-regression.html#cb278-1" tabindex="-1"></a>tidyIntercept <span class="ot">&lt;-</span> tidied[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb278-2"><a href="modelling-linear-regression.html#cb278-2" tabindex="-1"></a>tidySlope <span class="ot">&lt;-</span> tidied[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb278-3"><a href="modelling-linear-regression.html#cb278-3" tabindex="-1"></a></span>
<span id="cb278-4"><a href="modelling-linear-regression.html#cb278-4" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The equation of our calibration curve is: y = &quot;</span>, tidyIntercept, <span class="st">&quot; + &quot;</span>, tidySlope,<span class="st">&quot;*x&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The equation of our calibration curve is: y = 2615.11945030675 + 29707.1701380368*x&quot;</code></pre>
</div>
<div id="glanced-outputs" class="section level3 hasAnchor" number="19.5.2">
<h3><span class="header-section-number">19.5.2</span> Glanced outputs<a href="modelling-linear-regression.html#glanced-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ‘Glanced’ output is a way of summarizing the quality of the model fit in a single row, so that it can be easily included in a dataframe. The glanced output again generates a tibble using the <code>broom</code> function <code>glance</code>:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="modelling-linear-regression.html#cb280-1" tabindex="-1"></a>glanced <span class="ot">&lt;-</span> <span class="fu">glance</span>(lmfit)</span>
<span id="cb280-2"><a href="modelling-linear-regression.html#cb280-2" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(glanced, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-55f2bfff45bd16941d65" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-55f2bfff45bd16941d65">{"x":{"filter":"none","vertical":false,"data":[["1"],[0.9755440568488399],[0.9736628304525968],[1824.495501646355],[518.5681312983147],[7.341364277346169e-12],[1],[-132.846703525965],[271.69340705193],[273.8175576552366],[43274189.86186122],[13],[15]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>r.squared<\/th>\n      <th>adj.r.squared<\/th>\n      <th>sigma<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>df<\/th>\n      <th>logLik<\/th>\n      <th>AIC<\/th>\n      <th>BIC<\/th>\n      <th>deviance<\/th>\n      <th>df.residual<\/th>\n      <th>nobs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"r.squared","targets":1},{"name":"adj.r.squared","targets":2},{"name":"sigma","targets":3},{"name":"statistic","targets":4},{"name":"p.value","targets":5},{"name":"df","targets":6},{"name":"logLik","targets":7},{"name":"AIC","targets":8},{"name":"BIC","targets":9},{"name":"deviance","targets":10},{"name":"df.residual","targets":11},{"name":"nobs","targets":12}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>The glanced output has most of the same outputs as <code>summary</code>, plus some extra.</p>
<p>Variables described previously include the two <span class="math inline">\(R^2\)</span> values (remember we want to use the adjusted R-squared in almost all cases), <code>sigma</code>, which is the estimated standard error of the residuals, and <code>statistic</code>, <code>p.value</code>, and <code>df</code>, which are the F-statistic, its p-value, and the number of degrees of freedom used in the numerator of the F-statistic.</p>
<p>New outputs include <code>deviance</code>, <code>logLik</code>, <code>AIC</code>, <code>BIC</code>, the number of observations, and the number of residual degrees of freedom. Deviance is the sum of the squares of the residuals of the model. The <code>logLik</code> is the log-likelihood of the model used to calculate <code>AIC</code> and <code>BIC</code>, the Akaike information criterion and Bayesian information criterion, which are estimations of the model quality. For additional information on these values, you will have to delve into the statistics literature.</p>
</div>
<div id="augmented-outputs" class="section level3 hasAnchor" number="19.5.3">
<h3><span class="header-section-number">19.5.3</span> Augmented outputs<a href="modelling-linear-regression.html#augmented-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, the augmented output is a complete summary of the fit behavior of the model, generating a tibble using the <code>broom</code> function <code>augment</code>:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="modelling-linear-regression.html#cb281-1" tabindex="-1"></a>augmented <span class="ot">&lt;-</span> <span class="fu">augment</span>(lmfit)</span>
<span id="cb281-2"><a href="modelling-linear-regression.html#cb281-2" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(augmented, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4e27134817c9e346ff40" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4e27134817c9e346ff40">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],[502.3391,591.7768,581.4588,5656.342,5653.5584,5667.4387,9393.4167,9362.685799999999,9332.049800000001,20186.9033,20140.5115,20152.9856,30797.6935,30836.5239,30789.8266],[0,0,0,0.1,0.1,0.1,0.2,0.2,0.2,0.5,0.5,0.5,1,1,1],[2615.119450306747,2615.119450306747,2615.119450306747,5585.836464110429,5585.836464110429,5585.836464110429,8556.553477914111,8556.553477914111,8556.553477914111,17468.70451932515,17468.70451932515,17468.70451932515,32322.28958834356,32322.28958834356,32322.28958834356],[-2112.780350306747,-2023.342650306747,-2033.660650306747,70.50553588957064,67.72193588957089,81.60223588957069,836.863222085889,806.1323220858885,775.4963220858899,2718.198780674848,2671.806980674846,2684.281080674846,-1524.596088343558,-1485.765688343559,-1532.462988343559],[0.1329243353783231,0.1329243353783231,0.1329243353783231,0.1012269938650307,0.1012269938650307,0.1012269938650307,0.07975460122699385,0.07975460122699385,0.07975460122699385,0.07668711656441718,0.07668711656441718,0.07668711656441718,0.2760736196319019,0.2760736196319019,0.2760736196319019],[1782.461636681907,1792.406887720477,1791.284269553551,1898.873766080493,1898.883159911906,1898.832557030242,1882.22283642461,1883.437023694713,1884.601515256309,1714.446309338632,1721.015550114476,1719.262746690816,1827.187626774323,1830.866076538774,1826.429906811357],[0.1185451010681178,0.1087210868870077,0.1098327566613702,9.356795665990394e-05,8.632556675094507e-05,0.0001253385963399713,0.009906992026245356,0.009192751458027922,0.008507311478872374,0.09983238686436907,0.09645376583510391,0.09735651263606972,0.1839204904480307,0.1746711435215482,0.1858234430672667],[-1.243606700787078,-1.190962646706001,-1.197035939623959,0.040761993067928,0.03915268562174976,0.04717742701605555,0.4781452634015676,0.4605870365763488,0.4430830312586598,1.550472146055519,1.524010066013116,1.531125345710324,-0.9821205599872512,-0.9571066336863108,-0.9871882918884651]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>signal<\/th>\n      <th>conc_Na<\/th>\n      <th>.fitted<\/th>\n      <th>.resid<\/th>\n      <th>.hat<\/th>\n      <th>.sigma<\/th>\n      <th>.cooksd<\/th>\n      <th>.std.resid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"signal","targets":1},{"name":"conc_Na","targets":2},{"name":".fitted","targets":3},{"name":".resid","targets":4},{"name":".hat","targets":5},{"name":".sigma","targets":6},{"name":".cooksd","targets":7},{"name":".std.resid","targets":8}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Here, you can see the dependent variable (here <code>signal</code>), the independent variable (here <code>conc_Na</code>), the fitted model response (<code>.fitted</code>), the residual for that fit value (<code>.resid</code>), the diagonal of the hat matrix (<code>.hat</code>), the model standard error when the listed observation is dropped from the model (‘.sigma’), the Cooks distance of that observation (<code>.cooksd</code>), and the standardized residuals (<code>.std.resid</code>). It is unlikely that you will use most of these values, but it is useful to know how to calculate them, and we will revisit the residuals in the next chapter.</p>
</div>
</div>
<div id="building-linear-regressions-for-multiple-analytes" class="section level2 hasAnchor" number="19.6">
<h2><span class="header-section-number">19.6</span> Building Linear Regressions for Multiple Analytes<a href="modelling-linear-regression.html#building-linear-regressions-for-multiple-analytes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In many cases in analytical chemistry, we find ourselves with multiple analytes, each of which will have their own calibration curves. We can easily use the power of R to calculate these calibration curves, store them in a logical way, and apply them to new data in an automated fashion.</p>
<div id="dataset" class="section level3 hasAnchor" number="19.6.1">
<h3><span class="header-section-number">19.6.1</span> Dataset<a href="modelling-linear-regression.html#dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The dataset <code>metalConc</code> contains information on metal concentrations measured in parts per million, or ppm, and corresponding signal values (counts per seconds, or cps) from the inductively coupled plasma optical emission spectrometer (ICP-OES) in ANALEST for 4 metals: Aluminum, Magnesium, Calcium, and Potassium. We will also import a dataset of samples run on the same ICP-OES to apply our new calibration curves. Take a look at the calibration data before proceeding with our analysis (we have done some pre-analysis to get it in the right format here):</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="modelling-linear-regression.html#cb282-1" tabindex="-1"></a>metalConc <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/metal_concentration.csv&quot;</span>)</span>
<span id="cb282-2"><a href="modelling-linear-regression.html#cb282-2" tabindex="-1"></a>metalSignals <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/metal_signals.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb282-3"><a href="modelling-linear-regression.html#cb282-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samplenumber =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb282-4"><a href="modelling-linear-regression.html#cb282-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>samplenumber, <span class="at">names_to =</span> <span class="st">&quot;metal&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Signal&quot;</span>)</span>
<span id="cb282-5"><a href="modelling-linear-regression.html#cb282-5" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(metalConc)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-be3d0343511e47de8b3e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-be3d0343511e47de8b3e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],[0,0.1,0.2,0.5,1,2,5,10,20],[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576],[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941],[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786],[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Concentration<\/th>\n      <th>Al<\/th>\n      <th>Mg<\/th>\n      <th>Ca<\/th>\n      <th>K<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Concentration","targets":1},{"name":"Al","targets":2},{"name":"Mg","targets":3},{"name":"Ca","targets":4},{"name":"K","targets":5}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="building-a-linear-regression-for-each-analyte" class="section level3 hasAnchor" number="19.6.2">
<h3><span class="header-section-number">19.6.2</span> Building a Linear Regression for Each Analyte<a href="modelling-linear-regression.html#building-a-linear-regression-for-each-analyte" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, we will build separate linear regression models for each metal to predict signal values based on metal concentrations. This can be done either in base R using a for loop or in Tidyverse using the mutate function. We will show both methods.</p>
<div id="tidyverse" class="section level4 hasAnchor" number="19.6.2.1">
<h4><span class="header-section-number">19.6.2.1</span> Tidyverse<a href="modelling-linear-regression.html#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Tidyverse approach is generally preferred in R, as the code is easier to read and faster to implement, and the results are accessible automatically. Our data is not currently in tidy format, so let’s pivot it into a tidy format first. We use the <code>pivot_longer</code> function to turn our separate metal columns into two columns, one containing the metal identity for each sample, and the other containing the signal intensity for that metal:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="modelling-linear-regression.html#cb283-1" tabindex="-1"></a>tidiedMetals <span class="ot">&lt;-</span> metalConc <span class="sc">%&gt;%</span> </span>
<span id="cb283-2"><a href="modelling-linear-regression.html#cb283-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Concentration, <span class="at">names_to =</span> <span class="st">&quot;metal&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Signal&quot;</span>)</span>
<span id="cb283-3"><a href="modelling-linear-regression.html#cb283-3" tabindex="-1"></a></span>
<span id="cb283-4"><a href="modelling-linear-regression.html#cb283-4" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(tidiedMetals)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-04d12f9c20479a15aa71" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-04d12f9c20479a15aa71">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],[0,0,0,0,0.1,0.1,0.1,0.1,0.2,0.2,0.2,0.2,0.5,0.5,0.5,0.5,1,1,1,1,2,2,2,2,5,5,5,5,10,10,10,10,20,20,20,20],["Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K"],[47.65207368,914.8524097,22868.85176,69.67488883999999,673.4280116,23385.88006,73552.11119,11295.97549,494.1924593,16761.39292,59952.89462,8360.64947,3157.461024,110265.1634,326889.3515,62071.05546,6335.077694,218215.4232,644500.0469,140788.3763,6811.151416,240584.101,718761.2804,161124.7635,16076.05919,566487.8196,1673552.82,440977.7838,43769.88816,1680164.492,4693083.579,1490964.321,64355.35576,2657633.941,7325418.786,2617456.722]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Concentration<\/th>\n      <th>metal<\/th>\n      <th>Signal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Concentration","targets":1},{"name":"metal","targets":2},{"name":"Signal","targets":3}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Now we can construct calibration curves for each metal separately all within the pipe, and extract the fit parameters using the <code>broom</code> <code>tidy</code> function. This is a little complicated, so let’s go through it step-by-step.
1. We group the data by metal using the <code>group_by</code> function to allow us to create separate calibration curves for each metal
2. We nest the data using the <code>nest</code> function, which stores the entire dataset for each metal into its own column, “nesting” those dataframes within our larger dataframe.
3. We can then build models off of those datasets using the <code>mutate</code> function combined with the <code>map</code> function. <code>map</code> tells R that we want to apply a function (in this case <code>lm</code>) to data that we specify. We assign the generated models to a new column, <code>model</code>, using <code>mutate</code>.
4. Within the same mutate call, we use <code>map</code> to call the <code>tidy</code> function on each model individually and assign it to a new column called <code>tidied</code>, which stores the entire dataframe in the same column
5. We call <code>unnest</code> to extract the dataframes contained within <code>tidied</code>
6. We generate a data table to view our newly analyzed data</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="modelling-linear-regression.html#cb284-1" tabindex="-1"></a>tidyCalCurve <span class="ot">&lt;-</span> tidiedMetals <span class="sc">%&gt;%</span></span>
<span id="cb284-2"><a href="modelling-linear-regression.html#cb284-2" tabindex="-1"></a>  <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb284-3"><a href="modelling-linear-regression.html#cb284-3" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb284-4"><a href="modelling-linear-regression.html#cb284-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(Signal <span class="sc">~</span> Concentration, <span class="at">data =</span> .x)), </span>
<span id="cb284-5"><a href="modelling-linear-regression.html#cb284-5" tabindex="-1"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb284-6"><a href="modelling-linear-regression.html#cb284-6" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied)</span>
<span id="cb284-7"><a href="modelling-linear-regression.html#cb284-7" tabindex="-1"></a></span>
<span id="cb284-8"><a href="modelling-linear-regression.html#cb284-8" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(tidyCalCurve, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3298b0067d1be4e3ff35" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3298b0067d1be4e3ff35">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Al","Al","Mg","Mg","Ca","Ca","K","K"],[{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722]}],[{"coefficients":[1307.205378984344,3349.366427260848],"residuals":[-1259.553305304346,-968.7140101104376,-1482.886205136517,175.5724313852318,1678.505887754806,-1194.786817506042,-1977.978325288583,8969.018508407184,-3939.178164201296],"effects":[-47240.08859619332,63816.5403041419,-1078.607582818087,571.0102551989239,2059.209047393936,-843.5529862160356,-1715.152479045949,9084.497712904198,-4118.392243195522],"rank":2,"fitted.values":[1307.205378984346,1642.142021710438,1977.078664436517,2981.888592614768,4656.571806245193,8005.938233506042,18054.03751528858,34800.86965159282,68294.5339242013],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[1307.205378984344,3349.366427260848],"residuals":[-1259.553305304346,-968.7140101104376,-1482.886205136517,175.5724313852318,1678.505887754806,-1194.786817506042,-1977.978325288583,8969.018508407184,-3939.178164201296],"effects":[-47240.08859619332,63816.5403041419,-1078.607582818087,571.0102551989239,2059.209047393936,-843.5529862160356,-1715.152479045949,9084.497712904198,-4118.392243195522],"rank":2,"fitted.values":[1307.205378984346,1642.142021710438,1977.078664436517,2981.888592614768,4656.571806245193,8005.938233506042,18054.03751528858,34800.86965159282,68294.5339242013],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[21629.99458763811,137106.7812964164],"residuals":[-20715.1421779378,-11954.79265727944,-32289.95792692131,20081.77816415383,59478.64731594555,-55259.45618047094,-140676.0814697203,287466.6844481975,-106131.6795159671],"effects":[-1838137.6885299,2612338.967560956,-26184.76447818766,26095.34885312658,65339.51340531677,-49703.99929030275,-136036.8521771612,290578.8677447414,-106073.5882114535],"rank":2,"fitted.values":[21629.9945876378,35340.67271727944,49051.35084692131,90183.38523584617,158736.7758840544,295843.5571804709,707163.9010697203,1392697.807551803,2763765.620515967],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[21629.99458763811,137106.7812964164],"residuals":[-20715.1421779378,-11954.79265727944,-32289.95792692131,20081.77816415383,59478.64731594555,-55259.45618047094,-140676.0814697203,287466.6844481975,-106131.6795159671],"effects":[-1838137.6885299,2612338.967560956,-26184.76447818766,26095.34885312658,65339.51340531677,-49703.99929030275,-136036.8521771612,290578.8677447414,-106073.5882114535],"rank":2,"fitted.values":[21629.9945876378,35340.67271727944,49051.35084692131,90183.38523584617,158736.7758840544,295843.5571804709,707163.9010697203,1392697.807551803,2763765.620515967],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[98591.3044333728,377609.7417904548],"residuals":[-75722.45267337226,-62800.16742241978,-114160.3581714641,39493.17617139978,168299.0006761724,-135049.5076142823,-313087.1933856465,818394.8566620797,-325367.3542424669],"effects":[-5179526.57379,7194718.114468773,-89231.94996832474,63828.39585461421,191645.5728261786,-113680.2305306924,-297649.8015013057,823945.7732143388,-339589.3883543713],"rank":2,"fitted.values":[98591.30443337226,136352.2786124198,174113.2527914641,287396.1753286002,476201.0462238276,853810.7880142824,1986640.013385647,3874688.72233792,7650786.140242468],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[98591.3044333728,377609.7417904548],"residuals":[-75722.45267337226,-62800.16742241978,-114160.3581714641,39493.17617139978,168299.0006761724,-135049.5076142823,-313087.1933856465,818394.8566620797,-325367.3542424669],"effects":[-5179526.57379,7194718.114468773,-89231.94996832474,63828.39585461421,191645.5728261786,-113680.2305306924,-297649.8015013057,823945.7732143388,-339589.3883543713],"rank":2,"fitted.values":[98591.30443337226,136352.2786124198,174113.2527914641,287396.1753286002,476201.0462238276,853810.7880142824,1986640.013385647,3874688.72233792,7650786.140242468],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[-30129.57206273584,134130.8110946769],"residuals":[30199.24695157632,28012.4664432677,11664.05931380054,25135.22197539755,36787.13726805909,-77007.28662661783,-199546.6996106486,179785.782115967,-35029.92783080183],"effects":[-1644369.773969613,2555636.863910101,1316.616943969158,15064.46834938414,27177.53154840897,-85694.59653354136,-205467.1220793923,178476.8387108562,-27115.91310864687],"rank":2,"fitted.values":[-30129.57206273632,-16716.4909532677,-3303.40984380054,36935.83348460245,104001.2390319409,238132.0501266178,640524.4834106485,1311178.538884033,2652486.649830802],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[-30129.57206273584,134130.8110946769],"residuals":[30199.24695157632,28012.4664432677,11664.05931380054,25135.22197539755,36787.13726805909,-77007.28662661783,-199546.6996106486,179785.782115967,-35029.92783080183],"effects":[-1644369.773969613,2555636.863910101,1316.616943969158,15064.46834938414,27177.53154840897,-85694.59653354136,-205467.1220793923,178476.8387108562,-27115.91310864687],"rank":2,"fitted.values":[-30129.57206273632,-16716.4909532677,-3303.40984380054,36935.83348460245,104001.2390319409,238132.0501266178,640524.4834106485,1311178.538884033,2652486.649830802],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}}],["(Intercept)","Concentration","(Intercept)","Concentration","(Intercept)","Concentration","(Intercept)","Concentration"],[1307.205378984344,3349.366427260848,21629.99458763811,137106.7812964164,98591.3044333728,377609.7417904548,-30129.57206273584,134130.8110946769],[1588.834962783515,206.9851694284447,53251.67560002514,6937.351804689368,147985.3657217587,19278.76507902737,43899.99542503562,5719.063467133079],[0.8227445956339116,16.18167348177441,0.4061843001918214,19.76356182538384,0.6662233387235308,19.58682209376793,-0.6863228975544111,23.45328249380586],[0.437778655139756,8.37443932319956e-07,0.696737478074499,2.121850276266878e-07,0.526607576057522,2.257314567487475e-07,0.5145926883788856,6.505212996990959e-08]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>metal<\/th>\n      <th>data<\/th>\n      <th>model<\/th>\n      <th>term<\/th>\n      <th>estimate<\/th>\n      <th>std.error<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"metal","targets":1},{"name":"data","targets":2},{"name":"model","targets":3},{"name":"term","targets":4},{"name":"estimate","targets":5},{"name":"std.error","targets":6},{"name":"statistic","targets":7},{"name":"p.value","targets":8}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>We now have a tidy version of our calibration curves with the models still accessible under the ‘model’ column, and the values, standard errors, and p-values of our slope and intercept.</p>
<p>If we instead wanted to evaluate how well each calibration curve worked, we would use the <code>glance</code> function, like so, which is doing exactly the same thing but with the <code>glance</code> function instead of the <code>tidy</code> function.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="modelling-linear-regression.html#cb285-1" tabindex="-1"></a>glancedCalCurve <span class="ot">&lt;-</span> tidiedMetals <span class="sc">%&gt;%</span></span>
<span id="cb285-2"><a href="modelling-linear-regression.html#cb285-2" tabindex="-1"></a>  <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb285-3"><a href="modelling-linear-regression.html#cb285-3" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb285-4"><a href="modelling-linear-regression.html#cb285-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(Signal <span class="sc">~</span> Concentration, <span class="at">data =</span> .x)), </span>
<span id="cb285-5"><a href="modelling-linear-regression.html#cb285-5" tabindex="-1"></a>         <span class="at">glance =</span> <span class="fu">map</span>(model, glance)) <span class="sc">%&gt;%</span></span>
<span id="cb285-6"><a href="modelling-linear-regression.html#cb285-6" tabindex="-1"></a>  <span class="fu">unnest</span>(glance)</span>
<span id="cb285-7"><a href="modelling-linear-regression.html#cb285-7" tabindex="-1"></a></span>
<span id="cb285-8"><a href="modelling-linear-regression.html#cb285-8" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(glancedCalCurve, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2a401322bad484b4c459" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2a401322bad484b4c459">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["Al","Mg","Ca","K"],[{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786]},{"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20],"Signal":[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722]}],[{"coefficients":[1307.205378984344,3349.366427260848],"residuals":[-1259.553305304346,-968.7140101104376,-1482.886205136517,175.5724313852318,1678.505887754806,-1194.786817506042,-1977.978325288583,8969.018508407184,-3939.178164201296],"effects":[-47240.08859619332,63816.5403041419,-1078.607582818087,571.0102551989239,2059.209047393936,-843.5529862160356,-1715.152479045949,9084.497712904198,-4118.392243195522],"rank":2,"fitted.values":[1307.205378984346,1642.142021710438,1977.078664436517,2981.888592614768,4656.571806245193,8005.938233506042,18054.03751528858,34800.86965159282,68294.5339242013],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[47.65207368,673.4280116,494.1924593,3157.461024,6335.077694,6811.151416,16076.05919,43769.88816,64355.35576],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[21629.99458763811,137106.7812964164],"residuals":[-20715.1421779378,-11954.79265727944,-32289.95792692131,20081.77816415383,59478.64731594555,-55259.45618047094,-140676.0814697203,287466.6844481975,-106131.6795159671],"effects":[-1838137.6885299,2612338.967560956,-26184.76447818766,26095.34885312658,65339.51340531677,-49703.99929030275,-136036.8521771612,290578.8677447414,-106073.5882114535],"rank":2,"fitted.values":[21629.9945876378,35340.67271727944,49051.35084692131,90183.38523584617,158736.7758840544,295843.5571804709,707163.9010697203,1392697.807551803,2763765.620515967],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[914.8524097,23385.88006,16761.39292,110265.1634,218215.4232,240584.101,566487.8196,1680164.492,2657633.941],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[98591.3044333728,377609.7417904548],"residuals":[-75722.45267337226,-62800.16742241978,-114160.3581714641,39493.17617139978,168299.0006761724,-135049.5076142823,-313087.1933856465,818394.8566620797,-325367.3542424669],"effects":[-5179526.57379,7194718.114468773,-89231.94996832474,63828.39585461421,191645.5728261786,-113680.2305306924,-297649.8015013057,823945.7732143388,-339589.3883543713],"rank":2,"fitted.values":[98591.30443337226,136352.2786124198,174113.2527914641,287396.1753286002,476201.0462238276,853810.7880142824,1986640.013385647,3874688.72233792,7650786.140242468],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[22868.85176,73552.11119,59952.89462,326889.3515,644500.0469,718761.2804,1673552.82,4693083.579,7325418.786],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}},{"coefficients":[-30129.57206273584,134130.8110946769],"residuals":[30199.24695157632,28012.4664432677,11664.05931380054,25135.22197539755,36787.13726805909,-77007.28662661783,-199546.6996106486,179785.782115967,-35029.92783080183],"effects":[-1644369.773969613,2555636.863910101,1316.616943969158,15064.46834938414,27177.53154840897,-85694.59653354136,-205467.1220793923,178476.8387108562,-27115.91310864687],"rank":2,"fitted.values":[-30129.57206273632,-16716.4909532677,-3303.40984380054,36935.83348460245,104001.2390319409,238132.0501266178,640524.4834106485,1311178.538884033,2652486.649830802],"assign":[0,1],"qr":{"qr":[[-3,-12.93333333333333],[0.3333333333333333,19.05331700489153],[0.3333333333333333,0.1592023757624244],[0.3333333333333333,0.143457085851855],[0.3333333333333333,0.1172149360009059],[0.3333333333333333,0.06473063629900772],[0.3333333333333333,-0.09272226280668679],[0.3333333333333333,-0.3551437613161776],[0.3333333333333333,-0.8799867583351593]],"qraux":[1.333333333333333,1.164450805732614],"pivot":[1,2],"tol":1e-07,"rank":2},"df.residual":7,"xlevels":{},"call":{},"terms":{},"model":{"Signal":[69.67488883999999,11295.97549,8360.64947,62071.05546,140788.3763,161124.7635,440977.7838,1490964.321,2617456.722],"Concentration":[0,0.1,0.2,0.5,1,2,5,10,20]}}],[0.9739628430183971,0.9823942942876951,0.9820808532258408,0.9874339487897882],[0.9702432491638824,0.9798791934716515,0.9795209751152466,0.9856387986169007],[3943.754048431341,132179.5631092029,367324.4225135412,108967.1292103806],[261.8465566707612,390.5983760257695,383.6435997329153,550.0564597342604],[8.374439323199532e-07,2.12185027626687e-07,2.257314567487475e-07,6.505212996990982e-08],[1,1,1,1],[-86.15852704707139,-117.7667813053046,-126.9655383660009,-116.0287458112604],[178.3170540941428,241.5335626106092,259.9310767320018,238.0574916225208],[178.9087278261514,242.1252363426179,260.5227504640105,238.6491653545295],[108872371.9616302,122300058326.1782,944490619624.3457,83116846738.46251],[7,7,7,7],[9,9,9,9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>metal<\/th>\n      <th>data<\/th>\n      <th>model<\/th>\n      <th>r.squared<\/th>\n      <th>adj.r.squared<\/th>\n      <th>sigma<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>df<\/th>\n      <th>logLik<\/th>\n      <th>AIC<\/th>\n      <th>BIC<\/th>\n      <th>deviance<\/th>\n      <th>df.residual<\/th>\n      <th>nobs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6,7,8,9,10,11,12,13,14,15]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"metal","targets":1},{"name":"data","targets":2},{"name":"model","targets":3},{"name":"r.squared","targets":4},{"name":"adj.r.squared","targets":5},{"name":"sigma","targets":6},{"name":"statistic","targets":7},{"name":"p.value","targets":8},{"name":"df","targets":9},{"name":"logLik","targets":10},{"name":"AIC","targets":11},{"name":"BIC","targets":12},{"name":"deviance","targets":13},{"name":"df.residual","targets":14},{"name":"nobs","targets":15}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>You can feel free to do whatever data manupulation you want to get the right combination of estimate values and measurements of goodness of fit. For example, say you wanted slope, intercept, and adjusted R-squared in columns for a report. You could perform the following functions. There’s a lot going on here, so we’ll go through this step-by-step as well.
1. This time we have generated both tidied and glanced dataframes for each model and nested them as above.
2. This time, we unnest glance and <code>select</code> only the information we want, in this case retaining the <code>metal</code>, <code>adj.r.squared</code>, and <code>tidied</code> columns
3. Then, we unnest tidied and use <code>pivot_wider</code> to convert the tidyverse format <code>tidy</code> output into wide format results for legibility, setting the column names based off of the <code>tidy</code> <code>term</code> column and the results from the <code>estimate</code> column
4. We rename the terms for legibility
5. We select only the results we want
6. We generate a readable data table</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="modelling-linear-regression.html#cb286-1" tabindex="-1"></a>combinedCalCurve <span class="ot">&lt;-</span> tidiedMetals <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="modelling-linear-regression.html#cb286-2" tabindex="-1"></a>  <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb286-3"><a href="modelling-linear-regression.html#cb286-3" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb286-4"><a href="modelling-linear-regression.html#cb286-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(Signal <span class="sc">~</span> Concentration, <span class="at">data =</span> .x)), </span>
<span id="cb286-5"><a href="modelling-linear-regression.html#cb286-5" tabindex="-1"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy),</span>
<span id="cb286-6"><a href="modelling-linear-regression.html#cb286-6" tabindex="-1"></a>         <span class="at">glanced =</span> <span class="fu">map</span>(model, glance)) <span class="sc">%&gt;%</span></span>
<span id="cb286-7"><a href="modelling-linear-regression.html#cb286-7" tabindex="-1"></a>  <span class="fu">unnest</span>(glanced) <span class="sc">%&gt;%</span> </span>
<span id="cb286-8"><a href="modelling-linear-regression.html#cb286-8" tabindex="-1"></a>  <span class="fu">select</span>(metal, adj.r.squared, tidied) <span class="sc">%&gt;%</span></span>
<span id="cb286-9"><a href="modelling-linear-regression.html#cb286-9" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied) <span class="sc">%&gt;%</span></span>
<span id="cb286-10"><a href="modelling-linear-regression.html#cb286-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(metal, adj.r.squared), <span class="at">names_from =</span> <span class="st">&#39;term&#39;</span>, <span class="at">values_from =</span> <span class="st">&#39;estimate&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb286-11"><a href="modelling-linear-regression.html#cb286-11" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">slope =</span> Concentration, <span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">adjRsquared =</span> adj.r.squared) <span class="sc">%&gt;%</span></span>
<span id="cb286-12"><a href="modelling-linear-regression.html#cb286-12" tabindex="-1"></a>  <span class="fu">select</span>(metal, slope, intercept, adjRsquared)</span>
<span id="cb286-13"><a href="modelling-linear-regression.html#cb286-13" tabindex="-1"></a></span>
<span id="cb286-14"><a href="modelling-linear-regression.html#cb286-14" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(combinedCalCurve)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e02873e1339c43858f12" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e02873e1339c43858f12">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["Al","Mg","Ca","K"],[3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769],[1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584],[0.9702432491638824,0.9798791934716515,0.9795209751152466,0.9856387986169007]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>metal<\/th>\n      <th>slope<\/th>\n      <th>intercept<\/th>\n      <th>adjRsquared<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"metal","targets":1},{"name":"slope","targets":2},{"name":"intercept","targets":3},{"name":"adjRsquared","targets":4}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>You can always directly access the values in any of these formats using the <code>select</code> and <code>filter</code> functions. Here’s how to do that with the above table, accessing the slope of the Ca calibration curve as an example. The double square brackets access the specific value instead of returning a dataframe with only one element.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="modelling-linear-regression.html#cb287-1" tabindex="-1"></a>CaSlope <span class="ot">&lt;-</span> combinedCalCurve <span class="sc">%&gt;%</span></span>
<span id="cb287-2"><a href="modelling-linear-regression.html#cb287-2" tabindex="-1"></a>  <span class="fu">filter</span>(metal <span class="sc">==</span> <span class="st">&#39;Ca&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb287-3"><a href="modelling-linear-regression.html#cb287-3" tabindex="-1"></a>  <span class="fu">select</span>(slope)</span>
<span id="cb287-4"><a href="modelling-linear-regression.html#cb287-4" tabindex="-1"></a>CaSlope[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] 377609.7</code></pre>
<p>If we want to use these values to calculate new concentrations in the <code>metalSignals</code> dataframe, we just have to do a little bit of code using tidyverse. Here is one way to do it by joining the calibration dataset with our new samples using the <code>full_join</code> function. This allows us to add one dataframe (here <code>tidyCalCurve</code>) to another (<code>metalSignals</code>), by comparing the values of one of the columns (here <code>metal</code>):</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="modelling-linear-regression.html#cb289-1" tabindex="-1"></a><span class="co">#Start by creating our calibration curves in wide format, with the metal in one column, the slope in the second, and the intercept in the third.</span></span>
<span id="cb289-2"><a href="modelling-linear-regression.html#cb289-2" tabindex="-1"></a>tidyCalCurve <span class="ot">&lt;-</span> tidiedMetals <span class="sc">%&gt;%</span></span>
<span id="cb289-3"><a href="modelling-linear-regression.html#cb289-3" tabindex="-1"></a>  <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb289-4"><a href="modelling-linear-regression.html#cb289-4" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb289-5"><a href="modelling-linear-regression.html#cb289-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(Signal <span class="sc">~</span> Concentration, <span class="at">data =</span> .x)), </span>
<span id="cb289-6"><a href="modelling-linear-regression.html#cb289-6" tabindex="-1"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb289-7"><a href="modelling-linear-regression.html#cb289-7" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied) <span class="sc">%&gt;%</span></span>
<span id="cb289-8"><a href="modelling-linear-regression.html#cb289-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(metal), <span class="at">names_from =</span> <span class="st">&#39;term&#39;</span>, <span class="at">values_from =</span> <span class="st">&#39;estimate&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb289-9"><a href="modelling-linear-regression.html#cb289-9" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">slope =</span> Concentration, <span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb289-10"><a href="modelling-linear-regression.html#cb289-10" tabindex="-1"></a>  <span class="fu">select</span>(metal, slope, intercept)</span>
<span id="cb289-11"><a href="modelling-linear-regression.html#cb289-11" tabindex="-1"></a></span>
<span id="cb289-12"><a href="modelling-linear-regression.html#cb289-12" tabindex="-1"></a><span class="co">#Then, we join the two datasets with &#39;metal&#39; as the common column between them</span></span>
<span id="cb289-13"><a href="modelling-linear-regression.html#cb289-13" tabindex="-1"></a>tidyResults <span class="ot">&lt;-</span> <span class="fu">full_join</span>(metalSignals, tidyCalCurve, <span class="at">by =</span> <span class="st">&#39;metal&#39;</span>)</span>
<span id="cb289-14"><a href="modelling-linear-regression.html#cb289-14" tabindex="-1"></a></span>
<span id="cb289-15"><a href="modelling-linear-regression.html#cb289-15" tabindex="-1"></a><span class="co">#Finally, we calculate the concentrations for each of our samples. </span></span>
<span id="cb289-16"><a href="modelling-linear-regression.html#cb289-16" tabindex="-1"></a>tidyResults <span class="ot">&lt;-</span> tidyResults <span class="sc">%&gt;%</span></span>
<span id="cb289-17"><a href="modelling-linear-regression.html#cb289-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">concentration =</span> (Signal <span class="sc">-</span> intercept)<span class="sc">/</span>slope)</span>
<span id="cb289-18"><a href="modelling-linear-regression.html#cb289-18" tabindex="-1"></a></span>
<span id="cb289-19"><a href="modelling-linear-regression.html#cb289-19" tabindex="-1"></a><span class="co">#And output our results in a readable data table</span></span>
<span id="cb289-20"><a href="modelling-linear-regression.html#cb289-20" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(tidyResults, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-67bafb22dbcddd5a2288" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-67bafb22dbcddd5a2288">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6],["Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K","Al","Mg","Ca","K"],[28.22690166,637.911998,8146.36764,56.67326169,85.02599063,4881.352388,134822.0279,6774.110982,68.74784514,4598.590911,29488.46922,1124.06784,53.25549677,4945.846496,144811.6956,6697.140025,149.8498232,2979575.988,14029794.12,209256.8176,97.64028402,2979233.647,14031817.98,194014.5721],[3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769,3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769,3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769,3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769,3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769,3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769],[1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584,1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584,1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584,1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584,1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584,1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584],[-0.3818568392262496,-0.1531075442888161,-0.2395196065772132,0.2250507924172525,-0.364898680062861,-0.1221576499810653,0.09594753380788712,0.2751320352389965,-0.3697587471362963,-0.1242199949236446,-0.1830006685889998,0.2330086551156043,-0.3743842035342305,-0.1216872567051808,0.1224025390538681,0.2745581853056977,-0.3455446219214788,21.57403131663827,36.89312343879466,1.78472334364521,-0.3611325070674756,21.57153442336455,36.89848309924835,1.671086175752136]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>samplenumber<\/th>\n      <th>metal<\/th>\n      <th>Signal<\/th>\n      <th>slope<\/th>\n      <th>intercept<\/th>\n      <th>concentration<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"samplenumber","targets":1},{"name":"metal","targets":2},{"name":"Signal","targets":3},{"name":"slope","targets":4},{"name":"intercept","targets":5},{"name":"concentration","targets":6}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>As you can see, many of our samples have concentrations close to zero or even negative. Negative concentration values can arise when signal values fall below the intercept of the linear regression model, indicating a deviation from the model’s assumptions or that the concentration of the analyte is below the limit of detection of an instrument, where instrument noise or background signal may influence measurements. Negative concentrations lack meaningful interpretation in chemical analysis and are often considered artifacts of the model’s limitations. In the next chapter, we will discuss how to manage these types of issues through calculating limits of detection, applying nonlinear calibrations, and weighting our calibration curves to increase the accuracy of our calibration models.</p>
</div>
<div id="base-r" class="section level4 hasAnchor" number="19.6.2.2">
<h4><span class="header-section-number">19.6.2.2</span> Base R<a href="modelling-linear-regression.html#base-r" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here is one way to perform the same procedure to calculate linear regressions for each analyte in base R:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="modelling-linear-regression.html#cb290-1" tabindex="-1"></a><span class="co"># Create lists to store metal names, slope, intercept, and R^2 for each metal</span></span>
<span id="cb290-2"><a href="modelling-linear-regression.html#cb290-2" tabindex="-1"></a>metals <span class="ot">&lt;-</span> <span class="fu">colnames</span>(metalConc)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb290-3"><a href="modelling-linear-regression.html#cb290-3" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb290-4"><a href="modelling-linear-regression.html#cb290-4" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb290-5"><a href="modelling-linear-regression.html#cb290-5" tabindex="-1"></a>R2 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb290-6"><a href="modelling-linear-regression.html#cb290-6" tabindex="-1"></a></span>
<span id="cb290-7"><a href="modelling-linear-regression.html#cb290-7" tabindex="-1"></a><span class="co"># Iterate over each metal</span></span>
<span id="cb290-8"><a href="modelling-linear-regression.html#cb290-8" tabindex="-1"></a><span class="cf">for</span> (metal <span class="cf">in</span> metals) {</span>
<span id="cb290-9"><a href="modelling-linear-regression.html#cb290-9" tabindex="-1"></a>  <span class="co"># Build linear regression model</span></span>
<span id="cb290-10"><a href="modelling-linear-regression.html#cb290-10" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(metalConc[[metal]] <span class="sc">~</span> Concentration, <span class="at">data =</span> metalConc)</span>
<span id="cb290-11"><a href="modelling-linear-regression.html#cb290-11" tabindex="-1"></a>  </span>
<span id="cb290-12"><a href="modelling-linear-regression.html#cb290-12" tabindex="-1"></a>  <span class="co"># Extract slope, intercept, and R squared</span></span>
<span id="cb290-13"><a href="modelling-linear-regression.html#cb290-13" tabindex="-1"></a>  slope[metal] <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="dv">2</span>]</span>
<span id="cb290-14"><a href="modelling-linear-regression.html#cb290-14" tabindex="-1"></a>  intercept[metal] <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="dv">1</span>]</span>
<span id="cb290-15"><a href="modelling-linear-regression.html#cb290-15" tabindex="-1"></a>  R2[metal] <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>r.squared</span>
<span id="cb290-16"><a href="modelling-linear-regression.html#cb290-16" tabindex="-1"></a>  </span>
<span id="cb290-17"><a href="modelling-linear-regression.html#cb290-17" tabindex="-1"></a>}</span>
<span id="cb290-18"><a href="modelling-linear-regression.html#cb290-18" tabindex="-1"></a><span class="co">#Combine the resulting lists into a tibble</span></span>
<span id="cb290-19"><a href="modelling-linear-regression.html#cb290-19" tabindex="-1"></a>metalResults <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">metal =</span> metals, slope, intercept, R2)</span>
<span id="cb290-20"><a href="modelling-linear-regression.html#cb290-20" tabindex="-1"></a></span>
<span id="cb290-21"><a href="modelling-linear-regression.html#cb290-21" tabindex="-1"></a><span class="co">#Generate a datatable to output the</span></span>
<span id="cb290-22"><a href="modelling-linear-regression.html#cb290-22" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(metalResults, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-b1c227ea8f6a7119c7d5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b1c227ea8f6a7119c7d5">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["Al","Mg","Ca","K"],[3349.366427260848,137106.7812964164,377609.7417904548,134130.8110946769],[1307.205378984344,21629.99458763811,98591.3044333728,-30129.57206273584],[0.9739628430183971,0.9823942942876951,0.9820808532258408,0.9874339487897882]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>metal<\/th>\n      <th>slope<\/th>\n      <th>intercept<\/th>\n      <th>R2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"metal","targets":1},{"name":"slope","targets":2},{"name":"intercept","targets":3},{"name":"R2","targets":4}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>The code above uses a <code>for</code> loop, that was discussed in the <a href="loops-and-functions-in-r.html#loops">Loops</a> section of this resource. The loop will move through each metal in the dataset and then store the slope, intercept and <span class="math inline">\(R^2\)</span> values in their own vectors. We then combine these vectors into a table. This table can be accessed and used exactly as in the Tidyverse methods.</p>
</div>
</div>
<div id="visualizing-linear-regressions-for-each-analyte" class="section level3 hasAnchor" number="19.6.3">
<h3><span class="header-section-number">19.6.3</span> Visualizing Linear Regressions for Each Analyte<a href="modelling-linear-regression.html#visualizing-linear-regressions-for-each-analyte" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After constructing linear regression models for each metal, visualizing these results can provide valuable insights into the relationships between metal concentrations and signal values. Below, we will create a single scatterplot for four selected metals along with their regression lines. This visualization will help in assessing the fit of the models and understanding the variance in signal values as a function of concentration. To make this plot, we will be using the tidied version of the dataset, produced using pivot_longer above.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="modelling-linear-regression.html#cb291-1" tabindex="-1"></a><span class="co"># Create a scatterplot for each metal with its regression line</span></span>
<span id="cb291-2"><a href="modelling-linear-regression.html#cb291-2" tabindex="-1"></a><span class="fu">ggplot</span>(tidiedMetals, <span class="fu">aes</span>(<span class="at">x =</span> Concentration, <span class="at">y =</span> Signal, <span class="at">color =</span> metal)) <span class="sc">+</span></span>
<span id="cb291-3"><a href="modelling-linear-regression.html#cb291-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb291-4"><a href="modelling-linear-regression.html#cb291-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color =</span> metal)) <span class="sc">+</span></span>
<span id="cb291-5"><a href="modelling-linear-regression.html#cb291-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Regression Lines for Selected Metals&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Concentration&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Signal&quot;</span>) <span class="sc">+</span></span>
<span id="cb291-6"><a href="modelling-linear-regression.html#cb291-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb291-7"><a href="modelling-linear-regression.html#cb291-7" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;purple&quot;</span>))</span></code></pre></div>
<p><img src="R4EnvChem_files/figure-html/unnamed-chunk-184-1.png" width="672" /></p>
<p>Based on this plot, we can see that our instrument is much more sensitive to calcium than the other metals, and has very low sensitivity to aluminum, which may explain some of the odd concentrations we observed previously.</p>
</div>
</div>
<div id="conclusion" class="section level2 hasAnchor" number="19.7">
<h2><span class="header-section-number">19.7</span> Conclusion<a href="modelling-linear-regression.html#conclusion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In conclusion, while linear regression serves as a powerful tool for analyzing the relationship between chemical concentrations and instrumental signals, its applicability may be limited by the assumption of linearity. Negative concentration values observed in linear regression analyses highlight the need for robust statistical techniques and critical evaluation of instrument responses. In the next chapter, we will explore some alternative modeling approaches as well as some techniques for evaluating the effectiveness of the models produced.</p>
</div>
<div id="further_reading_chapter19" class="section level2 hasAnchor" number="19.8">
<h2><span class="header-section-number">19.8</span> Further reading<a href="modelling-linear-regression.html#further_reading_chapter19" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As previously stated, we highly recommend reading Chapter 5: Calibration from <em>Data Analysis for Chemistry</em> by Hibbert and Gooding for a more in-depth discussion of linear calibration modelling. The book can be accessed online via the University of Toronto’s Library.</p>
<p>For a greater discussion on modelling in R, see <a href="https://r4ds.had.co.nz/model-intro.html">Modelling</a> in <a href="https://r4ds.had.co.nz/index.html"><em>R for Data Science</em></a>.</p>
</div>
<div id="exercise-13" class="section level2 hasAnchor" number="19.9">
<h2><span class="header-section-number">19.9</span> Exercise<a href="modelling-linear-regression.html#exercise-13" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There is a set of exercises available for this chapter!</p>
<p><strong>Not sure how to access and work on the exercise Rmd files? </strong></p>
<ul>
<li><p>Refer to <a href="how-to-use-this-textbook.html#running-tests-for-your-exercises">Running Tests for Your Exercises</a> for step-by-step instructions on accessing the exercises and working within the UofT JupyterHub’s RStudio environment.</p></li>
<li><p>Alternatively, if you’d like to simply access the individual files, you can download them directly from this <a href="https://github.com/UofTChem-Teaching/R4EnvChem-Exercises">repository</a>.</p></li>
</ul>
<p>Always remember to save your progress regularly and consult the textbook’s guidelines for submitting your completed exercises.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="customizing-your-plots.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="evaluating-and-improving-model-performance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/UofTChem-Teaching/R4EnvChem/edit/main/src/05-modelling-in-r/01-linear-regression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/UofTChem-Teaching/R4EnvChem/blob/main/src/05-modelling-in-r/01-linear-regression.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

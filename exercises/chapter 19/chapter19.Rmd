---
title: 'Chapter 19: Modelling: Linear Regression'
output:
  html_document:
    df_print: paged
---

# Getting Started:


Before diving into the exercises, follow the instructions below to download a dataset from the Exploring Air Quality Data website.

-   Visit the [Exploring Air Quality Data](https://uoft-chem.shinyapps.io/Air_Quality_App/) and go to `My Data` tab.
-   Enter your student number, and then download the CSV file.
-   Upload the file to your RStudio. 

Use the `read_csv()` function from the `readr`(`tidyverse`) package to import your Air Quality dataset, and assign the imported data to a variable named `data`.

```{r}
# Complete the code below and run the cell.
install.packages("tidyverse")
library(tidyverse)
# Import data from CSV file using read_csv -- your code here
data <- 
```

------------------------------------------------------------------------

# Exercise 1: Basic Data Exploration

**Your Task:** 

Explore the `data`. Generate a summary of the dataset and create a histogram of the `concentration` values. Don't forget to give a proper title and axis names to the histogram.

```{r}
# Your code to generate a summary of the dataset
summary_data <- 

# Your code to create a histogram of the concentration values

```

------------------------------------------------------------------------

# Exercise 2: Grouping and Summarizing Data

**Your Task:** 

Group the `data` by `pollutant`, and then calculate the average concentration for each group. Name the average concentration column "avg_concentration".

```{r}
# Your code to group data and calculate average concentration
grouped_data <- 

grouped_data

```


#### Test Your Code (Exercise 2)

```{r}
library(testthat, quietly = TRUE)
test_that("Grouping and Summarizing Test", {
  expect_true("pollutant" %in% colnames(grouped_data))
  expect_true("avg_concentration" %in% colnames(grouped_data))
  expect_true(nrow(grouped_data) == 3)
})
```

------------------------------------------------------------------------

# Exercise 3: Linear Modeling of Pollutant Relationships

**Your Task:**
Here, you will fit a linear model to investigate the relationship between NO2 and O3. Use NO2 concentration as the predictor (independent variable) and O3 concentration as the response (dependent variable).
1. Reformat the data to have a desired format.
1. Summarize the model and interpret the coefficients.
2. Plot the original data along with the regression line.

```{r}
# Filter data for the relevant pollutants
pol_data <- 

# Convert data to wide format
pol_data_wide <- 

# Remove NA values for complete cases
pol_data_complete <- 

# Fit a linear model
model <- 

# Summarize the model


# Create a scatterplot with the regression line

```



#### Test Your Code (Exercise 3)

```{r}
library(testthat, quietly = TRUE)
test_that("Linear Model Test", {
  expect_true("NO2" %in% names(coef(model)))
  expect_true("O3" %in% names(model$model))
  # Test for a significant relationship
  expect_true(summary(model)$coefficients[2, 4] < 0.05)
})
```


------------------------------------------------------------------------

# Exercise 4: Advanced Data Manipulation

**Your Task:** 

Create a new column `pollution_level` in `data` that categorizes the `concentration` into 'Low', 'Medium', or 'High', based on thresholds you define. Then, count how many occurrences fall into each category.

```{r}
# Create the pollution_level column


# Count occurrences in each category for Toronto


```



#### Test Your Code (Exercise 4)

```{r}
library(testthat, quietly = TRUE)
test_that("Advanced Data Manipulation Test", {
  expect_true("pollution_level" %in% colnames(data))
  expect_true(any(table(data$pollution_level) >= 0))
})
```
